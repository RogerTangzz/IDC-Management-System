import{r as c,P as B,d as oe,ac as s,ag as ne,l as M,m as _,J as t,C as a,Z as se,G as r,D as R,B as y,H as w,E as q,K as re,q as h}from"./vue-SR65qDCS.js";import{_ as ue}from"./index-Cw83YE5u.js";import{a as v,E as Y}from"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const ie={class:"maintenance-execution-list"},de={class:"card-header"},pe={key:1},me={__name:"index",setup(ce){const b=c(!1),T=c([]),x=c(0),V=c([]),f=c(!1),F=c(null),n=B({pageNum:1,pageSize:10,planName:"",executorName:"",status:"",startTime:"",endTime:""}),C=c(),u=B({result:"success",description:"",issues:"",actions:""}),K={result:[{required:!0,message:"请选择执行结果",trigger:"change"}],description:[{required:!0,message:"请输入执行说明",trigger:"blur"}]},D=[{id:1,executionNo:"EX202501001",planName:"1楼暖通系统月度保养",executorName:"张三",startTime:new Date("2025-01-15 09:00:00"),endTime:new Date("2025-01-15 11:30:00"),duration:150,status:"completed",result:"success"},{id:2,executionNo:"EX202501002",planName:"配电柜季度检修",executorName:"李四",startTime:new Date("2025-01-16 14:00:00"),endTime:null,duration:0,status:"executing",result:null}],g=async()=>{b.value=!0;try{setTimeout(()=>{T.value=D,x.value=D.length,b.value=!1},500)}catch{b.value=!1}},N=()=>{n.pageNum=1,g()},L=()=>{n.planName="",n.executorName="",n.status="",n.startTime="",n.endTime="",V.value=[],N()},P=o=>{o?(n.startTime=o[0],n.endTime=o[1]):(n.startTime="",n.endTime="")},Q=o=>{v.info("查看执行详情："+o.executionNo)},X=o=>{F.value=o,u.result="success",u.description="",u.issues="",u.actions="",f.value=!0},A=async()=>{var o;await((o=C.value)==null?void 0:o.validate());try{v.success("执行完成"),f.value=!1,g()}catch{}},G=async o=>{await Y.confirm("确定中止此次执行？","警告",{type:"warning"});try{v.success("已中止执行"),g()}catch{}},H=async()=>{await Y.confirm("确定导出执行记录？","确认",{type:"info"});try{v.success("导出成功")}catch(o){console.error("导出失败:",o)}},I=o=>{if(!o)return"-";const e=Math.floor(o/60),p=o%60;return e>0?`${e}小时${p}分钟`:`${p}分钟`},J=o=>({executing:"执行中",completed:"已完成",aborted:"已中止"})[o]||o,Z=o=>({executing:"",completed:"success",aborted:"danger"})[o]||"";return oe(()=>{g()}),(o,e)=>{const p=s("el-input"),i=s("el-form-item"),k=s("el-option"),j=s("el-select"),O=s("el-date-picker"),m=s("el-button"),U=s("el-form"),E=s("el-card"),d=s("el-table-column"),S=s("el-tag"),W=s("el-table"),ee=s("pagination"),$=s("el-radio"),te=s("el-radio-group"),le=s("el-dialog"),ae=ne("loading");return _(),M("div",ie,[t(E,{class:"search-card"},{default:a(()=>[t(U,{model:n,ref:"queryRef",inline:!0},{default:a(()=>[t(i,{label:"计划名称",prop:"planName"},{default:a(()=>[t(p,{modelValue:n.planName,"onUpdate:modelValue":e[0]||(e[0]=l=>n.planName=l),placeholder:"请输入计划名称",clearable:"",onKeyup:se(N,["enter"])},null,8,["modelValue"])]),_:1}),t(i,{label:"执行人",prop:"executorName"},{default:a(()=>[t(p,{modelValue:n.executorName,"onUpdate:modelValue":e[1]||(e[1]=l=>n.executorName=l),placeholder:"请输入执行人",clearable:""},null,8,["modelValue"])]),_:1}),t(i,{label:"执行状态",prop:"status"},{default:a(()=>[t(j,{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=l=>n.status=l),placeholder:"全部",clearable:""},{default:a(()=>[t(k,{label:"执行中",value:"executing"}),t(k,{label:"已完成",value:"completed"}),t(k,{label:"已中止",value:"aborted"})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"执行时间"},{default:a(()=>[t(O,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=l=>V.value=l),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:P},null,8,["modelValue"])]),_:1}),t(i,null,{default:a(()=>[t(m,{type:"primary",icon:"Search",onClick:N},{default:a(()=>e[12]||(e[12]=[r("搜索")])),_:1,__:[12]}),t(m,{icon:"Refresh",onClick:L},{default:a(()=>e[13]||(e[13]=[r("重置")])),_:1,__:[13]})]),_:1})]),_:1},8,["model"])]),_:1}),t(E,{class:"table-card"},{header:a(()=>[h("div",de,[e[15]||(e[15]=h("span",null,"执行记录列表",-1)),t(m,{type:"warning",icon:"Download",onClick:H},{default:a(()=>e[14]||(e[14]=[r("导出")])),_:1,__:[14]})])]),default:a(()=>[R((_(),y(W,{data:T.value,border:"",stripe:""},{default:a(()=>[t(d,{label:"执行编号",prop:"executionNo",width:"120",align:"center"}),t(d,{label:"计划名称",prop:"planName","min-width":"200","show-overflow-tooltip":""}),t(d,{label:"执行人",prop:"executorName",width:"100",align:"center"}),t(d,{label:"开始时间",prop:"startTime",width:"160",align:"center"},{default:a(l=>[r(w(o.parseTime(l.row.startTime)),1)]),_:1}),t(d,{label:"完成时间",prop:"endTime",width:"160",align:"center"},{default:a(l=>[r(w(l.row.endTime?o.parseTime(l.row.endTime):"-"),1)]),_:1}),t(d,{label:"耗时",prop:"duration",width:"100",align:"center"},{default:a(l=>[r(w(I(l.row.duration)),1)]),_:1}),t(d,{label:"执行状态",prop:"status",width:"100",align:"center"},{default:a(l=>[t(S,{type:Z(l.row.status)},{default:a(()=>[r(w(J(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),t(d,{label:"执行结果",prop:"result",width:"100",align:"center"},{default:a(l=>[l.row.result?(_(),y(S,{key:0,type:l.row.result==="success"?"success":"danger"},{default:a(()=>[r(w(l.row.result==="success"?"成功":"失败"),1)]),_:2},1032,["type"])):(_(),M("span",pe,"-"))]),_:1}),t(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:a(l=>[t(m,{link:"",type:"primary",size:"small",onClick:z=>Q(l.row)},{default:a(()=>e[16]||(e[16]=[r(" 查看详情 ")])),_:2,__:[16]},1032,["onClick"]),l.row.status==="executing"?(_(),y(m,{key:0,link:"",type:"success",size:"small",onClick:z=>X(l.row)},{default:a(()=>e[17]||(e[17]=[r(" 完成执行 ")])),_:2,__:[17]},1032,["onClick"])):q("",!0),l.row.status==="executing"?(_(),y(m,{key:1,link:"",type:"danger",size:"small",onClick:z=>G(l.row)},{default:a(()=>e[18]||(e[18]=[r(" 中止执行 ")])),_:2,__:[18]},1032,["onClick"])):q("",!0)]),_:1})]),_:1},8,["data"])),[[ae,b.value]]),R(t(ee,{total:x.value,page:n.pageNum,"onUpdate:page":e[4]||(e[4]=l=>n.pageNum=l),limit:n.pageSize,"onUpdate:limit":e[5]||(e[5]=l=>n.pageSize=l),onPagination:g},null,8,["total","page","limit"]),[[re,x.value>0]])]),_:1}),t(le,{modelValue:f.value,"onUpdate:modelValue":e[11]||(e[11]=l=>f.value=l),title:"完成执行",width:"600px"},{footer:a(()=>[t(m,{onClick:e[10]||(e[10]=l=>f.value=!1)},{default:a(()=>e[21]||(e[21]=[r("取消")])),_:1,__:[21]}),t(m,{type:"primary",onClick:A},{default:a(()=>e[22]||(e[22]=[r("确定")])),_:1,__:[22]})]),default:a(()=>[t(U,{ref_key:"completeFormRef",ref:C,model:u,rules:K,"label-width":"100px"},{default:a(()=>[t(i,{label:"执行结果",prop:"result"},{default:a(()=>[t(te,{modelValue:u.result,"onUpdate:modelValue":e[6]||(e[6]=l=>u.result=l)},{default:a(()=>[t($,{label:"success"},{default:a(()=>e[19]||(e[19]=[r("成功")])),_:1,__:[19]}),t($,{label:"failed"},{default:a(()=>e[20]||(e[20]=[r("失败")])),_:1,__:[20]})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"执行说明",prop:"description"},{default:a(()=>[t(p,{modelValue:u.description,"onUpdate:modelValue":e[7]||(e[7]=l=>u.description=l),type:"textarea",rows:4,placeholder:"请输入执行说明"},null,8,["modelValue"])]),_:1}),t(i,{label:"发现问题",prop:"issues"},{default:a(()=>[t(p,{modelValue:u.issues,"onUpdate:modelValue":e[8]||(e[8]=l=>u.issues=l),type:"textarea",rows:3,placeholder:"如有问题请描述"},null,8,["modelValue"])]),_:1}),t(i,{label:"处理措施",prop:"actions"},{default:a(()=>[t(p,{modelValue:u.actions,"onUpdate:modelValue":e[9]||(e[9]=l=>u.actions=l),type:"textarea",rows:3,placeholder:"采取的处理措施"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},be=ue(me,[["__scopeId","data-v-f047b182"]]);export{be as default};
