import{k as he,g as Ie,ar as Ne,ap as Ce,r as I,c as y,d as xe,ac as a,l as c,m as s,J as t,C as n,q as N,B as _,E as b,I as V,$ as U,u as De,G as d,H as m}from"./vue-SR65qDCS.js";import{_ as Se,I as Ue,j as C,A as Oe,F as we}from"./index-Cw83YE5u.js";import{g as Pe,u as Te}from"./inspection-INzddNo1.js";import"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const Ye={class:"app-container"},$e={class:"inspection-progress"},Ae={style:{"margin-left":"10px"}},Me={key:0,style:{"margin-left":"10px",color:"#909399"}},Re={key:2,class:"anomaly-summary"},Le={class:"anomaly-label"},je={class:"form-footer"},Ee=he({name:"InspectionEdit"}),Be=Object.assign(Ee,{setup(Je){const{proxy:O}=Ie(),M=Ne(),R=Ce(),L=R.params&&R.params.inspectionId,k=I(!1),j=I("basic"),E=I([]),w=I([]),u=I({inspectionId:void 0,inspectionNo:"",inspectionDate:"",floor:"",inspectorName:"",relayPersonId:void 0,remark:"",photos:[]}),p=I({}),z={inspectionDate:[{required:!0,message:"请选择巡检日期",trigger:"change"}],floor:[{required:!0,message:"请选择巡检楼层",trigger:"change"}],inspectorName:[{required:!0,message:"请输入巡检人员",trigger:"blur"}]},x=y(()=>Ue[u.value.floor]||[]),G=y(()=>{const l=[{value:"basic",label:"基础设施"}];return u.value.floor==="floor1"&&(l.push({value:"pump",label:"水泵系统"}),l.push({value:"cold",label:"冷冻系统"})),l}),P=y(()=>x.value.length),B=y(()=>Object.keys(p.value).filter(l=>p.value[l]!==null&&p.value[l]!==void 0).length),v=y(()=>P.value===0?0:Math.round(B.value/P.value*100)),H=y(()=>v.value===100?"success":v.value>=80?"":v.value>=50?"warning":"exception"),g=y(()=>{const l=[];return x.value.forEach(e=>{const f=p.value[e.id];if(f==null)return;let i=!1;e.type==="boolean"?i=C.boolean(f):e.type==="number"&&C.number[e.id]&&(i=C.number[e.id](f)),i&&l.push({...e,value:f,priority:Z(e.label)})}),l});function W(l){if(!l)return{};if(typeof l=="string")try{return JSON.parse(l)}catch{return{}}return l}function K(l){if(!l)return[];if(Array.isArray(l))return l;if(typeof l=="string")try{return JSON.parse(l)}catch{return[]}return[]}function Q(){L&&(k.value=!0,Pe(L).then(l=>{if(l.data){const e=l.data;u.value={inspectionId:e.inspectionId,inspectionNo:e.inspectionNo,inspectionDate:e.inspectionDate,floor:e.floor||"floor1",inspectorName:e.inspectorName,relayPersonId:e.relayPersonId,remark:e.remark||"",photos:K(e.photos)},p.value=W(e.items)}}).finally(()=>{k.value=!1}))}function X(l){return l==="basic"?x.value.slice(0,10):l==="pump"?x.value.slice(10,15):l==="cold"?x.value.slice(15):[]}function Z(l){for(const[e,f]of Object.entries(Oe))if(f.some(i=>l.includes(i)))return e;return"low"}function ee(l){return{high:"danger",medium:"warning",low:"info"}[l]||"info"}function le(l){return{high:"高",medium:"中",low:"低"}[l]||l}function ne(){return v.value===100?"success":v.value>0?"warning":"info"}function te(){return v.value===100?"已完成":v.value>0?"进行中":"未开始"}function oe(){p.value={},w.value=[]}function qe(l){}function ae(l,e){return e==null?!1:l.type==="boolean"?C.boolean(e):l.type==="number"&&C.number[l.id]?C.number[l.id](e):!1}function ue(l){return l.getTime()>Date.now()}function J(){O.$refs.inspectionRef.validate(l=>{if(l){k.value=!0;const e={...u.value,items:JSON.stringify(p.value||{}),photos:JSON.stringify(u.value.photos||[]),anomalyCount:g.value.length};Te(e).then(()=>{O.$modal.msgSuccess("保存成功"),M.push("/business/inspection")}).finally(()=>{k.value=!1})}})}function re(){if(w.value.length===0){O.$modal.msgWarning("请选择要生成工单的异常项");return}J()}function se(){O.$modal.confirm("确定要取消吗？未保存的数据将丢失").then(()=>{M.push("/business/inspection")}).catch(()=>{})}function ie(){E.value=[]}return xe(()=>{ie(),Q()}),(l,e)=>{const f=a("el-input"),i=a("el-form-item"),h=a("el-col"),de=a("el-date-picker"),T=a("el-row"),q=a("el-option"),F=a("el-select"),D=a("el-tag"),Y=a("el-divider"),pe=a("el-progress"),$=a("el-radio"),fe=a("el-radio-group"),ce=a("el-input-number"),me=a("el-tab-pane"),_e=a("el-tabs"),ve=a("el-alert"),ge=a("el-checkbox"),be=a("el-checkbox-group"),ye=a("image-upload"),Ve=a("el-form"),A=a("el-button"),ke=a("el-card");return s(),c("div",Ye,[t(ke,null,{header:n(()=>e[9]||(e[9]=[N("span",null,"编辑巡检记录",-1)])),default:n(()=>[t(Ve,{ref:"inspectionRef",model:u.value,rules:z,"label-width":"120px"},{default:n(()=>[t(T,null,{default:n(()=>[t(h,{span:12},{default:n(()=>[t(i,{label:"巡检编号"},{default:n(()=>[t(f,{modelValue:u.value.inspectionNo,"onUpdate:modelValue":e[0]||(e[0]=o=>u.value.inspectionNo=o),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),t(h,{span:12},{default:n(()=>[t(i,{label:"巡检日期",prop:"inspectionDate"},{default:n(()=>[t(de,{modelValue:u.value.inspectionDate,"onUpdate:modelValue":e[1]||(e[1]=o=>u.value.inspectionDate=o),type:"date",placeholder:"选择巡检日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","disabled-date":ue},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(T,null,{default:n(()=>[t(h,{span:12},{default:n(()=>[t(i,{label:"巡检楼层",prop:"floor"},{default:n(()=>[t(F,{modelValue:u.value.floor,"onUpdate:modelValue":e[2]||(e[2]=o=>u.value.floor=o),placeholder:"请选择楼层",onChange:oe},{default:n(()=>[(s(!0),c(V,null,U(De(we),o=>(s(),_(q,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(h,{span:12},{default:n(()=>[t(i,{label:"巡检人员",prop:"inspectorName"},{default:n(()=>[t(f,{modelValue:u.value.inspectorName,"onUpdate:modelValue":e[3]||(e[3]=o=>u.value.inspectorName=o),placeholder:"请输入巡检人员姓名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(T,null,{default:n(()=>[t(h,{span:12},{default:n(()=>[t(i,{label:"接力人员"},{default:n(()=>[t(F,{modelValue:u.value.relayPersonId,"onUpdate:modelValue":e[4]||(e[4]=o=>u.value.relayPersonId=o),placeholder:"请选择接力人员",clearable:""},{default:n(()=>[(s(!0),c(V,null,U(E.value,o=>(s(),_(q,{key:o.userId,label:o.nickName,value:o.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(h,{span:12},{default:n(()=>[t(i,{label:"巡检状态"},{default:n(()=>[t(D,{type:ne()},{default:n(()=>[d(m(te()),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1}),t(Y,{"content-position":"left"},{default:n(()=>e[10]||(e[10]=[d("巡检项目")])),_:1,__:[10]}),N("div",$e,[t(pe,{percentage:v.value,status:H.value},{default:n(()=>[N("span",null,m(B.value)+"/"+m(P.value)+"项",1)]),_:1},8,["percentage","status"])]),t(_e,{modelValue:j.value,"onUpdate:modelValue":e[5]||(e[5]=o=>j.value=o),type:"card"},{default:n(()=>[(s(!0),c(V,null,U(G.value,o=>(s(),_(me,{key:o.value,label:o.label,name:o.value},{default:n(()=>[(s(!0),c(V,null,U(X(o.value),r=>(s(),_(i,{key:r.id,label:r.label,prop:`items.${r.id}`},{default:n(()=>[r.type==="boolean"?(s(),c(V,{key:0},[t(fe,{modelValue:p.value[r.id],"onUpdate:modelValue":S=>p.value[r.id]=S,onChange:S=>void 0},{default:n(()=>[t($,{label:!0},{default:n(()=>e[11]||(e[11]=[d("正常")])),_:1,__:[11]}),t($,{label:!1},{default:n(()=>e[12]||(e[12]=[d("异常")])),_:1,__:[12]}),t($,{label:null},{default:n(()=>e[13]||(e[13]=[d("未检查")])),_:1,__:[13]})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),p.value[r.id]===!1?(s(),_(D,{key:0,type:"danger",style:{"margin-left":"10px"}},{default:n(()=>e[14]||(e[14]=[d(" 需要处理 ")])),_:1,__:[14]})):b("",!0)],64)):r.type==="number"?(s(),c(V,{key:1},[t(ce,{modelValue:p.value[r.id],"onUpdate:modelValue":S=>p.value[r.id]=S,min:0,precision:2,placeholder:`请输入${r.label}`,onChange:S=>void 0},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"]),N("span",Ae,m(r.unit),1),r.min!==void 0?(s(),c("span",Me," (正常范围: "+m(r.min)+"-"+m(r.max)+" "+m(r.unit)+") ",1)):b("",!0),ae(r,p.value[r.id])?(s(),_(D,{key:1,type:"danger",style:{"margin-left":"10px"}},{default:n(()=>e[15]||(e[15]=[d(" 超出范围 ")])),_:1,__:[15]})):b("",!0)],64)):b("",!0)]),_:2},1032,["label","prop"]))),128))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"]),g.value.length>0?(s(),_(Y,{key:0,"content-position":"left"},{default:n(()=>[e[16]||(e[16]=d(" 异常项汇总 ")),t(D,{type:"danger",style:{"margin-left":"10px"}},{default:n(()=>[d(m(g.value.length)+"项",1)]),_:1})]),_:1,__:[16]})):b("",!0),g.value.length>0?(s(),_(ve,{key:1,title:"发现异常项",type:"warning",description:`发现${g.value.length}个异常项，保存后可生成工单`,"show-icon":"",closable:!1},null,8,["description"])):b("",!0),g.value.length>0?(s(),c("div",Re,[t(be,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=o=>w.value=o)},{default:n(()=>[(s(!0),c(V,null,U(g.value,o=>(s(),c("div",{key:o.id,class:"anomaly-item"},[t(ge,{label:o.id},{default:n(()=>[N("span",Le,m(o.label),1),t(D,{size:"small",type:ee(o.priority)},{default:n(()=>[d(m(le(o.priority)),1)]),_:2},1032,["type"])]),_:2},1032,["label"])]))),128))]),_:1},8,["modelValue"])])):b("",!0),t(Y,{"content-position":"left"},{default:n(()=>e[17]||(e[17]=[d("其他信息")])),_:1,__:[17]}),t(i,{label:"备注"},{default:n(()=>[t(f,{modelValue:u.value.remark,"onUpdate:modelValue":e[7]||(e[7]=o=>u.value.remark=o),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(i,{label:"现场照片"},{default:n(()=>[t(ye,{modelValue:u.value.photos,"onUpdate:modelValue":e[8]||(e[8]=o=>u.value.photos=o),limit:5,fileSize:10,fileType:["jpg","jpeg","png","gif"],isShowTip:!0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),N("div",je,[t(A,{onClick:se},{default:n(()=>e[18]||(e[18]=[d("取 消")])),_:1,__:[18]}),t(A,{type:"primary",onClick:J,loading:k.value},{default:n(()=>e[19]||(e[19]=[d("保 存")])),_:1,__:[19]},8,["loading"]),g.value.length>0?(s(),_(A,{key:0,type:"success",onClick:re,loading:k.value},{default:n(()=>e[20]||(e[20]=[d(" 保存并生成工单 ")])),_:1,__:[20]},8,["loading"])):b("",!0)])]),_:1})])}}}),Ke=Se(Be,[["__scopeId","data-v-03edfc57"]]);export{Ke as default};
