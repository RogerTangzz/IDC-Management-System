import{k as he,g as qe,ar as $e,ap as De,r as k,P as xe,a7 as Ae,ac as c,ag as le,l as O,m,D as v,J as l,K as te,C as t,Z as ae,u as n,I as ne,$ as oe,B as _,G as r,q as $,H as R,E as Re}from"./vue-SR65qDCS.js";import{m as Q,a4 as Ye,a5 as Be,a6 as Pe,a7 as ze,a2 as Fe,a8 as Le,a9 as Me,a3 as Ee}from"./index-Cw83YE5u.js";import"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const He={class:"app-container"},Ke={class:"dialog-footer"},Oe={class:"dialog-footer"},Qe=he({name:"Ticket"}),Xe=Object.assign(Qe,{setup(je){const{proxy:b}=qe(),j=$e(),Y=De(),{ticket_status:W,equipment_specialty:ie,ticket_action:ue}=b.useDict("ticket_status","equipment_specialty","ticket_action"),D=k([]),C=k(!1),U=k(!1),B=k(!0),P=k(!0),N=k([]),Z=k(!0),z=k(!0),F=k(0),x=k(""),I=k([]),L=k([]),h=k(""),de=xe({form:{},assignForm:{userId:void 0},queryParams:{pageNum:1,pageSize:10,orderByColumn:void 0,isAsc:void 0,ticketNo:void 0,title:void 0,status:void 0,priority:void 0,equipment:void 0,reporterName:void 0},rules:{title:[{required:!0,message:"工单标题不能为空",trigger:"blur"}],priority:[{required:!0,message:"优先级不能为空",trigger:"change"}],reporterName:[{required:!0,message:"报修人不能为空",trigger:"blur"}],equipment:[{required:!0,message:"故障设备不能为空",trigger:"blur"}],description:[{required:!0,message:"故障描述不能为空",trigger:"blur"}]}}),{queryParams:s,form:u,assignForm:S,rules:se}=Ae(de);async function y(){B.value=!0;try{const o={...s.value};I.value&&I.value.length===2&&(o.beginTime=`${I.value[0]} 00:00:00`,o.endTime=`${I.value[1]} 23:59:59`);let e,d;if(h.value==="overdue"){const i=await Ye({pageNum:o.pageNum,pageSize:o.pageSize});e=i.data||i.rows,d=i.total}else if(h.value==="neardue"){const i=await Be({pageNum:o.pageNum,pageSize:o.pageSize});e=i.data||i.rows,d=i.total}else{const i=await Pe(o);e=i.data,d=i.total}D.value=e||[],F.value=d||0}finally{B.value=!1}}function re({prop:o,order:e}){const d=i=>i.replace(/([A-Z])/g,"_$1").toLowerCase();s.value.orderByColumn=o?d(o):void 0,s.value.isAsc=e==="ascending"?"asc":e==="descending"?"desc":void 0,y()}function pe(){C.value=!1,M()}function M(){u.value={ticketId:void 0,ticketNo:void 0,title:void 0,priority:"medium",status:"pending",reporterName:void 0,equipment:void 0,specialty:void 0,description:void 0,emergencyAction:void 0,discoveryTime:void 0},b.resetForm("ticketRef")}function A(){s.value.pageNum=1,y()}function me(){I.value=[],b.resetForm("queryRef"),h.value="",A()}function ce(o){N.value=o.map(e=>e.ticketId),Z.value=o.length!=1,z.value=!o.length}function fe(o){const e=o.ticketId||N.value[0];j.push(`/business/ticket/detail/${e}`)}function ge(){M(),C.value=!0,x.value="添加工单"}async function G(o){M();const e=o||D.value.find(d=>d.ticketId===N.value[0]);e&&(u.value={...e},C.value=!0,x.value="修改工单")}if(Y.name==="TicketEdit"&&Y.params.ticketId){const o=Y.params.ticketId;y().then(()=>{const e=D.value.find(d=>String(d.ticketId)===String(o));e?(u.value={...e},C.value=!0,x.value="修改工单"):j.replace("/business/ticket/list")})}function ve(){b.$refs.ticketRef.validate(async o=>{if(!o)return;const e={...u.value};e.ticketId?(await Me(e),b.$modal.msgSuccess("修改成功")):(await Le(e),b.$modal.msgSuccess("新增成功")),C.value=!1,y()})}function J(o){const e=Array.isArray(N.value)&&N.value.length>0&&!(o!=null&&o.ticketId)?N.value:[o.ticketId];b.$modal.confirm('是否确认删除工单编号为"'+e.join(",")+'"的数据项？').then(async()=>{for(const d of e)await ze(d);b.$modal.msgSuccess("删除成功"),y()}).catch(()=>{})}function _e(o){const e=o.ticketId;b.$modal.confirm("确认重新打开该工单？").then(async()=>{await Fe(e),b.$modal.msgSuccess("已重新打开"),y()}).catch(()=>{})}function be(){S.value.userId=void 0,U.value=!0,L.value=[{userId:1,nickName:"张三"},{userId:2,nickName:"李四"},{userId:3,nickName:"王五"}]}async function ke(){if(!S.value.userId){b.$modal.msgWarning("请选择处理人");return}const o=L.value.find(e=>e.userId===S.value.userId);o&&(await Ee({ticketIds:N.value,assigneeId:o.userId,assigneeName:o.nickName}),b.$modal.msgSuccess("指派成功"),U.value=!1,y())}function ye(){b.$modal.msgSuccess("导出功能待实现")}function we(){h.value="overdue",s.value.pageNum=1,y()}function Ve(){h.value="neardue",s.value.pageNum=1,y()}function Ce(o){return{high:"高",medium:"中",low:"低"}[o]||o}return y(),(o,e)=>{const d=c("el-input"),i=c("el-form-item"),w=c("el-option"),q=c("el-select"),X=c("el-date-picker"),p=c("el-button"),E=c("el-form"),f=c("el-col"),Ne=c("right-toolbar"),T=c("el-row"),g=c("el-table-column"),H=c("dict-tag"),Ie=c("el-tag"),Se=c("el-table"),Te=c("pagination"),ee=c("el-dialog"),V=le("hasPermi"),Ue=le("loading");return m(),O("div",He,[v(l(E,{model:n(s),ref:"queryRef",inline:!0,"label-width":"68px"},{default:t(()=>[l(i,{label:"工单编号",prop:"ticketNo"},{default:t(()=>[l(d,{modelValue:n(s).ticketNo,"onUpdate:modelValue":e[0]||(e[0]=a=>n(s).ticketNo=a),placeholder:"请输入工单编号",clearable:"",onKeyup:ae(A,["enter"])},null,8,["modelValue"])]),_:1}),l(i,{label:"标题",prop:"title"},{default:t(()=>[l(d,{modelValue:n(s).title,"onUpdate:modelValue":e[1]||(e[1]=a=>n(s).title=a),placeholder:"请输入标题",clearable:"",onKeyup:ae(A,["enter"])},null,8,["modelValue"])]),_:1}),l(i,{label:"状态",prop:"status"},{default:t(()=>[l(q,{modelValue:n(s).status,"onUpdate:modelValue":e[2]||(e[2]=a=>n(s).status=a),placeholder:"请选择状态",clearable:""},{default:t(()=>[(m(!0),O(ne,null,oe(n(W),a=>(m(),_(w,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"优先级",prop:"priority"},{default:t(()=>[l(q,{modelValue:n(s).priority,"onUpdate:modelValue":e[3]||(e[3]=a=>n(s).priority=a),placeholder:"请选择优先级",clearable:""},{default:t(()=>[l(w,{label:"高",value:"high"}),l(w,{label:"中",value:"medium"}),l(w,{label:"低",value:"low"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"创建时间"},{default:t(()=>[l(X,{modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=a=>I.value=a),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(p,{type:"primary",icon:"Search",onClick:A},{default:t(()=>e[20]||(e[20]=[r("搜索")])),_:1,__:[20]}),l(p,{icon:"Refresh",onClick:me},{default:t(()=>e[21]||(e[21]=[r("重置")])),_:1,__:[21]})]),_:1})]),_:1},8,["model"]),[[te,P.value]]),l(T,{gutter:10,class:"mb8"},{default:t(()=>[l(f,{span:1.5},{default:t(()=>[v((m(),_(p,{type:"primary",plain:"",icon:"Plus",onClick:ge},{default:t(()=>e[22]||(e[22]=[r("新增")])),_:1,__:[22]})),[[V,["business:ticket:add"]]])]),_:1}),l(f,{span:1.5},{default:t(()=>[v((m(),_(p,{type:"success",plain:"",icon:"Edit",disabled:Z.value,onClick:G},{default:t(()=>e[23]||(e[23]=[r("修改")])),_:1,__:[23]},8,["disabled"])),[[V,["business:ticket:edit"]]])]),_:1}),l(f,{span:1.5},{default:t(()=>[v((m(),_(p,{type:"danger",plain:"",icon:"Delete",disabled:z.value,onClick:J},{default:t(()=>e[24]||(e[24]=[r("删除")])),_:1,__:[24]},8,["disabled"])),[[V,["business:ticket:remove"]]])]),_:1}),l(f,{span:1.5},{default:t(()=>[v((m(),_(p,{type:"info",plain:"",icon:"User",disabled:z.value,onClick:be},{default:t(()=>e[25]||(e[25]=[r("批量指派")])),_:1,__:[25]},8,["disabled"])),[[V,["business:ticket:assign"]]])]),_:1}),l(f,{span:1.5},{default:t(()=>[v((m(),_(p,{type:"warning",plain:"",icon:"Download",onClick:ye},{default:t(()=>e[26]||(e[26]=[r("导出")])),_:1,__:[26]})),[[V,["business:ticket:export"]]])]),_:1}),l(f,{span:1.5},{default:t(()=>[v((m(),_(p,{type:"danger",plain:"",icon:"WarningFilled",onClick:we},{default:t(()=>e[27]||(e[27]=[r("逾期")])),_:1,__:[27]})),[[V,["business:ticket:list"]]])]),_:1}),l(f,{span:1.5},{default:t(()=>[v((m(),_(p,{type:"warning",plain:"",icon:"Bell",onClick:Ve},{default:t(()=>e[28]||(e[28]=[r("近到期")])),_:1,__:[28]})),[[V,["business:ticket:list"]]])]),_:1}),l(Ne,{showSearch:P.value,"onUpdate:showSearch":e[5]||(e[5]=a=>P.value=a),onQueryTable:y},null,8,["showSearch"])]),_:1}),v((m(),_(Se,{data:D.value,onSelectionChange:ce,onSortChange:re},{default:t(()=>[l(g,{type:"selection",width:"55",align:"center"}),l(g,{label:"工单编号",align:"center",prop:"ticketNo",width:"120"}),l(g,{label:"标题",align:"center",prop:"title","show-overflow-tooltip":!0}),l(g,{label:"状态",align:"center",prop:"status",width:"100"},{default:t(a=>[l(H,{options:n(W),value:a.row.status},null,8,["options","value"])]),_:1}),l(g,{label:"最新动作",align:"center",prop:"lastAction",width:"100"},{default:t(a=>[l(H,{options:n(ue),value:a.row.lastAction},null,8,["options","value"])]),_:1}),l(g,{label:"最新状态时间",align:"center",prop:"lastStatusTime",width:"160",sortable:"custom"},{default:t(a=>[$("span",null,R(n(Q)(a.row.lastStatusTime)),1)]),_:1}),l(g,{label:"优先级",align:"center",prop:"priority",width:"80"},{default:t(a=>[l(Ie,{type:a.row.priority==="high"?"danger":a.row.priority==="medium"?"warning":"info"},{default:t(()=>[r(R(Ce(a.row.priority)),1)]),_:2},1032,["type"])]),_:1}),l(g,{label:"报修人",align:"center",prop:"reporterName",width:"100"}),l(g,{label:"故障设备",align:"center",prop:"equipment",width:"120"}),l(g,{label:"设备专业",align:"center",prop:"specialty",width:"100"},{default:t(a=>[l(H,{options:n(ie),value:a.row.specialty},null,8,["options","value"])]),_:1}),l(g,{label:"指派给",align:"center",prop:"assigneeName",width:"100"}),l(g,{label:"处理时限",align:"center",prop:"deadline",width:"160"},{default:t(a=>[$("span",null,R(n(Q)(a.row.deadline)),1)]),_:1}),l(g,{label:"创建时间",align:"center",prop:"createTime",width:"160",sortable:"custom"},{default:t(a=>[$("span",null,R(n(Q)(a.row.createTime)),1)]),_:1}),l(g,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"240"},{default:t(a=>[v((m(),_(p,{link:"",type:"primary",icon:"View",onClick:K=>fe(a.row)},{default:t(()=>e[29]||(e[29]=[r("查看")])),_:2,__:[29]},1032,["onClick"])),[[V,["business:ticket:query"]]]),v((m(),_(p,{link:"",type:"primary",icon:"Edit",onClick:K=>G(a.row)},{default:t(()=>e[30]||(e[30]=[r("修改")])),_:2,__:[30]},1032,["onClick"])),[[V,["business:ticket:edit"]]]),v((m(),_(p,{link:"",type:"primary",icon:"Delete",onClick:K=>J(a.row)},{default:t(()=>e[31]||(e[31]=[r("删除")])),_:2,__:[31]},1032,["onClick"])),[[V,["business:ticket:remove"]]]),a.row.status==="closed"?v((m(),_(p,{key:0,link:"",type:"primary",icon:"RefreshLeft",onClick:K=>_e(a.row)},{default:t(()=>e[32]||(e[32]=[r("重开")])),_:2,__:[32]},1032,["onClick"])),[[V,["business:ticket:reopen"]]]):Re("",!0)]),_:1})]),_:1},8,["data"])),[[Ue,B.value]]),v(l(Te,{total:F.value,page:n(s).pageNum,"onUpdate:page":e[6]||(e[6]=a=>n(s).pageNum=a),limit:n(s).pageSize,"onUpdate:limit":e[7]||(e[7]=a=>n(s).pageSize=a),onPagination:y},null,8,["total","page","limit"]),[[te,F.value>0]]),l(ee,{title:x.value,modelValue:C.value,"onUpdate:modelValue":e[16]||(e[16]=a=>C.value=a),width:"800px","append-to-body":""},{footer:t(()=>[$("div",Ke,[l(p,{type:"primary",onClick:ve},{default:t(()=>e[33]||(e[33]=[r("确 定")])),_:1,__:[33]}),l(p,{onClick:pe},{default:t(()=>e[34]||(e[34]=[r("取 消")])),_:1,__:[34]})])]),default:t(()=>[l(E,{ref:"ticketRef",model:n(u),rules:n(se),"label-width":"100px"},{default:t(()=>[l(T,null,{default:t(()=>[l(f,{span:12},{default:t(()=>[l(i,{label:"工单标题",prop:"title"},{default:t(()=>[l(d,{modelValue:n(u).title,"onUpdate:modelValue":e[8]||(e[8]=a=>n(u).title=a),placeholder:"请输入工单标题"},null,8,["modelValue"])]),_:1})]),_:1}),l(f,{span:12},{default:t(()=>[l(i,{label:"优先级",prop:"priority"},{default:t(()=>[l(q,{modelValue:n(u).priority,"onUpdate:modelValue":e[9]||(e[9]=a=>n(u).priority=a),placeholder:"请选择优先级"},{default:t(()=>[l(w,{label:"高",value:"high"}),l(w,{label:"中",value:"medium"}),l(w,{label:"低",value:"low"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(T,null,{default:t(()=>[l(f,{span:12},{default:t(()=>[l(i,{label:"报修人",prop:"reporterName"},{default:t(()=>[l(d,{modelValue:n(u).reporterName,"onUpdate:modelValue":e[10]||(e[10]=a=>n(u).reporterName=a),placeholder:"请输入报修人"},null,8,["modelValue"])]),_:1})]),_:1}),l(f,{span:12},{default:t(()=>[l(i,{label:"故障设备",prop:"equipment"},{default:t(()=>[l(d,{modelValue:n(u).equipment,"onUpdate:modelValue":e[11]||(e[11]=a=>n(u).equipment=a),placeholder:"请输入故障设备"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(T,null,{default:t(()=>[l(f,{span:12},{default:t(()=>[l(i,{label:"设备专业",prop:"specialty"},{default:t(()=>[l(q,{modelValue:n(u).specialty,"onUpdate:modelValue":e[12]||(e[12]=a=>n(u).specialty=a),placeholder:"请选择设备专业"},{default:t(()=>[l(w,{label:"暖通",value:"hvac"}),l(w,{label:"配电",value:"power"}),l(w,{label:"消防",value:"fire"}),l(w,{label:"弱电",value:"weak"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(f,{span:12},{default:t(()=>[l(i,{label:"发现时间",prop:"discoveryTime"},{default:t(()=>[l(X,{modelValue:n(u).discoveryTime,"onUpdate:modelValue":e[13]||(e[13]=a=>n(u).discoveryTime=a),type:"datetime",placeholder:"选择故障发现时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(T,null,{default:t(()=>[l(f,{span:24},{default:t(()=>[l(i,{label:"故障描述",prop:"description"},{default:t(()=>[l(d,{modelValue:n(u).description,"onUpdate:modelValue":e[14]||(e[14]=a=>n(u).description=a),type:"textarea",rows:4,placeholder:"请输入故障描述"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(T,null,{default:t(()=>[l(f,{span:24},{default:t(()=>[l(i,{label:"应急处置",prop:"emergencyAction"},{default:t(()=>[l(d,{modelValue:n(u).emergencyAction,"onUpdate:modelValue":e[15]||(e[15]=a=>n(u).emergencyAction=a),type:"textarea",rows:3,placeholder:"请输入应急处置方法"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(ee,{title:"批量指派",modelValue:U.value,"onUpdate:modelValue":e[19]||(e[19]=a=>U.value=a),width:"400px","append-to-body":""},{footer:t(()=>[$("div",Oe,[l(p,{type:"primary",onClick:ke},{default:t(()=>e[35]||(e[35]=[r("确 定")])),_:1,__:[35]}),l(p,{onClick:e[18]||(e[18]=a=>U.value=!1)},{default:t(()=>e[36]||(e[36]=[r("取 消")])),_:1,__:[36]})])]),default:t(()=>[l(E,{ref:"assignRef",model:n(S),"label-width":"80px"},{default:t(()=>[l(i,{label:"指派给",prop:"userId"},{default:t(()=>[l(q,{modelValue:n(S).userId,"onUpdate:modelValue":e[17]||(e[17]=a=>n(S).userId=a),placeholder:"请选择处理人"},{default:t(()=>[(m(!0),O(ne,null,oe(L.value,a=>(m(),_(w,{key:a.userId,label:a.nickName,value:a.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{Xe as default};
