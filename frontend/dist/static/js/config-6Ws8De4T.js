import{j as xe,k as Fe,a as c,E as N}from"./element-D8D5Bqo2.js";import{_ as Ue,F as $,I as qe,i as Y}from"./index-Cw83YE5u.js";import{r as g,P as he,c as j,d as Te,ac as s,ag as De,l as y,m as d,J as l,C as a,q as h,G as r,I as P,$ as M,u as T,B,D as $e,H as k,E as Be}from"./vue-SR65qDCS.js";import"./vendor-C71Ev03J.js";const Ee={class:"inspection-config"},Ie={class:"header-actions"},Se={class:"left"},Ne={class:"right"},Pe={class:"statistics-bar"},Me={class:"sort-buttons"},Re={key:0},ze={key:1},Oe={key:0},Le={__name:"config",setup(je){const R=g(!1),m=g("floor1"),C=g(!1),D=g(!1),x=g(!1),A=g(),w=he({floor1:[],floor2:[],floor3:[],floor4:[]}),p=j(()=>w[m.value]||[]),E=j(()=>{const t=p.value;return{total:t.length,required:t.length,number:t.filter(e=>e.type==="number").length,boolean:t.filter(e=>e.type==="boolean").length}}),Z=j(()=>x.value?"编辑检查项":"新增检查项"),n=g({id:"",floor:"floor1",label:"",type:"boolean",min:0,max:100,unit:"",seq:1,enabled:!0}),v=g({sourceFloor:"",targetFloor:""}),ee={id:[{required:!0,message:"请输入项目ID",trigger:"blur"}],floor:[{required:!0,message:"请选择楼层",trigger:"change"}],label:[{required:!0,message:"请输入检查项目名称",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],min:[{validator:(t,e,u)=>{n.value.type==="number"&&(e===void 0||e==="")?u(new Error("请输入最小值")):u()},trigger:"blur"}],max:[{validator:(t,e,u)=>{n.value.type==="number"&&(e===void 0||e==="")?u(new Error("请输入最大值")):n.value.type==="number"&&e<=n.value.min?u(new Error("最大值必须大于最小值")):u()},trigger:"blur"}]},z=t=>{R.value=!0;try{const e=qe[t]||[];w[t]=e.map(u=>({...u,enabled:!0}))}finally{R.value=!1}},le=()=>{z(m.value)},ae=()=>{x.value=!1,n.value={id:"",floor:m.value,label:"",type:"boolean",min:0,max:100,unit:"",seq:p.value.length+1,enabled:!0},C.value=!0},te=t=>{x.value=!0,n.value={...t},C.value=!0},oe=async t=>{await N.confirm(`确定删除检查项"${t.label}"吗？`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=p.value.findIndex(u=>u.id===t.id);e>-1&&p.value.splice(e,1),c.success("删除成功")},ne=async()=>{var t;if(await((t=A.value)==null?void 0:t.validate()),x.value){const e=p.value.findIndex(u=>u.id===n.value.id);e>-1&&(p.value[e]={...n.value}),c.success("更新成功")}else p.value.push({...n.value}),c.success("新增成功");C.value=!1},ue=()=>{n.value.type==="boolean"?(n.value.min=void 0,n.value.max=void 0,n.value.unit=""):(n.value.min=0,n.value.max=100)},ie=t=>{c.success(t.enabled?"已启用":"已禁用")},se=t=>{if(t===0)return;const e=[...p.value];[e[t],e[t-1]]=[e[t-1],e[t]],[e[t].seq,e[t-1].seq]=[e[t-1].seq,e[t].seq],w[m.value]=e},re=t=>{const e=[...p.value];t!==e.length-1&&([e[t],e[t+1]]=[e[t+1],e[t]],[e[t].seq,e[t+1].seq]=[e[t+1].seq,e[t].seq],w[m.value]=e)},de=()=>{var I;const t=p.value,e=JSON.stringify(t,null,2),u=new Blob([e],{type:"application/json"}),F=document.createElement("a");F.href=window.URL.createObjectURL(u),F.download=`巡检配置_${(I=$.find(U=>U.value===m.value))==null?void 0:I.label}_${new Date().getTime()}.json`,F.click(),c.success("导出成功")},me=()=>{v.value={sourceFloor:m.value,targetFloor:""},D.value=!0},pe=async()=>{if(!v.value.targetFloor){c.warning("请选择目标楼层");return}await N.confirm("复制操作将覆盖目标楼层的现有配置，是否继续？","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),w[v.value.targetFloor]=JSON.parse(JSON.stringify(w[v.value.sourceFloor])),c.success("复制成功"),D.value=!1,m.value=v.value.targetFloor},ve=async()=>{await N.confirm("恢复默认配置将覆盖当前楼层的所有自定义配置，是否继续？","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),z(m.value),c.success("已恢复默认配置")},_e=t=>{const e=Y(t);return{high:"danger",medium:"warning",low:"info"}[e]||"info"},fe=t=>{const e=Y(t);return{high:"高",medium:"中",low:"低"}[e]||"低"},be=t=>{var e;return((e=w[t])==null?void 0:e.length)||0},ce=()=>{N.alert(`
    <h4>巡检配置说明</h4>
    <ul style="line-height: 1.8">
      <li><b>检查项目</b>：定义每个楼层需要检查的项目</li>
      <li><b>数据类型</b>：
        <ul style="margin-top: 5px">
          <li>布尔型：只有正常/异常两种状态</li>
          <li>数值型：需要记录具体数值，并设置正常范围</li>
        </ul>
      </li>
      <li><b>异常优先级</b>：系统根据关键词自动判定优先级
        <ul style="margin-top: 5px">
          <li>高优先级：氢气、消防、漏水、漏油、UPS等</li>
          <li>中优先级：温度、湿度、压力、电气间等</li>
          <li>低优先级：卫生、照明、噪音等</li>
        </ul>
      </li>
      <li><b>排序</b>：可以调整检查项的显示顺序</li>
    </ul>
    `,"配置说明",{dangerouslyUseHTMLString:!0,confirmButtonText:"知道了"})};return Te(()=>{z(m.value)}),(t,e)=>{const u=s("el-button"),F=s("el-card"),I=s("el-badge"),U=s("el-statistic"),V=s("el-col"),J=s("el-row"),b=s("el-table-column"),H=s("el-icon"),O=s("el-tag"),W=s("el-switch"),ge=s("el-table"),ye=s("el-tab-pane"),we=s("el-tabs"),G=s("el-input"),_=s("el-form-item"),f=s("el-option"),S=s("el-select"),Q=s("el-radio"),Ve=s("el-radio-group"),L=s("el-input-number"),K=s("el-form"),X=s("el-dialog"),ke=s("el-alert"),Ce=De("loading");return d(),y("div",Ee,[l(F,{class:"header-card"},{default:a(()=>[h("div",Ie,[h("div",Se,[l(u,{type:"primary",icon:"Plus",onClick:ae},{default:a(()=>e[16]||(e[16]=[r("新增检查项")])),_:1,__:[16]}),l(u,{icon:"Download",onClick:de},{default:a(()=>e[17]||(e[17]=[r("导出配置")])),_:1,__:[17]}),l(u,{icon:"CopyDocument",onClick:me},{default:a(()=>e[18]||(e[18]=[r("复制楼层配置")])),_:1,__:[18]}),l(u,{type:"warning",icon:"RefreshRight",onClick:ve},{default:a(()=>e[19]||(e[19]=[r("恢复默认")])),_:1,__:[19]})]),h("div",Ne,[l(u,{type:"info",icon:"QuestionFilled",onClick:ce},{default:a(()=>e[20]||(e[20]=[r("配置说明")])),_:1,__:[20]})])])]),_:1}),l(F,null,{default:a(()=>[l(we,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),onTabChange:le},{default:a(()=>[(d(!0),y(P,null,M(T($),o=>(d(),B(ye,{key:o.value,name:o.value},{label:a(()=>[h("span",null,[r(k(o.label)+" ",1),l(I,{value:be(o.value),class:"item-badge"},null,8,["value"])])]),default:a(()=>[h("div",Pe,[l(J,{gutter:20},{default:a(()=>[l(V,{span:6},{default:a(()=>[l(U,{title:"检查项总数",value:E.value.total},null,8,["value"])]),_:1}),l(V,{span:6},{default:a(()=>[l(U,{title:"必检项",value:E.value.required,"value-style":"color: #f56c6c"},null,8,["value"])]),_:1}),l(V,{span:6},{default:a(()=>[l(U,{title:"数值型",value:E.value.number},null,8,["value"])]),_:1}),l(V,{span:6},{default:a(()=>[l(U,{title:"布尔型",value:E.value.boolean},null,8,["value"])]),_:1})]),_:1})]),$e((d(),B(ge,{data:p.value,"row-key":"id",stripe:""},{default:a(()=>[l(b,{type:"index",label:"序号",width:"60",align:"center"}),l(b,{label:"排序",width:"80",align:"center"},{default:a(i=>[h("div",Me,[l(u,{link:"",size:"small",disabled:i.$index===0,onClick:q=>se(i.$index)},{default:a(()=>[l(H,null,{default:a(()=>[l(T(xe))]),_:1})]),_:2},1032,["disabled","onClick"]),l(u,{link:"",size:"small",disabled:i.$index===p.value.length-1,onClick:q=>re(i.$index)},{default:a(()=>[l(H,null,{default:a(()=>[l(T(Fe))]),_:1})]),_:2},1032,["disabled","onClick"])])]),_:1}),l(b,{prop:"id",label:"项目ID",width:"150"},{default:a(i=>[l(O,{size:"small"},{default:a(()=>[r(k(i.row.id),1)]),_:2},1024)]),_:1}),l(b,{prop:"label",label:"检查项目","min-width":"300","show-overflow-tooltip":""}),l(b,{prop:"type",label:"数据类型",width:"100",align:"center"},{default:a(i=>[l(O,{type:i.row.type==="boolean"?"success":"primary",size:"small"},{default:a(()=>[r(k(i.row.type==="boolean"?"布尔":"数值"),1)]),_:2},1032,["type"])]),_:1}),l(b,{label:"正常范围",width:"150",align:"center"},{default:a(i=>[i.row.type==="boolean"?(d(),y("span",Re," 正常 = True ")):(d(),y("span",ze,k(i.row.min)+"-"+k(i.row.max)+" "+k(i.row.unit),1))]),_:1}),l(b,{label:"异常优先级",width:"100",align:"center"},{default:a(i=>[l(O,{type:_e(i.row.label),size:"small"},{default:a(()=>[r(k(fe(i.row.label)),1)]),_:2},1032,["type"])]),_:1}),l(b,{label:"启用状态",width:"80",align:"center"},{default:a(i=>[l(W,{modelValue:i.row.enabled,"onUpdate:modelValue":q=>i.row.enabled=q,onChange:q=>ie(i.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(b,{label:"操作",width:"120",align:"center",fixed:"right"},{default:a(i=>[l(u,{link:"",type:"primary",size:"small",onClick:q=>te(i.row)},{default:a(()=>e[21]||(e[21]=[r("编辑")])),_:2,__:[21]},1032,["onClick"]),l(u,{link:"",type:"danger",size:"small",onClick:q=>oe(i.row)},{default:a(()=>e[22]||(e[22]=[r("删除")])),_:2,__:[22]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ce,R.value]])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(X,{title:Z.value,modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=o=>C.value=o),width:"700px","close-on-click-modal":!1},{footer:a(()=>[l(u,{onClick:e[10]||(e[10]=o=>C.value=!1)},{default:a(()=>e[25]||(e[25]=[r("取消")])),_:1,__:[25]}),l(u,{type:"primary",onClick:ne},{default:a(()=>e[26]||(e[26]=[r("确定")])),_:1,__:[26]})]),default:a(()=>[l(K,{ref_key:"formRef",ref:A,model:n.value,rules:ee,"label-width":"100px"},{default:a(()=>[l(_,{label:"项目ID",prop:"id"},{default:a(()=>[l(G,{modelValue:n.value.id,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.id=o),placeholder:"如：oil_tank",disabled:x.value},null,8,["modelValue","disabled"])]),_:1}),l(_,{label:"所属楼层",prop:"floor"},{default:a(()=>[l(S,{modelValue:n.value.floor,"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.floor=o),placeholder:"请选择楼层",disabled:x.value},{default:a(()=>[(d(!0),y(P,null,M(T($),o=>(d(),B(f,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(_,{label:"检查项目",prop:"label"},{default:a(()=>[l(G,{modelValue:n.value.label,"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.label=o),placeholder:"请输入检查项目名称"},null,8,["modelValue"])]),_:1}),l(_,{label:"数据类型",prop:"type"},{default:a(()=>[l(Ve,{modelValue:n.value.type,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.type=o),onChange:ue},{default:a(()=>[l(Q,{label:"boolean"},{default:a(()=>e[23]||(e[23]=[r("布尔型（正常/异常）")])),_:1,__:[23]}),l(Q,{label:"number"},{default:a(()=>e[24]||(e[24]=[r("数值型（需要范围）")])),_:1,__:[24]})]),_:1},8,["modelValue"])]),_:1}),n.value.type==="number"?(d(),y("div",Oe,[l(J,{gutter:20},{default:a(()=>[l(V,{span:8},{default:a(()=>[l(_,{label:"最小值",prop:"min"},{default:a(()=>[l(L,{modelValue:n.value.min,"onUpdate:modelValue":e[5]||(e[5]=o=>n.value.min=o),precision:2,step:.1},null,8,["modelValue"])]),_:1})]),_:1}),l(V,{span:8},{default:a(()=>[l(_,{label:"最大值",prop:"max"},{default:a(()=>[l(L,{modelValue:n.value.max,"onUpdate:modelValue":e[6]||(e[6]=o=>n.value.max=o),precision:2,step:.1},null,8,["modelValue"])]),_:1})]),_:1}),l(V,{span:8},{default:a(()=>[l(_,{label:"单位",prop:"unit"},{default:a(()=>[l(S,{modelValue:n.value.unit,"onUpdate:modelValue":e[7]||(e[7]=o=>n.value.unit=o),placeholder:"请选择单位","allow-create":"",filterable:""},{default:a(()=>[l(f,{label:"°C",value:"°C"}),l(f,{label:"%",value:"%"}),l(f,{label:"MPa",value:"MPa"}),l(f,{label:"ppm",value:"ppm"}),l(f,{label:"V",value:"V"}),l(f,{label:"A",value:"A"}),l(f,{label:"kW",value:"kW"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])):Be("",!0),l(_,{label:"排序",prop:"seq"},{default:a(()=>[l(L,{modelValue:n.value.seq,"onUpdate:modelValue":e[8]||(e[8]=o=>n.value.seq=o),min:1,max:999},null,8,["modelValue"])]),_:1}),l(_,{label:"启用状态"},{default:a(()=>[l(W,{modelValue:n.value.enabled,"onUpdate:modelValue":e[9]||(e[9]=o=>n.value.enabled=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(X,{title:"复制楼层配置",modelValue:D.value,"onUpdate:modelValue":e[15]||(e[15]=o=>D.value=o),width:"500px"},{footer:a(()=>[l(u,{onClick:e[14]||(e[14]=o=>D.value=!1)},{default:a(()=>e[27]||(e[27]=[r("取消")])),_:1,__:[27]}),l(u,{type:"primary",onClick:pe},{default:a(()=>e[28]||(e[28]=[r("确定复制")])),_:1,__:[28]})]),default:a(()=>[l(K,{model:v.value,"label-width":"100px"},{default:a(()=>[l(_,{label:"源楼层"},{default:a(()=>[l(S,{modelValue:v.value.sourceFloor,"onUpdate:modelValue":e[12]||(e[12]=o=>v.value.sourceFloor=o),placeholder:"请选择源楼层"},{default:a(()=>[(d(!0),y(P,null,M(T($),o=>(d(),B(f,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"目标楼层"},{default:a(()=>[l(S,{modelValue:v.value.targetFloor,"onUpdate:modelValue":e[13]||(e[13]=o=>v.value.targetFloor=o),placeholder:"请选择目标楼层"},{default:a(()=>[(d(!0),y(P,null,M(T($),o=>(d(),B(f,{key:o.value,label:o.label,value:o.value,disabled:o.value===v.value.sourceFloor},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ke,{title:"注意：复制操作将覆盖目标楼层的现有配置",type:"warning",closable:!1,"show-icon":""})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ge=Ue(Le,[["__scopeId","data-v-0aa6524b"]]);export{Ge as default};
