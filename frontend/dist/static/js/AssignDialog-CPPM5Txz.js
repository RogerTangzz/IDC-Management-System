import{t as w}from"./ticket-B-hP2oPw.js";import{a as P}from"./user-brpwFzy8.js";import{_ as S}from"./index-Cw83YE5u.js";import{a as V}from"./element-D8D5Bqo2.js";import{r as u,P as T,ac as n,B as x,m as _,C as t,l as I,E as W,J as l,I as j,$ as K,q as N,H as C,G as i}from"./vue-SR65qDCS.js";import"./vendor-C71Ev03J.js";const O={key:0,class:"ticket-info"},Q={style:{float:"left"}},X={style:{float:"right",color:"#8492a6","font-size":"13px"}},Y={__name:"AssignDialog",emits:["success"],setup(Z,{expose:M,emit:U}){const A=U,r=u(!1),c=u(!1),y=u(),d=u([]),p=u([]),o=T({assigneeId:void 0,priority:"keep",comment:"",notifyMethod:["system"],notifyNow:!0}),B={assigneeId:[{required:!0,message:"请选择指派工程师",trigger:"change"}]},$=async s=>{d.value=s||[],r.value=!0,b(),await h()},h=async()=>{try{const s=await P.list({role:"engineer"});p.value=s.data||[];for(const e of p.value){const g=await w.getWorkload(e.id);e.workload=g.data||0}}catch(s){console.error("加载工程师列表失败:",s),p.value=[{id:1,name:"张三",role:"运维工程师",workload:3},{id:2,name:"李四",role:"运维工程师",workload:5},{id:3,name:"王五",role:"巡检员",workload:2}]}},D=async()=>{var s;await((s=y.value)==null?void 0:s.validate()),c.value=!0;try{const e={ticketIds:d.value,assigneeId:o.assigneeId,comment:o.comment,notifyMethod:o.notifyMethod,notifyNow:o.notifyNow};o.priority!=="keep"&&(e.priority=o.priority),await w.batchAssign(e),V.success(`成功指派 ${d.value.length} 个工单`),r.value=!1,A("success")}catch(e){console.error("指派失败:",e),V.error("指派失败，请重试")}finally{c.value=!1}},E=()=>{r.value=!1,b()},b=()=>{var s;o.assigneeId=void 0,o.priority="keep",o.comment="",o.notifyMethod=["system"],o.notifyNow=!0,(s=y.value)==null||s.resetFields()};return M({open:$}),(s,e)=>{const g=n("el-alert"),L=n("el-option"),R=n("el-select"),m=n("el-form-item"),f=n("el-radio"),q=n("el-radio-group"),F=n("el-input"),k=n("el-checkbox"),z=n("el-checkbox-group"),G=n("el-switch"),H=n("el-form"),v=n("el-button"),J=n("el-dialog");return _(),x(J,{modelValue:r.value,"onUpdate:modelValue":e[5]||(e[5]=a=>r.value=a),title:"工单指派",width:"500px","append-to-body":""},{footer:t(()=>[l(v,{onClick:E},{default:t(()=>e[13]||(e[13]=[i("取消")])),_:1,__:[13]}),l(v,{type:"primary",onClick:D,loading:c.value},{default:t(()=>e[14]||(e[14]=[i(" 确定指派 ")])),_:1,__:[14]},8,["loading"])]),default:t(()=>[d.value.length>0?(_(),I("div",O,[l(g,{title:`您正在指派 ${d.value.length} 个工单`,type:"info",closable:!1},null,8,["title"])])):W("",!0),l(H,{ref_key:"formRef",ref:y,model:o,rules:B,"label-width":"100px",style:{"margin-top":"20px"}},{default:t(()=>[l(m,{label:"指派给",prop:"assigneeId"},{default:t(()=>[l(R,{modelValue:o.assigneeId,"onUpdate:modelValue":e[0]||(e[0]=a=>o.assigneeId=a),placeholder:"请选择工程师",filterable:""},{default:t(()=>[(_(!0),I(j,null,K(p.value,a=>(_(),x(L,{key:a.id,label:`${a.name} (${a.role})`,value:a.id},{default:t(()=>[N("span",Q,C(a.name),1),N("span",X,C(a.workload||0)+" 个待处理 ",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"优先级",prop:"priority"},{default:t(()=>[l(q,{modelValue:o.priority,"onUpdate:modelValue":e[1]||(e[1]=a=>o.priority=a)},{default:t(()=>[l(f,{label:"high"},{default:t(()=>e[6]||(e[6]=[i("高优先级")])),_:1,__:[6]}),l(f,{label:"medium"},{default:t(()=>e[7]||(e[7]=[i("中优先级")])),_:1,__:[7]}),l(f,{label:"low"},{default:t(()=>e[8]||(e[8]=[i("低优先级")])),_:1,__:[8]}),l(f,{label:"keep"},{default:t(()=>e[9]||(e[9]=[i("保持原优先级")])),_:1,__:[9]})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"指派说明",prop:"comment"},{default:t(()=>[l(F,{modelValue:o.comment,"onUpdate:modelValue":e[2]||(e[2]=a=>o.comment=a),type:"textarea",rows:3,placeholder:"请输入指派说明（可选）"},null,8,["modelValue"])]),_:1}),l(m,{label:"通知方式",prop:"notifyMethod"},{default:t(()=>[l(z,{modelValue:o.notifyMethod,"onUpdate:modelValue":e[3]||(e[3]=a=>o.notifyMethod=a)},{default:t(()=>[l(k,{label:"system"},{default:t(()=>e[10]||(e[10]=[i("系统通知")])),_:1,__:[10]}),l(k,{label:"email"},{default:t(()=>e[11]||(e[11]=[i("邮件通知")])),_:1,__:[11]}),l(k,{label:"sms"},{default:t(()=>e[12]||(e[12]=[i("短信通知")])),_:1,__:[12]})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"立即通知",prop:"notifyNow"},{default:t(()=>[l(G,{modelValue:o.notifyNow,"onUpdate:modelValue":e[4]||(e[4]=a=>o.notifyNow=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},se=S(Y,[["__scopeId","data-v-4760510f"]]);export{se as default};
