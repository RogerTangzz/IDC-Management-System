import{ar as ce,r as y,P as ve,d as ge,ac as i,ag as O,l as k,m as r,J as e,D as T,C as t,Z as ke,I as N,$ as U,u as Q,B as b,G as u,H as V,K as we,E as G}from"./vue-SR65qDCS.js";import{_ as Ve,F as P}from"./index-Cw83YE5u.js";import{a as h,E as H}from"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const E={async listDueReminders(J={}){return{rows:[],total:0}}},xe={class:"inspection-plan"},Te={key:0},qe={key:1},De={__name:"plan",setup(J){const Z=ce(),I=y(!1),M=y([]),$=y(0),x=y(!1),B=y(""),z=y(),F=y(),L=y([]),p=ve({pageNum:1,pageSize:10,planName:void 0,floor:void 0,enabled:void 0}),o=y({id:void 0,planName:"",floor:void 0,frequency:"daily",executionTime:"09:00",weekDays:[],monthDays:[],responsibleId:void 0,reminderTime:30,notifyUserIds:[],remark:"",enabled:!0}),W={planName:[{required:!0,message:"计划名称不能为空",trigger:"blur"}],floor:[{required:!0,message:"请选择巡检楼层",trigger:"change"}],frequency:[{required:!0,message:"请选择执行频率",trigger:"change"}],executionTime:[{required:!0,message:"请选择执行时间",trigger:"change"}],responsibleId:[{required:!0,message:"请选择负责人",trigger:"change"}],weekDays:[{validator:(n,l,s)=>{o.value.frequency==="weekly"&&(!l||l.length===0)?s(new Error("请选择执行星期")):s()},trigger:"change"}],monthDays:[{validator:(n,l,s)=>{o.value.frequency==="monthly"&&(!l||l.length===0)?s(new Error("请选择执行日期")):s()},trigger:"change"}]},q=async()=>{I.value=!0;try{M.value=[{id:1,planName:"1楼每日巡检",floor:"floor1",frequency:"daily",executionTime:"09:00",responsibleName:"张三",reminderTime:30,nextExecutionTime:new Date,enabled:!0}],$.value=1}finally{I.value=!1}},R=()=>{p.pageNum=1,q()},X=()=>{var n;(n=z.value)==null||n.resetFields(),R()},Y=()=>{S(),x.value=!0,B.value="新建巡检计划"},ee=async n=>{S(),n.id,o.value={...n},x.value=!0,B.value="修改巡检计划"},le=async n=>{await H.confirm("是否确认删除该巡检计划？","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await E.delete(n.id),h.success("删除成功"),q()},ae=async n=>{try{await E.toggle(n.id,n.enabled),h.success(n.enabled?"启用成功":"停用成功")}catch{n.enabled=!n.enabled}},te=n=>{H.confirm("是否立即执行该巡检计划？","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Z.push(`/inspection/create?floor=${n.floor}`)})},ne=()=>{o.value.weekDays=[],o.value.monthDays=[]},oe=async()=>{var n;await((n=F.value)==null?void 0:n.validate()),o.value.id?(await E.update(o.value.id,o.value),h.success("修改成功")):(await E.create(o.value),h.success("新增成功")),x.value=!1,q()},ue=()=>{x.value=!1,S()},S=()=>{var n;o.value={id:void 0,planName:"",floor:void 0,frequency:"daily",executionTime:"09:00",weekDays:[],monthDays:[],responsibleId:void 0,reminderTime:30,notifyUserIds:[],remark:"",enabled:!0},(n=F.value)==null||n.resetFields()},re=n=>{const l=P.find(s=>s.value===n);return l?l.label:n},de=n=>({daily:"每日",weekly:"每周",monthly:"每月"})[n]||n,ie=n=>n===0?"不提醒":n<60?`${n}分钟前`:`${n/60}小时前`,se=n=>{if(n.frequency==="daily")return"每天";if(n.frequency==="weekly"){const l={0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"};return(n.weekDays||[]).map(d=>`周${l[d]}`).join("、")||"-"}else if(n.frequency==="monthly")return(n.monthDays||[]).map(s=>`${s}号`).join("、")||"-";return"-"};return ge(async()=>{q(),L.value=[{id:1,nickName:"张三"},{id:2,nickName:"李四"},{id:3,nickName:"王五"}]}),(n,l)=>{const s=i("el-input"),d=i("el-form-item"),m=i("el-option"),w=i("el-select"),c=i("el-button"),K=i("el-form"),f=i("el-col"),v=i("el-row"),_=i("el-table-column"),me=i("el-tag"),j=i("el-switch"),pe=i("el-table"),fe=i("pagination"),_e=i("el-time-select"),g=i("el-checkbox"),A=i("el-checkbox-group"),be=i("el-dialog"),C=O("hasPermi"),ye=O("loading");return r(),k("div",xe,[e(K,{model:p,ref_key:"queryRef",ref:z,inline:!0},{default:t(()=>[e(d,{label:"计划名称",prop:"planName"},{default:t(()=>[e(s,{modelValue:p.planName,"onUpdate:modelValue":l[0]||(l[0]=a=>p.planName=a),placeholder:"请输入计划名称",clearable:"",onKeyup:ke(R,["enter"])},null,8,["modelValue"])]),_:1}),e(d,{label:"楼层",prop:"floor"},{default:t(()=>[e(w,{modelValue:p.floor,"onUpdate:modelValue":l[1]||(l[1]=a=>p.floor=a),placeholder:"请选择楼层",clearable:""},{default:t(()=>[(r(!0),k(N,null,U(Q(P),a=>(r(),b(m,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"状态",prop:"enabled"},{default:t(()=>[e(w,{modelValue:p.enabled,"onUpdate:modelValue":l[2]||(l[2]=a=>p.enabled=a),placeholder:"请选择状态",clearable:""},{default:t(()=>[e(m,{label:"启用",value:!0}),e(m,{label:"停用",value:!1})]),_:1},8,["modelValue"])]),_:1}),e(d,null,{default:t(()=>[e(c,{type:"primary",icon:"Search",onClick:R},{default:t(()=>l[17]||(l[17]=[u("搜索")])),_:1,__:[17]}),e(c,{icon:"Refresh",onClick:X},{default:t(()=>l[18]||(l[18]=[u("重置")])),_:1,__:[18]})]),_:1})]),_:1},8,["model"]),e(v,{gutter:10,class:"mb8"},{default:t(()=>[e(f,{span:1.5},{default:t(()=>[T((r(),b(c,{type:"primary",plain:"",icon:"Plus",onClick:Y},{default:t(()=>l[19]||(l[19]=[u("新建计划")])),_:1,__:[19]})),[[C,["inspection:plan:add"]]])]),_:1})]),_:1}),T((r(),b(pe,{data:M.value},{default:t(()=>[e(_,{label:"序号",type:"index",width:"55",align:"center"}),e(_,{label:"计划名称",align:"center",prop:"planName"}),e(_,{label:"楼层",align:"center",prop:"floor",width:"80"},{default:t(a=>[u(V(re(a.row.floor)),1)]),_:1}),e(_,{label:"执行频率",align:"center",prop:"frequency",width:"100"},{default:t(a=>[u(V(de(a.row.frequency)),1)]),_:1}),e(_,{label:"执行时间",align:"center",prop:"executionTime",width:"100"},{default:t(a=>[e(me,{type:"info"},{default:t(()=>[u(V(a.row.executionTime),1)]),_:2},1024)]),_:1}),e(_,{label:"执行日期",align:"center",prop:"executionDays",width:"180"},{default:t(a=>[u(V(se(a.row)),1)]),_:1}),e(_,{label:"负责人",align:"center",prop:"responsibleName",width:"100"}),e(_,{label:"提醒时间",align:"center",prop:"reminderTime",width:"100"},{default:t(a=>[u(V(ie(a.row.reminderTime)),1)]),_:1}),e(_,{label:"下次执行",align:"center",prop:"nextExecutionTime",width:"160"},{default:t(a=>[a.row.enabled?(r(),k("span",Te,V(n.parseTime(a.row.nextExecutionTime)),1)):(r(),k("span",qe,"-"))]),_:1}),e(_,{label:"状态",align:"center",prop:"enabled",width:"80"},{default:t(a=>[e(j,{modelValue:a.row.enabled,"onUpdate:modelValue":D=>a.row.enabled=D,onChange:D=>ae(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(_,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"180"},{default:t(a=>[T((r(),b(c,{link:"",type:"primary",icon:"Edit",onClick:D=>ee(a.row)},{default:t(()=>l[20]||(l[20]=[u("修改")])),_:2,__:[20]},1032,["onClick"])),[[C,["inspection:plan:edit"]]]),T((r(),b(c,{link:"",type:"primary",icon:"Timer",onClick:D=>te(a.row),disabled:!a.row.enabled},{default:t(()=>l[21]||(l[21]=[u("立即执行")])),_:2,__:[21]},1032,["onClick","disabled"])),[[C,["inspection:execute"]]]),T((r(),b(c,{link:"",type:"danger",icon:"Delete",onClick:D=>le(a.row)},{default:t(()=>l[22]||(l[22]=[u("删除")])),_:2,__:[22]},1032,["onClick"])),[[C,["inspection:plan:delete"]]])]),_:1})]),_:1},8,["data"])),[[ye,I.value]]),T(e(fe,{total:$.value,page:p.pageNum,"onUpdate:page":l[3]||(l[3]=a=>p.pageNum=a),limit:p.pageSize,"onUpdate:limit":l[4]||(l[4]=a=>p.pageSize=a),onPagination:q},null,8,["total","page","limit"]),[[we,$.value>0]]),e(be,{title:B.value,modelValue:x.value,"onUpdate:modelValue":l[16]||(l[16]=a=>x.value=a),width:"700px","append-to-body":""},{footer:t(()=>[e(c,{onClick:ue},{default:t(()=>l[30]||(l[30]=[u("取消")])),_:1,__:[30]}),e(c,{type:"primary",onClick:oe},{default:t(()=>l[31]||(l[31]=[u("确定")])),_:1,__:[31]})]),default:t(()=>[e(K,{ref_key:"formRef",ref:F,model:o.value,rules:W,"label-width":"100px"},{default:t(()=>[e(v,{gutter:20},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(d,{label:"计划名称",prop:"planName"},{default:t(()=>[e(s,{modelValue:o.value.planName,"onUpdate:modelValue":l[5]||(l[5]=a=>o.value.planName=a),placeholder:"请输入计划名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"巡检楼层",prop:"floor"},{default:t(()=>[e(w,{modelValue:o.value.floor,"onUpdate:modelValue":l[6]||(l[6]=a=>o.value.floor=a),placeholder:"请选择楼层"},{default:t(()=>[(r(!0),k(N,null,U(Q(P),a=>(r(),b(m,{key:a.value,label:`${a.label} (${a.itemCount}项)`,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{gutter:20},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(d,{label:"执行频率",prop:"frequency"},{default:t(()=>[e(w,{modelValue:o.value.frequency,"onUpdate:modelValue":l[7]||(l[7]=a=>o.value.frequency=a),placeholder:"请选择执行频率",onChange:ne},{default:t(()=>[e(m,{label:"每日",value:"daily"}),e(m,{label:"每周",value:"weekly"}),e(m,{label:"每月",value:"monthly"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"执行时间",prop:"executionTime"},{default:t(()=>[e(_e,{modelValue:o.value.executionTime,"onUpdate:modelValue":l[8]||(l[8]=a=>o.value.executionTime=a),start:"00:00",step:"00:30",end:"23:30",placeholder:"选择执行时间"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{gutter:20},{default:t(()=>[e(f,{span:24},{default:t(()=>[o.value.frequency==="weekly"?(r(),b(d,{key:0,label:"执行星期",prop:"weekDays"},{default:t(()=>[e(A,{modelValue:o.value.weekDays,"onUpdate:modelValue":l[9]||(l[9]=a=>o.value.weekDays=a)},{default:t(()=>[e(g,{label:"1"},{default:t(()=>l[23]||(l[23]=[u("周一")])),_:1,__:[23]}),e(g,{label:"2"},{default:t(()=>l[24]||(l[24]=[u("周二")])),_:1,__:[24]}),e(g,{label:"3"},{default:t(()=>l[25]||(l[25]=[u("周三")])),_:1,__:[25]}),e(g,{label:"4"},{default:t(()=>l[26]||(l[26]=[u("周四")])),_:1,__:[26]}),e(g,{label:"5"},{default:t(()=>l[27]||(l[27]=[u("周五")])),_:1,__:[27]}),e(g,{label:"6"},{default:t(()=>l[28]||(l[28]=[u("周六")])),_:1,__:[28]}),e(g,{label:"0"},{default:t(()=>l[29]||(l[29]=[u("周日")])),_:1,__:[29]})]),_:1},8,["modelValue"])]),_:1})):G("",!0),o.value.frequency==="monthly"?(r(),b(d,{key:1,label:"执行日期",prop:"monthDays"},{default:t(()=>[e(A,{modelValue:o.value.monthDays,"onUpdate:modelValue":l[10]||(l[10]=a=>o.value.monthDays=a)},{default:t(()=>[(r(),k(N,null,U(31,a=>e(g,{key:a,label:String(a)},{default:t(()=>[u(V(a)+"号 ",1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1})):G("",!0)]),_:1})]),_:1}),e(v,{gutter:20},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(d,{label:"负责人",prop:"responsibleId"},{default:t(()=>[e(w,{modelValue:o.value.responsibleId,"onUpdate:modelValue":l[11]||(l[11]=a=>o.value.responsibleId=a),placeholder:"请选择负责人",filterable:""},{default:t(()=>[(r(!0),k(N,null,U(L.value,a=>(r(),b(m,{key:a.id,label:a.nickName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(d,{label:"提前提醒",prop:"reminderTime"},{default:t(()=>[e(w,{modelValue:o.value.reminderTime,"onUpdate:modelValue":l[12]||(l[12]=a=>o.value.reminderTime=a),placeholder:"请选择提醒时间"},{default:t(()=>[e(m,{label:"不提醒",value:0}),e(m,{label:"15分钟前",value:15}),e(m,{label:"30分钟前",value:30}),e(m,{label:"1小时前",value:60}),e(m,{label:"2小时前",value:120})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{gutter:20},{default:t(()=>[e(f,{span:24},{default:t(()=>[e(d,{label:"通知人员",prop:"notifyUserIds"},{default:t(()=>[e(w,{modelValue:o.value.notifyUserIds,"onUpdate:modelValue":l[13]||(l[13]=a=>o.value.notifyUserIds=a),placeholder:"请选择通知人员",multiple:"",filterable:""},{default:t(()=>[(r(!0),k(N,null,U(L.value,a=>(r(),b(m,{key:a.id,label:a.nickName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{gutter:20},{default:t(()=>[e(f,{span:24},{default:t(()=>[e(d,{label:"备注",prop:"remark"},{default:t(()=>[e(s,{modelValue:o.value.remark,"onUpdate:modelValue":l[14]||(l[14]=a=>o.value.remark=a),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{gutter:20},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(d,{label:"启用状态",prop:"enabled"},{default:t(()=>[e(j,{modelValue:o.value.enabled,"onUpdate:modelValue":l[15]||(l[15]=a=>o.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}},Ee=Ve(De,[["__scopeId","data-v-7337752f"]]);export{Ee as default};
