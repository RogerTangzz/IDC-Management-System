const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/request-B1IQ3hs5.js","static/js/index-Cw83YE5u.js","static/js/vue-SR65qDCS.js","static/js/element-D8D5Bqo2.js","static/js/vendor-C71Ev03J.js","static/css/index-DPljElOZ.css"])))=>i.map(i=>d[i]);
import{_ as E,aa as I,ab as Y,s as L}from"./index-Cw83YE5u.js";import{i as T}from"./echarts-8VjjxCB0.js";import{k as P,r as _,g as j,d as N,n as $,ac as u,l as q,m as G,J as n,q as c,C as a,G as g}from"./vue-SR65qDCS.js";import"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const J={class:"app-container"},U={class:"mt20"},z=P({name:"TicketReport"}),F=Object.assign(z,{setup(H){const y=_({duration:{},sla:{}}),{proxy:r}=j(),h=_(null),b=_(null),w=_(null),s=_([]);async function C(){try{const e={};s.value&&s.value.length===2&&(e.beginTime=`${s.value[0]} 00:00:00`,e.endTime=`${s.value[1]} 23:59:59`);const t=await Y(e);y.value=t.data||{duration:{},sla:{}},await $(),M()}catch{r.$modal.msgError("加载失败")}}function D(){C()}function A(){history.back()}N(C);function M(){if(h.value){const e=y.value.duration||{};T(h.value).setOption({tooltip:{},xAxis:{type:"category",data:["<1h","1-4h","4-8h","8-24h",">=24h"]},yAxis:{type:"value"},series:[{type:"bar",data:[e.lt1h||0,e.bt1to4h||0,e.bt4to8h||0,e.bt8to24h||0,e.ge24h||0]}]})}if(b.value){const e=y.value.sla||{};T(b.value).setOption({tooltip:{trigger:"item"},series:[{name:"SLA",type:"pie",radius:"60%",data:[{name:"有时限",value:e.withDeadline||0},{name:"超时数量",value:e.timeoutCount||0},{name:"按时完成",value:e.ontimeCompleted||0}]}]})}}N(async()=>{await V()});async function V(){var v,R;const e={};s.value&&s.value.length===2&&(e.beginTime=`${s.value[0]} 00:00:00`,e.endTime=`${s.value[1]} 23:59:59`);const t=await((R=(v=r.$axios)==null?void 0:v.get)==null?void 0:R.call(v,"/business/ticket/report/trend",{params:e}))||await O(e),l=(t==null?void 0:t.data)||t||{},i=[],p=new Map((l.created||[]).map(o=>[o.d,o.v])),k=new Map((l.completed||[]).map(o=>[o.d,o.v])),d=new Date((e.beginTime||l.beginTime||"").replace(/-/g,"/")),m=new Date((e.endTime||l.endTime||"").replace(/-/g,"/"));if(!isNaN(d.getTime())&&!isNaN(m.getTime()))for(let o=new Date(d);o<=m;o.setDate(o.getDate()+1)){const S=o.toISOString().slice(0,10);i.push(S)}const f=i.map(o=>Number(p.get(o)||0)),x=i.map(o=>Number(k.get(o)||0));await $(),w.value&&T(w.value).setOption({tooltip:{trigger:"axis"},legend:{data:["新增","完成"]},xAxis:{type:"category",data:i},yAxis:{type:"value"},series:[{name:"新增",type:"line",data:f},{name:"完成",type:"line",data:x}]})}async function O(e){var t;try{return await((t=r.$axios)==null?void 0:t.get("/business/ticket/report/trend",{params:e}))}catch{}try{return await(await I(async()=>{const{default:l}=await import("./request-B1IQ3hs5.js");return{default:l}},__vite__mapDeps([0,1,2,3,4,5]))).default({url:"/business/ticket/report/trend",method:"get",params:e})}catch{}}async function B(){const e={};s.value&&s.value.length===2&&(e.beginTime=`${s.value[0]} 00:00:00`,e.endTime=`${s.value[1]} 23:59:59`),r!=null&&r.download?r.download("/business/ticket/report/export",e,"ticket_report.xlsx"):await L({url:"/business/ticket/report/export",method:"get",params:e,responseType:"blob"})}return(e,t)=>{const l=u("el-date-picker"),i=u("el-form-item"),p=u("el-button"),k=u("el-form"),d=u("el-col"),m=u("el-card"),f=u("el-row");return G(),q("div",J,[n(f,{gutter:20,class:"mb8"},{default:a(()=>[n(d,{span:24,class:"mb8"},{default:a(()=>[n(k,{inline:!0},{default:a(()=>[n(i,{label:"时间范围"},{default:a(()=>[n(l,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=x=>s.value=x),type:"daterange","value-format":"YYYY-MM-DD","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),n(i,null,{default:a(()=>[n(p,{type:"primary",icon:"Search",onClick:D},{default:a(()=>t[1]||(t[1]=[g("查询")])),_:1,__:[1]}),n(p,{icon:"Download",onClick:B},{default:a(()=>t[2]||(t[2]=[g("导出")])),_:1,__:[2]})]),_:1})]),_:1})]),_:1}),n(d,{span:12},{default:a(()=>[n(m,{shadow:"never"},{header:a(()=>t[3]||(t[3]=[c("span",null,"处理时长分布",-1)])),default:a(()=>[c("div",{ref_key:"durationRef",ref:h,style:{height:"320px"}},null,512)]),_:1})]),_:1}),n(d,{span:12},{default:a(()=>[n(m,{shadow:"never"},{header:a(()=>t[4]||(t[4]=[c("span",null,"SLA 统计",-1)])),default:a(()=>[c("div",{ref_key:"slaRef",ref:b,style:{height:"320px"}},null,512)]),_:1})]),_:1})]),_:1}),n(f,{gutter:20},{default:a(()=>[n(d,{span:24},{default:a(()=>[n(m,{shadow:"never"},{header:a(()=>t[5]||(t[5]=[c("span",null,"近7日趋势",-1)])),default:a(()=>[c("div",{ref_key:"trendRef",ref:w,style:{height:"320px"}},null,512)]),_:1})]),_:1})]),_:1}),c("div",U,[n(p,{type:"primary",icon:"Refresh",onClick:D},{default:a(()=>t[6]||(t[6]=[g("刷新")])),_:1,__:[6]}),n(p,{icon:"Back",onClick:A},{default:a(()=>t[7]||(t[7]=[g("返回")])),_:1,__:[7]})])])}}}),ee=E(F,[["__scopeId","data-v-44e88e46"]]);export{ee as default};
