import{a as T,t as z}from"./ticket-B-hP2oPw.js";import{a0 as G}from"./index-Cw83YE5u.js";import{a as J}from"./element-D8D5Bqo2.js";import{r as s,P as K,c as V,e as Q,ac as i,B as c,m as p,C as o,J as t,l as q,I as w,$ as U,u as h,E as W,G as X,q as Z}from"./vue-SR65qDCS.js";import"./vendor-C71Ev03J.js";const E={HIGH:{value:"high",label:"高",color:"danger"},MEDIUM:{value:"medium",label:"中",color:"warning"},LOW:{value:"low",label:"低",color:"info"}},ee=[{value:"hvac",label:"暖通"},{value:"power",label:"配电"},{value:"fire",label:"消防"},{value:"weak",label:"弱电"}],ie={__name:"TicketForm",emits:["success"],setup(le,{expose:I,emit:te}){const g=s(!1),m=s("create"),M=s(!1),N=s(),v=s([]),_=s([]),e=K({id:void 0,title:"",priority:"medium",templateId:void 0,description:"",reporterName:"",reporterPhone:"",equipmentName:"",equipmentSpecialty:void 0,location:"",faultTime:void 0,emergencyMeasure:"",attachments:[],notifyEngineer:!1,deadline:void 0}),x={title:[{required:!0,message:"请输入工单标题",trigger:"blur"},{min:5,max:100,message:"标题长度在 5 到 100 个字符",trigger:"blur"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],description:[{required:!0,message:"请输入故障描述",trigger:"blur"}],reporterName:[{required:!0,message:"请输入报修人姓名",trigger:"blur"}],reporterPhone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],equipmentName:[{required:!0,message:"请输入故障设备名称",trigger:"blur"}],equipmentSpecialty:[{required:!0,message:"请选择设备专业",trigger:"change"}],location:[{required:!0,message:"请输入设备位置",trigger:"blur"}]},P=V(()=>({create:"新建工单",edit:"修改工单",view:"工单详情"})[m.value]),S=V(()=>"undefined/common/upload"),C=V(()=>({Authorization:"Bearer "+G()}));Q(()=>e.priority,n=>{if(n){const l=E[n.toUpperCase()];if(l){const r=new Date;r.setHours(r.getHours()+l.limit),e.deadline=r}}});const B=async(n,l="create")=>{if(g.value=!0,m.value=l,A(),m.value==="create")try{const r=await T.list();v.value=r.data||[]}catch{v.value=[]}if(n){M.value=!0;try{const r=await z.get(n);Object.assign(e,r.data),_.value=r.data.attachments||[]}finally{M.value=!1}}},H=async n=>{if(!n)return;const r=(await T.get(n)).data;e.title=r.title,e.priority=r.priority,e.description=r.description,e.equipmentSpecialty=r.equipmentSpecialty,e.emergencyMeasure=r.emergencyMeasure},L=(n,l)=>{n.code===200&&e.attachments.push({name:l.name,url:n.data.url})},Y=n=>{const l=e.attachments.findIndex(r=>r.url===n.url);l!==-1&&e.attachments.splice(l,1)},R=n=>n.size/1024/1024<10?!0:(J.error("上传文件大小不能超过 10MB!"),!1),A=()=>{var n;e.id=void 0,e.title="",e.priority="medium",e.templateId=void 0,e.description="",e.reporterName="",e.reporterPhone="",e.equipmentName="",e.equipmentSpecialty=void 0,e.location="",e.faultTime=void 0,e.emergencyMeasure="",e.attachments=[],e.notifyEngineer=!1,e.deadline=void 0,_.value=[],(n=N.value)==null||n.resetFields()};return I({open:B}),(n,l)=>{const r=i("el-input"),u=i("el-form-item"),d=i("el-col"),b=i("el-option"),y=i("el-select"),f=i("el-row"),k=i("el-date-picker"),D=i("el-button"),O=i("el-upload"),j=i("el-switch"),F=i("el-form"),$=i("el-dialog");return p(),c($,{title:P.value,modelValue:g.value,"onUpdate:modelValue":l[13]||(l[13]=a=>g.value=a),width:"800px","append-to-body":"","close-on-click-modal":!1},{default:o(()=>[t(F,{ref_key:"formRef",ref:N,model:e,rules:x,disabled:m.value==="view","label-width":"100px"},{default:o(()=>[t(f,{gutter:20},{default:o(()=>[t(d,{span:12},{default:o(()=>[t(u,{label:"工单标题",prop:"title"},{default:o(()=>[t(r,{modelValue:e.title,"onUpdate:modelValue":l[0]||(l[0]=a=>e.title=a),placeholder:"请输入工单标题"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:o(()=>[t(u,{label:"优先级",prop:"priority"},{default:o(()=>[t(y,{modelValue:e.priority,"onUpdate:modelValue":l[1]||(l[1]=a=>e.priority=a),placeholder:"请选择优先级"},{default:o(()=>[(p(!0),q(w,null,U(Object.values(h(E)),a=>(p(),c(b,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(f,{gutter:20},{default:o(()=>[t(d,{span:12},{default:o(()=>[m.value==="create"?(p(),c(u,{key:0,label:"使用模板",prop:"templateId"},{default:o(()=>[t(y,{modelValue:e.templateId,"onUpdate:modelValue":l[2]||(l[2]=a=>e.templateId=a),placeholder:"选择模板（可选）",clearable:"",onChange:H},{default:o(()=>[(p(!0),q(w,null,U(v.value,a=>(p(),c(b,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):W("",!0)]),_:1}),t(d,{span:12},{default:o(()=>[t(u,{label:"处理时限",prop:"deadline"},{default:o(()=>[t(k,{modelValue:e.deadline,"onUpdate:modelValue":l[3]||(l[3]=a=>e.deadline=a),type:"datetime",placeholder:"选择处理时限",disabled:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(u,{label:"故障描述",prop:"description"},{default:o(()=>[t(r,{modelValue:e.description,"onUpdate:modelValue":l[4]||(l[4]=a=>e.description=a),type:"textarea",rows:4,placeholder:"请详细描述故障情况"},null,8,["modelValue"])]),_:1}),t(f,{gutter:20},{default:o(()=>[t(d,{span:12},{default:o(()=>[t(u,{label:"报修人",prop:"reporterName"},{default:o(()=>[t(r,{modelValue:e.reporterName,"onUpdate:modelValue":l[5]||(l[5]=a=>e.reporterName=a),placeholder:"请输入报修人姓名"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:o(()=>[t(u,{label:"联系电话",prop:"reporterPhone"},{default:o(()=>[t(r,{modelValue:e.reporterPhone,"onUpdate:modelValue":l[6]||(l[6]=a=>e.reporterPhone=a),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(f,{gutter:20},{default:o(()=>[t(d,{span:12},{default:o(()=>[t(u,{label:"故障设备",prop:"equipmentName"},{default:o(()=>[t(r,{modelValue:e.equipmentName,"onUpdate:modelValue":l[7]||(l[7]=a=>e.equipmentName=a),placeholder:"请输入故障设备名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:o(()=>[t(u,{label:"设备专业",prop:"equipmentSpecialty"},{default:o(()=>[t(y,{modelValue:e.equipmentSpecialty,"onUpdate:modelValue":l[8]||(l[8]=a=>e.equipmentSpecialty=a),placeholder:"请选择设备专业"},{default:o(()=>[(p(!0),q(w,null,U(h(ee),a=>(p(),c(b,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(u,{label:"设备位置",prop:"location"},{default:o(()=>[t(r,{modelValue:e.location,"onUpdate:modelValue":l[9]||(l[9]=a=>e.location=a),placeholder:"请输入设备位置（如：1楼机房）"},null,8,["modelValue"])]),_:1}),t(u,{label:"故障时间",prop:"faultTime"},{default:o(()=>[t(k,{modelValue:e.faultTime,"onUpdate:modelValue":l[10]||(l[10]=a=>e.faultTime=a),type:"datetime",placeholder:"选择故障发现时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(u,{label:"应急处置",prop:"emergencyMeasure"},{default:o(()=>[t(r,{modelValue:e.emergencyMeasure,"onUpdate:modelValue":l[11]||(l[11]=a=>e.emergencyMeasure=a),type:"textarea",rows:3,placeholder:"请描述应急处置方法"},null,8,["modelValue"])]),_:1}),t(u,{label:"附件",prop:"attachments"},{default:o(()=>[t(O,{action:S.value,headers:C.value,"file-list":_.value,"on-success":L,"on-remove":Y,"before-upload":R,multiple:"",limit:5},{tip:o(()=>l[15]||(l[15]=[Z("div",{class:"el-upload__tip"},"支持jpg/png/pdf文件，单个文件不超过10MB",-1)])),default:o(()=>[t(D,{type:"primary"},{default:o(()=>l[14]||(l[14]=[X("点击上传")])),_:1,__:[14]})]),_:1},8,["action","headers","file-list"])]),_:1}),t(u,{label:"通知工程师",prop:"notifyEngineer"},{default:o(()=>[t(j,{modelValue:e.notifyEngineer,"onUpdate:modelValue":l[12]||(l[12]=a=>e.notifyEngineer=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["title","modelValue"])}}};export{ie as default};
