import{k as ge,g as _e,ar as be,r as m,d as we,ac as r,ag as A,l as B,m as c,D as v,J as e,K as j,C as t,Z as ye,G as i,B as f,H as S,u as ke,q as N,E as V,I as Se,$ as Ce}from"./vue-SR65qDCS.js";import{_ as xe,n as z,H as Ve,J as he,K as Ie,L as $e,M as Me}from"./index-Cw83YE5u.js";import"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const De={class:"app-container"},Te={class:"dialog-footer"},Ue=ge({name:"Maintenance"}),Ne=Object.assign(Ue,{setup(Le){const{proxy:d}=_e(),h=be(),I=m(!1),$=m(!0),L=m([]),K=m(!0),Y=m(!0),M=m(0),R=m([]),C=m([]),y=m(!1),P=m([]),{mop_category:F}=d.useDict("mop_category"),u=m({pageNum:1,pageSize:10,title:void 0,floor:void 0,mopCategory:void 0,approvalStatus:void 0,executionStatus:void 0}),_=m({planId:void 0,approverId:void 0,remark:void 0}),O={approverId:[{required:!0,message:"请选择审核人",trigger:"change"}]};function b(){I.value=!0,z(d.addDateRange(u.value,C.value)).then(n=>{R.value=n.rows,M.value=n.total,I.value=!1})}function D(){u.value.pageNum=1,b()}function Q(){C.value=[],d.resetForm("queryRef"),D()}function G(n){L.value=n.map(a=>a.planId),K.value=n.length!==1,Y.value=!n.length}function H(){h.push("/business/maintenance/create")}function J(){d.$modal.confirm("是否复制上次维保计划？").then(()=>{z({pageNum:1,pageSize:1}).then(n=>{if(n.rows&&n.rows.length>0){const a=n.rows[0];Ve(a.planId).then(()=>{d.$modal.msgSuccess("复制成功"),b()})}else d.$modal.msgWarning("没有可复制的计划")})})}function W(n){h.push("/business/maintenance/detail/"+n.planId)}function Z(n){h.push("/business/maintenance/edit/"+n.planId)}function X(n){_.value={planId:n.planId,approverId:void 0,remark:void 0},he().then(a=>{P.value=a.data,y.value=!0})}function ee(){d.$refs.approvalRef.validate(n=>{n&&Me(_.value.planId,_.value.approverId).then(()=>{d.$modal.msgSuccess("提交审核成功"),y.value=!1,b()})})}function ae(n){d.$modal.confirm("确认生成工单吗？").then(()=>{Ie(n.planId).then(()=>{d.$modal.msgSuccess("工单生成成功"),b()})})}function le(n){const a=n.planId||L.value;d.$modal.confirm('是否确认删除维保计划编号为"'+a+'"的数据项？').then(()=>$e(a)).then(()=>{b(),d.$modal.msgSuccess("删除成功")})}function te(){d.download("business/maintenance/export",{...u.value},`maintenance_${new Date().getTime()}.xlsx`)}function ne(n){return{draft:"info",pending:"warning",approved:"success",rejected:"danger"}[n]||"info"}function oe(n){return{draft:"草稿",pending:"待审核",approved:"已批准",rejected:"已拒绝"}[n]||n}function ue(n){return{pending:"warning",executing:"primary",completed:"success",cancelled:"info"}[n]||"info"}function re(n){return{pending:"待执行",executing:"执行中",completed:"已完成",cancelled:"已取消"}[n]||n}return we(()=>{b()}),(n,a)=>{const E=r("el-input"),g=r("el-form-item"),o=r("el-option"),k=r("el-select"),ie=r("el-date-picker"),s=r("el-button"),q=r("el-form"),T=r("el-col"),de=r("right-toolbar"),pe=r("el-row"),p=r("el-table-column"),U=r("el-tag"),se=r("dict-tag"),me=r("el-table"),ce=r("pagination"),ve=r("el-dialog"),w=A("hasPermi"),fe=A("loading");return c(),B("div",De,[v(e(q,{model:u.value,ref:"queryRef",inline:!0,"label-width":"68px"},{default:t(()=>[e(g,{label:"计划名称",prop:"title"},{default:t(()=>[e(E,{modelValue:u.value.title,"onUpdate:modelValue":a[0]||(a[0]=l=>u.value.title=l),placeholder:"请输入计划名称",clearable:"",onKeyup:ye(D,["enter"])},null,8,["modelValue"])]),_:1}),e(g,{label:"楼层",prop:"floor"},{default:t(()=>[e(k,{modelValue:u.value.floor,"onUpdate:modelValue":a[1]||(a[1]=l=>u.value.floor=l),placeholder:"请选择楼层",clearable:""},{default:t(()=>[e(o,{label:"全部楼层",value:""}),e(o,{label:"1楼",value:"1"}),e(o,{label:"2楼",value:"2"}),e(o,{label:"3楼",value:"3"}),e(o,{label:"4楼",value:"4"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"MOP类别",prop:"mopCategory"},{default:t(()=>[e(k,{modelValue:u.value.mopCategory,"onUpdate:modelValue":a[2]||(a[2]=l=>u.value.mopCategory=l),placeholder:"请选择类别",clearable:""},{default:t(()=>[e(o,{label:"全部",value:""}),e(o,{label:"日常维护",value:"daily"}),e(o,{label:"定期保养",value:"regular"}),e(o,{label:"月度检修",value:"monthly"}),e(o,{label:"季度检修",value:"quarterly"}),e(o,{label:"年度检修",value:"annual"}),e(o,{label:"应急维修",value:"emergency"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"审核状态",prop:"approvalStatus"},{default:t(()=>[e(k,{modelValue:u.value.approvalStatus,"onUpdate:modelValue":a[3]||(a[3]=l=>u.value.approvalStatus=l),placeholder:"请选择状态",clearable:""},{default:t(()=>[e(o,{label:"全部",value:""}),e(o,{label:"草稿",value:"draft"}),e(o,{label:"待审核",value:"pending"}),e(o,{label:"已批准",value:"approved"}),e(o,{label:"已拒绝",value:"rejected"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"执行状态",prop:"executionStatus"},{default:t(()=>[e(k,{modelValue:u.value.executionStatus,"onUpdate:modelValue":a[4]||(a[4]=l=>u.value.executionStatus=l),placeholder:"请选择状态",clearable:""},{default:t(()=>[e(o,{label:"全部",value:""}),e(o,{label:"待执行",value:"pending"}),e(o,{label:"执行中",value:"executing"}),e(o,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"时间范围",prop:"dateRange"},{default:t(()=>[e(ie,{modelValue:C.value,"onUpdate:modelValue":a[5]||(a[5]=l=>C.value=l),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),e(g,null,{default:t(()=>[e(s,{type:"primary",icon:"Search",onClick:D},{default:t(()=>a[13]||(a[13]=[i("搜索")])),_:1,__:[13]}),e(s,{icon:"Refresh",onClick:Q},{default:t(()=>a[14]||(a[14]=[i("重置")])),_:1,__:[14]})]),_:1})]),_:1},8,["model"]),[[j,$.value]]),e(pe,{gutter:10,class:"mb8"},{default:t(()=>[e(T,{span:1.5},{default:t(()=>[v((c(),f(s,{type:"primary",plain:"",icon:"Plus",onClick:H},{default:t(()=>a[15]||(a[15]=[i("新建维保计划")])),_:1,__:[15]})),[[w,["business:maintenance:add"]]])]),_:1}),e(T,{span:1.5},{default:t(()=>[v((c(),f(s,{type:"info",plain:"",icon:"CopyDocument",onClick:J},{default:t(()=>a[16]||(a[16]=[i("复制上次计划")])),_:1,__:[16]})),[[w,["business:maintenance:add"]]])]),_:1}),e(T,{span:1.5},{default:t(()=>[v((c(),f(s,{type:"success",plain:"",icon:"Download",onClick:te},{default:t(()=>a[17]||(a[17]=[i("导出")])),_:1,__:[17]})),[[w,["business:maintenance:export"]]])]),_:1}),e(de,{showSearch:$.value,"onUpdate:showSearch":a[6]||(a[6]=l=>$.value=l),onQueryTable:b},null,8,["showSearch"])]),_:1}),v((c(),f(me,{data:R.value,onSelectionChange:G},{default:t(()=>[e(p,{type:"selection",width:"55",align:"center"}),e(p,{label:"ID",align:"center",prop:"planId",width:"80"}),e(p,{label:"标题",align:"center",prop:"title","min-width":"200","show-overflow-tooltip":""}),e(p,{label:"楼层",align:"center",prop:"floor",width:"80"},{default:t(l=>[e(U,null,{default:t(()=>[i(S(l.row.floor===5?"全部":l.row.floor+"楼"),1)]),_:2},1024)]),_:1}),e(p,{label:"版本",align:"center",prop:"version",width:"80"}),e(p,{label:"MOP类别",align:"center",prop:"mopCategory",width:"100"},{default:t(l=>[e(se,{options:ke(F),value:l.row.mopCategory},null,8,["options","value"])]),_:1}),e(p,{label:"执行周期",align:"center",prop:"executionCycle",width:"100"}),e(p,{label:"审核状态",align:"center",prop:"approvalStatus",width:"100"},{default:t(l=>[e(U,{type:ne(l.row.approvalStatus),"disable-transitions":""},{default:t(()=>[i(S(oe(l.row.approvalStatus)),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"执行状态",align:"center",prop:"executionStatus",width:"100"},{default:t(l=>[e(U,{type:ue(l.row.executionStatus),"disable-transitions":""},{default:t(()=>[i(S(re(l.row.executionStatus)),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"审核人",align:"center",prop:"approverName",width:"100"}),e(p,{label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:t(l=>[N("span",null,S(n.parseTime(l.row.createTime)),1)]),_:1}),e(p,{label:"下次执行时间",align:"center",prop:"nextExecutionTime",width:"160"},{default:t(l=>[N("span",null,S(n.parseTime(l.row.nextExecutionTime)),1)]),_:1}),e(p,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"240",fixed:"right"},{default:t(l=>[v((c(),f(s,{link:"",type:"primary",icon:"View",onClick:x=>W(l.row)},{default:t(()=>a[18]||(a[18]=[i("详情")])),_:2,__:[18]},1032,["onClick"])),[[w,["business:maintenance:query"]]]),l.row.approvalStatus==="draft"?v((c(),f(s,{key:0,link:"",type:"primary",icon:"Edit",onClick:x=>Z(l.row)},{default:t(()=>a[19]||(a[19]=[i("编辑")])),_:2,__:[19]},1032,["onClick"])),[[w,["business:maintenance:edit"]]]):V("",!0),l.row.approvalStatus==="draft"?v((c(),f(s,{key:1,link:"",type:"success",icon:"Check",onClick:x=>X(l.row)},{default:t(()=>a[20]||(a[20]=[i("提交审核")])),_:2,__:[20]},1032,["onClick"])),[[w,["business:maintenance:edit"]]]):V("",!0),l.row.approvalStatus==="approved"&&l.row.executionStatus==="pending"?v((c(),f(s,{key:2,link:"",type:"warning",icon:"Document",onClick:x=>ae(l.row)},{default:t(()=>a[21]||(a[21]=[i("生成工单")])),_:2,__:[21]},1032,["onClick"])),[[w,["business:maintenance:edit"]]]):V("",!0),l.row.approvalStatus==="draft"?v((c(),f(s,{key:3,link:"",type:"danger",icon:"Delete",onClick:x=>le(l.row)},{default:t(()=>a[22]||(a[22]=[i("删除")])),_:2,__:[22]},1032,["onClick"])),[[w,["business:maintenance:remove"]]]):V("",!0)]),_:1})]),_:1},8,["data"])),[[fe,I.value]]),v(e(ce,{total:M.value,page:u.value.pageNum,"onUpdate:page":a[7]||(a[7]=l=>u.value.pageNum=l),limit:u.value.pageSize,"onUpdate:limit":a[8]||(a[8]=l=>u.value.pageSize=l),onPagination:b},null,8,["total","page","limit"]),[[j,M.value>0]]),e(ve,{modelValue:y.value,"onUpdate:modelValue":a[12]||(a[12]=l=>y.value=l),title:"提交审核",width:"500px","append-to-body":""},{footer:t(()=>[N("span",Te,[e(s,{onClick:a[11]||(a[11]=l=>y.value=!1)},{default:t(()=>a[23]||(a[23]=[i("取消")])),_:1,__:[23]}),e(s,{type:"primary",onClick:ee},{default:t(()=>a[24]||(a[24]=[i("确定")])),_:1,__:[24]})])]),default:t(()=>[e(q,{ref:"approvalRef",model:_.value,rules:O,"label-width":"80px"},{default:t(()=>[e(g,{label:"审核人",prop:"approverId"},{default:t(()=>[e(k,{modelValue:_.value.approverId,"onUpdate:modelValue":a[9]||(a[9]=l=>_.value.approverId=l),placeholder:"请选择审核人"},{default:t(()=>[(c(!0),B(Se,null,Ce(P.value,l=>(c(),f(o,{key:l.userId,label:l.nickName,value:l.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"备注",prop:"remark"},{default:t(()=>[e(E,{modelValue:_.value.remark,"onUpdate:modelValue":a[10]||(a[10]=l=>_.value.remark=l),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ae=xe(Ne,[["__scopeId","data-v-7e533e20"]]);export{Ae as default};
