import{k as oe,g as se,ar as ie,ap as ue,r as N,c as h,ac as _,ag as re,l as c,m as s,J as l,D as de,B as p,E as F,C as e,q as i,G as o,H as u,u as z,I as _e,$ as pe}from"./vue-SR65qDCS.js";import{_ as ce,F as fe}from"./index-Cw83YE5u.js";import"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const me={class:"app-container"},ve={class:"header-content"},ye={class:"header-left"},ke={class:"header-center"},be={class:"header-right"},ge={class:"card-header"},we={class:"text-primary"},Ce={key:1},Ne={class:"card-header"},Ie={key:0},De={key:1},xe={key:0},$e={key:0},Ae={key:1},Te={key:2},he={key:1},Ve={class:"anomaly-list"},Re={class:"anomaly-header"},Be={class:"anomaly-index"},Se={class:"anomaly-title"},Pe={class:"anomaly-content"},Fe={class:"value danger"},ze={class:"value"},Ee={class:"value"},Oe={class:"suggestion"},He=oe({name:"InspectionDetail"}),Le=Object.assign(He,{setup(je){const{proxy:I}=se(),D=ie(),V=ue(),E=V.params&&V.params.id,x=N(!1),g=N("all"),r=N({}),m=N([]),{ticket_priority:O}=I.useDict("ticket_priority"),H=fe.map(a=>({label:a.label,value:a.value})),w=h(()=>{const a=m.value.length,t=m.value.filter(d=>!d.isAnomaly&&d.value!==null).length,v=m.value.filter(d=>d.isAnomaly).length,b=a>0?v/a*100:0;return{total:a,normal:t,anomaly:v,anomalyRate:b}}),L=h(()=>g.value==="normal"?m.value.filter(a=>!a.isAnomaly&&a.value!==null):g.value==="anomaly"?m.value.filter(a=>a.isAnomaly):m.value),R=h(()=>m.value.filter(a=>a.isAnomaly));function j(){x.value=!0,setTimeout(()=>{r.value={inspectionId:E,inspectionNo:"INS202501001",floor:"floor1",inspectionDate:new Date,inspectorName:"张三",relayPerson:"李四",progress:100,anomalyCount:2,ticketCount:1,createTime:new Date,remark:"例行巡检"},m.value=[{id:"oil_tank",label:"地埋油罐及蓄冷罐是否正常",type:"boolean",value:!0,isAnomaly:!1},{id:"electric_room",label:"南侧电气间环境设施是否正常",type:"boolean",value:!1,isAnomaly:!0,priority:"medium"},{id:"pump_pressure",label:"冷冻泵回水压力",type:"number",value:.5,unit:"MPa",min:.3,max:.6,isAnomaly:!1}],x.value=!1},500)}function q(a){return a.type==="boolean"?a.value?"正常":"异常":`${a.value} ${a.unit||""}`}function G(a){return a.type==="boolean"?"正常":a.min!==void 0?`${a.min}-${a.max} ${a.unit||""}`:"-"}function J(a){return"请尽快前往现场检查并处理"}function M({row:a}){return a.isAnomaly?"anomaly-row":a.value===null||a.value===void 0?"unchecked-row":""}function U(){I.$modal.msgSuccess("工单生成成功")}function Y(){D.push("/business/ticket")}function B(a){D.push("/business/ticket/detail/"+a)}function K(){window.print()}function Q(){I.$modal.msgSuccess("导出功能待实现")}function W(){D.back()}return j(),(a,t)=>{const v=_("el-button"),b=_("el-card"),d=_("el-tag"),f=_("el-descriptions-item"),S=_("dict-tag"),X=_("el-progress"),$=_("el-link"),Z=_("el-descriptions"),A=_("el-radio-button"),ee=_("el-radio-group"),C=_("el-statistic"),y=_("el-col"),P=_("el-row"),k=_("el-table-column"),te=_("el-table"),le=_("el-alert"),ae=re("loading");return s(),c("div",me,[l(b,{class:"header-card"},{default:e(()=>[i("div",ve,[i("div",ye,[l(v,{link:"",type:"primary",icon:"Back",onClick:W},{default:e(()=>t[1]||(t[1]=[o("返回列表")])),_:1,__:[1]})]),i("div",ke,[i("h2",null,"巡检详情 - "+u(r.value.inspectionNo),1)]),i("div",be,[l(v,{type:"primary",icon:"Printer",onClick:K},{default:e(()=>t[2]||(t[2]=[o("打印")])),_:1,__:[2]}),l(v,{type:"success",icon:"Download",onClick:Q},{default:e(()=>t[3]||(t[3]=[o("导出报告")])),_:1,__:[3]})])])]),_:1}),de((s(),p(b,{class:"info-card"},{header:e(()=>[i("div",ge,[t[6]||(t[6]=i("span",{class:"descriptions-title"},"基本信息",-1)),i("div",null,[r.value.isCopied==="Y"?(s(),p(d,{key:0,type:"info"},{default:e(()=>t[4]||(t[4]=[o("复制")])),_:1,__:[4]})):F("",!0),r.value.anomalyCount>0?(s(),p(d,{key:1,type:"danger"},{default:e(()=>[o(" 异常："+u(r.value.anomalyCount)+"项 ",1)]),_:1})):(s(),p(d,{key:2,type:"success"},{default:e(()=>t[5]||(t[5]=[o("正常")])),_:1,__:[5]}))])])]),default:e(()=>[l(Z,{column:3,border:""},{default:e(()=>[l(f,{label:"巡检编号"},{default:e(()=>[i("span",we,u(r.value.inspectionNo),1)]),_:1}),l(f,{label:"巡检楼层"},{default:e(()=>[l(S,{options:z(H),value:r.value.floor},null,8,["options","value"])]),_:1}),l(f,{label:"巡检日期"},{default:e(()=>[o(u(a.parseTime(r.value.inspectionDate,"{y}-{m}-{d}")),1)]),_:1}),l(f,{label:"巡检人员"},{default:e(()=>[o(u(r.value.inspectorName),1)]),_:1}),l(f,{label:"接力人员"},{default:e(()=>[o(u(r.value.relayPerson||"-"),1)]),_:1}),l(f,{label:"完成进度"},{default:e(()=>[l(X,{percentage:r.value.progress,status:r.value.progress===100?"success":""},null,8,["percentage","status"])]),_:1}),l(f,{label:"检查项目"},{default:e(()=>[o(u(a.completedItems)+"/"+u(a.totalItems)+"项 ",1)]),_:1}),l(f,{label:"生成工单"},{default:e(()=>[r.value.ticketCount>0?(s(),p($,{key:0,type:"primary",onClick:Y},{default:e(()=>[o(u(r.value.ticketCount)+"个 ",1)]),_:1})):(s(),c("span",Ce,"0个"))]),_:1}),l(f,{label:"创建时间"},{default:e(()=>[o(u(a.parseTime(r.value.createTime)),1)]),_:1}),l(f,{label:"备注",span:3},{default:e(()=>[o(u(r.value.remark||"无"),1)]),_:1})]),_:1})]),_:1})),[[ae,x.value]]),l(b,{class:"items-card"},{header:e(()=>[i("div",Ne,[t[10]||(t[10]=i("span",{class:"descriptions-title"},"巡检项目结果",-1)),l(ee,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=n=>g.value=n),onChange:a.handleFilterChange},{default:e(()=>[l(A,{label:"all"},{default:e(()=>t[7]||(t[7]=[o("全部")])),_:1,__:[7]}),l(A,{label:"normal"},{default:e(()=>t[8]||(t[8]=[o("正常")])),_:1,__:[8]}),l(A,{label:"anomaly"},{default:e(()=>t[9]||(t[9]=[o("异常")])),_:1,__:[9]})]),_:1},8,["modelValue","onChange"])])]),default:e(()=>[l(P,{gutter:20,class:"statistics-row"},{default:e(()=>[l(y,{span:6},{default:e(()=>[l(C,{title:"总检查项",value:w.value.total},{suffix:e(()=>t[11]||(t[11]=[o("项")])),_:1},8,["value"])]),_:1}),l(y,{span:6},{default:e(()=>[l(C,{title:"正常项",value:w.value.normal,"value-style":"color: #67c23a"},{suffix:e(()=>t[12]||(t[12]=[o("项")])),_:1},8,["value"])]),_:1}),l(y,{span:6},{default:e(()=>[l(C,{title:"异常项",value:w.value.anomaly,"value-style":"color: #f56c6c"},{suffix:e(()=>t[13]||(t[13]=[o("项")])),_:1},8,["value"])]),_:1}),l(y,{span:6},{default:e(()=>[l(C,{title:"异常率",value:w.value.anomalyRate,precision:1},{suffix:e(()=>t[14]||(t[14]=[o("%")])),_:1},8,["value"])]),_:1})]),_:1}),l(te,{data:L.value,stripe:"","row-class-name":M,class:"items-table"},{default:e(()=>[l(k,{label:"序号",type:"index",width:"60",align:"center"}),l(k,{label:"检查项目",prop:"label","min-width":"300","show-overflow-tooltip":""}),l(k,{label:"类型",prop:"type",width:"80",align:"center"},{default:e(n=>[l(d,{size:"small",type:"info"},{default:e(()=>[o(u(n.row.type==="boolean"?"状态":"数值"),1)]),_:2},1024)]),_:1}),l(k,{label:"检查结果",prop:"value",width:"150",align:"center"},{default:e(n=>[n.row.type==="boolean"?(s(),c("div",Ie,[n.row.value===!0?(s(),p(d,{key:0,type:"success"},{default:e(()=>t[15]||(t[15]=[o("正常")])),_:1,__:[15]})):n.row.value===!1?(s(),p(d,{key:1,type:"danger"},{default:e(()=>t[16]||(t[16]=[o("异常")])),_:1,__:[16]})):(s(),p(d,{key:2,type:"info"},{default:e(()=>t[17]||(t[17]=[o("未检查")])),_:1,__:[17]}))])):(s(),c("div",De,[n.row.value!==null&&n.row.value!==void 0?(s(),c("span",xe,u(n.row.value)+" "+u(n.row.unit),1)):(s(),p(d,{key:1,type:"info",size:"small"},{default:e(()=>t[18]||(t[18]=[o("未填写")])),_:1,__:[18]}))]))]),_:1}),l(k,{label:"正常范围",prop:"range",width:"150",align:"center"},{default:e(n=>[n.row.type==="boolean"?(s(),c("span",$e,"正常")):n.row.min!==void 0?(s(),c("span",Ae,u(n.row.min)+"-"+u(n.row.max)+" "+u(n.row.unit),1)):(s(),c("span",Te,"-"))]),_:1}),l(k,{label:"状态",prop:"status",width:"100",align:"center"},{default:e(n=>[n.row.isAnomaly?(s(),p(d,{key:0,type:"danger",effect:"dark"},{default:e(()=>t[19]||(t[19]=[o("异常")])),_:1,__:[19]})):n.row.value!==null&&n.row.value!==void 0?(s(),p(d,{key:1,type:"success"},{default:e(()=>t[20]||(t[20]=[o("正常")])),_:1,__:[20]})):(s(),p(d,{key:2,type:"info"},{default:e(()=>t[21]||(t[21]=[o("未检查")])),_:1,__:[21]}))]),_:1}),l(k,{label:"生成工单",width:"120",align:"center"},{default:e(n=>[n.row.ticketNo?(s(),p($,{key:0,type:"primary",onClick:T=>B(n.row.ticketId)},{default:e(()=>[o(u(n.row.ticketNo),1)]),_:2},1032,["onClick"])):(s(),c("span",he,"-"))]),_:1})]),_:1},8,["data"])]),_:1}),R.value.length>0?(s(),p(b,{key:0,class:"anomaly-card"},{header:e(()=>t[22]||(t[22]=[i("span",{class:"descriptions-title"},"异常项汇总",-1)])),default:e(()=>[l(le,{title:"发现以下异常项，请及时处理",type:"warning",closable:!1,"show-icon":""}),i("div",Ve,[(s(!0),c(_e,null,pe(R.value,(n,T)=>(s(),c("div",{key:T,class:"anomaly-item"},[i("div",Re,[i("span",Be,u(T+1),1),i("span",Se,u(n.label),1),l(S,{options:z(O),value:n.priority},null,8,["options","value"])]),i("div",Pe,[l(P,null,{default:e(()=>[l(y,{span:8},{default:e(()=>[t[23]||(t[23]=i("span",{class:"label"},"异常值：",-1)),i("span",Fe,u(q(n)),1)]),_:2,__:[23]},1024),l(y,{span:8},{default:e(()=>[t[24]||(t[24]=i("span",{class:"label"},"正常范围：",-1)),i("span",ze,u(G(n)),1)]),_:2,__:[24]},1024),l(y,{span:8},{default:e(()=>[t[26]||(t[26]=i("span",{class:"label"},"工单状态：",-1)),i("span",Ee,[n.ticketNo?(s(),p($,{key:0,type:"primary",onClick:ne=>B(n.ticketId)},{default:e(()=>[o(u(n.ticketNo),1)]),_:2},1032,["onClick"])):(s(),p(v,{key:1,link:"",type:"primary",size:"small",onClick:ne=>U(n)},{default:e(()=>t[25]||(t[25]=[o(" 生成工单 ")])),_:2,__:[25]},1032,["onClick"]))])]),_:2,__:[26]},1024)]),_:2},1024),i("div",Oe,[t[27]||(t[27]=i("span",{class:"label"},"处理建议：",-1)),o(" "+u(J(n)),1)])])]))),128))])]),_:1})):F("",!0)])}}}),Ue=ce(Le,[["__scopeId","data-v-9b0bc351"]]);export{Ue as default};
