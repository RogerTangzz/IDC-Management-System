import{k as xe,g as Ce,ar as Se,ap as we,r as f,c as G,ac as d,ag as z,l as R,m as c,D as g,J as a,B as v,C as e,E as _,q as r,H as s,G as o,u as Te,I as J,$ as K}from"./vue-SR65qDCS.js";import{_ as Ne}from"./index-Cw83YE5u.js";import"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const Ve={class:"app-container"},Me={class:"card-header"},Ie={class:"title"},$e={class:"header-buttons"},Pe={class:"text-primary"},Re={class:"description-content"},Ee={class:"description-content"},De={class:"description-content"},Le={class:"description-content"},Ae={class:"description-content"},Ue=["innerHTML"],Be={class:"description-content"},Oe={class:"action-buttons"},je={class:"dialog-footer"},qe={class:"dialog-footer"},Fe=xe({name:"MaintenanceDetail"}),He=Object.assign(Fe,{setup(Ge){const{proxy:m}=Ce(),M=Se(),E=we(),D=E.params&&E.params.id,I=f(!1),S=f(!1),y=f(!1),w=f(""),L=f([]),$=f([]),A=f([]),{mop_category:Q}=m.useDict("mop_category"),l=f({}),k=f({approverId:void 0,remark:""}),T=f({comment:""}),W={approverId:[{required:!0,message:"请选择审核人",trigger:"change"}]},X={comment:[{required:!0,message:"请输入审核意见",trigger:"blur"}]},U=G(()=>!0),Y=G(()=>w.value==="approve"?"审核通过":"审核拒绝");function N(){I.value=!0,l.value={planId:D,planNo:"MP202501001",title:"月度维保计划",floor:"1",version:"V1.0",mopCategory:"monthly",mopName:"月度设备检修",mopPurpose:"确保设备正常运行，预防故障发生",executionFrequency:1,executionUnit:"month",approverName:"王经理",executorName:"李主管",applicantName:"张三",approvalStatus:"draft",executionStatus:"pending",tools:"万用表、螺丝刀、扳手",materials:"润滑油、清洁剂",safety:"安全帽、手套、护目镜",specialTools:"专用检测仪",steps:`1. 检查设备外观
2. 测试运行状态
3. 记录数据
4. 清洁保养
5. 更换耗材`,createTime:new Date,nextExecutionTime:new Date(Date.now()+720*60*60*1e3)},A.value=["张三","李四","王五"],$.value=[],I.value=!1}function Z(n){return{1:"1楼",2:"2楼",3:"3楼",4:"4楼",all:"全部楼层"}[n]||n}function h(n){return{month:"次/月",quarter:"次/季",year:"次/年"}[n]||n}function B(n){return{draft:"info",pending:"warning",approved:"success",rejected:"danger"}[n]||"info"}function O(n){return{draft:"草稿",pending:"待审核",approved:"已批准",rejected:"已拒绝"}[n]||n}function ee(n){return{pending:"warning",executing:"primary",completed:"success",cancelled:"info"}[n]||"info"}function te(n){return{pending:"待执行",executing:"执行中",completed:"已完成",cancelled:"已取消"}[n]||n}function ae(n){return n?n.replace(/\n/g,"<br>"):""}function le(){M.push("/business/maintenance/edit/"+D)}function oe(){k.value={approverId:void 0,remark:""},S.value=!0,ve()}function ne(){m.$refs.submitRef.validate(n=>{n&&(m.$modal.msgSuccess("提交成功"),S.value=!1,l.value.approvalStatus="pending",N())})}function se(){w.value="approve",T.value.comment="",y.value=!0}function ue(){w.value="reject",T.value.comment="",y.value=!0}function ie(){m.$refs.approvalRef.validate(n=>{if(n){const t=w.value==="approve"?"审核通过":"审核拒绝";m.$modal.msgSuccess(t),y.value=!1,l.value.approvalStatus=w.value==="approve"?"approved":"rejected",N()}})}function re(){m.$modal.confirm("确认开始执行该维保计划？").then(()=>{m.$modal.msgSuccess("已开始执行"),l.value.executionStatus="executing",N()})}function pe(){m.$modal.confirm("确认生成维保工单？").then(()=>{m.$modal.msgSuccess("工单生成成功")})}function de(){m.$modal.confirm("确认复制该维保计划？").then(()=>{m.$modal.msgSuccess("复制成功"),M.push("/business/maintenance/create")})}function ce(n){m.$modal.msgInfo("查看执行记录："+n.executionNo)}function me(){window.print()}function j(){M.back()}function ve(){L.value=[{userId:1,nickName:"王经理"},{userId:2,nickName:"李主管"},{userId:3,nickName:"张总监"}]}return N(),(n,t)=>{const p=d("el-button"),u=d("el-descriptions-item"),fe=d("dict-tag"),V=d("el-tag"),b=d("el-descriptions"),x=d("el-table-column"),_e=d("el-table"),be=d("el-card"),ge=d("el-option"),ye=d("el-select"),P=d("el-form-item"),q=d("el-input"),F=d("el-form"),H=d("el-dialog"),C=z("hasPermi"),ke=z("loading");return c(),R("div",Ve,[g((c(),v(be,null,{header:e(()=>[r("div",Me,[r("span",Ie,"维保计划详情 - "+s(l.value.planNo),1),r("div",$e,[a(p,{link:"",type:"primary",icon:"Refresh",onClick:N},{default:e(()=>t[7]||(t[7]=[o("刷新")])),_:1,__:[7]}),a(p,{link:"",type:"primary",icon:"Close",onClick:j},{default:e(()=>t[8]||(t[8]=[o("关闭")])),_:1,__:[8]})])])]),default:e(()=>[a(b,{column:3,border:"",class:"margin-bottom"},{title:e(()=>t[9]||(t[9]=[r("span",{class:"descriptions-title"},"基础信息",-1)])),default:e(()=>[a(u,{label:"计划编号"},{default:e(()=>[r("span",Pe,s(l.value.planNo),1)]),_:1}),a(u,{label:"计划标题",span:2},{default:e(()=>[o(s(l.value.title),1)]),_:1}),a(u,{label:"楼层"},{default:e(()=>[o(s(Z(l.value.floor)),1)]),_:1}),a(u,{label:"版本号"},{default:e(()=>[o(s(l.value.version),1)]),_:1}),a(u,{label:"MOP类别"},{default:e(()=>[a(fe,{options:Te(Q),value:l.value.mopCategory},null,8,["options","value"])]),_:1}),a(u,{label:"审核状态"},{default:e(()=>[a(V,{type:B(l.value.approvalStatus)},{default:e(()=>[o(s(O(l.value.approvalStatus)),1)]),_:1},8,["type"])]),_:1}),a(u,{label:"执行状态"},{default:e(()=>[a(V,{type:ee(l.value.executionStatus)},{default:e(()=>[o(s(te(l.value.executionStatus)),1)]),_:1},8,["type"])]),_:1}),a(u,{label:"创建时间"},{default:e(()=>[o(s(n.parseTime(l.value.createTime)),1)]),_:1})]),_:1}),a(b,{column:2,border:"",class:"margin-bottom"},{title:e(()=>t[10]||(t[10]=[r("span",{class:"descriptions-title"},"MOP信息",-1)])),default:e(()=>[a(u,{label:"MOP名称",span:2},{default:e(()=>[o(s(l.value.mopName),1)]),_:1}),a(u,{label:"MOP目的",span:2},{default:e(()=>[r("div",Re,s(l.value.mopPurpose),1)]),_:1}),a(u,{label:"执行周期"},{default:e(()=>[o(s(l.value.executionFrequency)+" "+s(h(l.value.executionUnit)),1)]),_:1}),a(u,{label:"下次执行时间"},{default:e(()=>[o(s(n.parseTime(l.value.nextExecutionTime)||"-"),1)]),_:1})]),_:1}),a(b,{column:2,border:"",class:"margin-bottom"},{title:e(()=>t[11]||(t[11]=[r("span",{class:"descriptions-title"},"人员信息",-1)])),default:e(()=>[a(u,{label:"审核人"},{default:e(()=>[o(s(l.value.approverName||"-"),1)]),_:1}),a(u,{label:"执行审核人"},{default:e(()=>[o(s(l.value.executorName||"-"),1)]),_:1}),a(u,{label:"申请人"},{default:e(()=>[o(s(l.value.applicantName||l.value.createBy),1)]),_:1}),a(u,{label:"提交时间"},{default:e(()=>[o(s(n.parseTime(l.value.submitTime)||"-"),1)]),_:1}),a(u,{label:"通知人员",span:2},{default:e(()=>[(c(!0),R(J,null,K(A.value,i=>(c(),v(V,{key:i,size:"small",style:{"margin-right":"5px"}},{default:e(()=>[o(s(i),1)]),_:2},1024))),128))]),_:1})]),_:1}),a(b,{column:1,border:"",class:"margin-bottom"},{title:e(()=>t[12]||(t[12]=[r("span",{class:"descriptions-title"},"工具材料",-1)])),default:e(()=>[a(u,{label:"工具仪表"},{default:e(()=>[r("div",Ee,s(l.value.tools||"无"),1)]),_:1}),a(u,{label:"材料"},{default:e(()=>[r("div",De,s(l.value.materials||"无"),1)]),_:1}),a(u,{label:"安全(PPE)"},{default:e(()=>[r("div",Le,s(l.value.safety||"无"),1)]),_:1}),a(u,{label:"特殊工具"},{default:e(()=>[r("div",Ae,s(l.value.specialTools||"无"),1)]),_:1})]),_:1}),a(b,{column:1,border:"",class:"margin-bottom"},{title:e(()=>t[13]||(t[13]=[r("span",{class:"descriptions-title"},"执行步骤",-1)])),default:e(()=>[a(u,null,{default:e(()=>[r("div",{class:"steps-content",innerHTML:ae(l.value.steps)},null,8,Ue)]),_:1})]),_:1}),l.value.approvalStatus!=="draft"?(c(),v(b,{key:0,column:2,border:"",class:"margin-bottom"},{title:e(()=>t[14]||(t[14]=[r("span",{class:"descriptions-title"},"审核信息",-1)])),default:e(()=>[a(u,{label:"审核时间"},{default:e(()=>[o(s(n.parseTime(l.value.approvalTime)||"-"),1)]),_:1}),a(u,{label:"审核状态"},{default:e(()=>[a(V,{type:B(l.value.approvalStatus)},{default:e(()=>[o(s(O(l.value.approvalStatus)),1)]),_:1},8,["type"])]),_:1}),a(u,{label:"审核意见",span:2},{default:e(()=>[r("div",Be,s(l.value.approvalComment||"-"),1)]),_:1})]),_:1})):_("",!0),$.value.length>0?(c(),v(b,{key:1,column:1,border:"",class:"margin-bottom"},{title:e(()=>t[15]||(t[15]=[r("span",{class:"descriptions-title"},"执行记录",-1)])),default:e(()=>[a(u,null,{default:e(()=>[a(_e,{data:$.value,border:""},{default:e(()=>[a(x,{prop:"executionNo",label:"执行编号",width:"150"}),a(x,{prop:"executorName",label:"执行人",width:"100"}),a(x,{prop:"actualExecutionTime",label:"执行时间",width:"180"},{default:e(i=>[o(s(n.parseTime(i.row.actualExecutionTime)),1)]),_:1}),a(x,{prop:"executionResult",label:"执行结果",width:"100"},{default:e(i=>[a(V,{type:i.row.executionResult==="normal"?"success":"danger"},{default:e(()=>[o(s(i.row.executionResult==="normal"?"正常":"异常"),1)]),_:2},1032,["type"])]),_:1}),a(x,{prop:"executionRecord",label:"执行记录","min-width":"200"}),a(x,{label:"操作",width:"100",fixed:"right"},{default:e(i=>[a(p,{link:"",type:"primary",onClick:ze=>ce(i.row)},{default:e(()=>t[16]||(t[16]=[o("查看")])),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})):_("",!0),r("div",Oe,[l.value.approvalStatus==="draft"?g((c(),v(p,{key:0,type:"primary",icon:"Edit",onClick:le},{default:e(()=>t[17]||(t[17]=[o("编辑")])),_:1,__:[17]})),[[C,["business:maintenance:edit"]]]):_("",!0),l.value.approvalStatus==="draft"?g((c(),v(p,{key:1,type:"success",icon:"Select",onClick:oe},{default:e(()=>t[18]||(t[18]=[o("提交审核")])),_:1,__:[18]})),[[C,["business:maintenance:edit"]]]):_("",!0),l.value.approvalStatus==="pending"&&U.value?g((c(),v(p,{key:2,type:"success",icon:"CircleCheck",onClick:se},{default:e(()=>t[19]||(t[19]=[o("审核通过")])),_:1,__:[19]})),[[C,["business:maintenance:approve"]]]):_("",!0),l.value.approvalStatus==="pending"&&U.value?g((c(),v(p,{key:3,type:"danger",icon:"CircleClose",onClick:ue},{default:e(()=>t[20]||(t[20]=[o("审核拒绝")])),_:1,__:[20]})),[[C,["business:maintenance:approve"]]]):_("",!0),l.value.approvalStatus==="approved"&&l.value.executionStatus==="pending"?g((c(),v(p,{key:4,type:"warning",icon:"VideoPlay",onClick:re},{default:e(()=>t[21]||(t[21]=[o("开始执行")])),_:1,__:[21]})),[[C,["business:maintenance:execute"]]]):_("",!0),l.value.executionStatus==="executing"?g((c(),v(p,{key:5,type:"primary",icon:"Ticket",onClick:pe},{default:e(()=>t[22]||(t[22]=[o("生成工单")])),_:1,__:[22]})),[[C,["business:maintenance:edit"]]]):_("",!0),a(p,{type:"info",icon:"CopyDocument",onClick:de},{default:e(()=>t[23]||(t[23]=[o("复制计划")])),_:1,__:[23]}),a(p,{type:"info",icon:"Printer",onClick:me},{default:e(()=>t[24]||(t[24]=[o("打印")])),_:1,__:[24]}),a(p,{icon:"Back",onClick:j},{default:e(()=>t[25]||(t[25]=[o("返回")])),_:1,__:[25]})])]),_:1})),[[ke,I.value]]),a(H,{title:"提交审核",modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=i=>S.value=i),width:"500px","append-to-body":""},{footer:e(()=>[r("div",je,[a(p,{type:"primary",onClick:ne},{default:e(()=>t[26]||(t[26]=[o("确 定")])),_:1,__:[26]}),a(p,{onClick:t[2]||(t[2]=i=>S.value=!1)},{default:e(()=>t[27]||(t[27]=[o("取 消")])),_:1,__:[27]})])]),default:e(()=>[a(F,{ref:"submitRef",model:k.value,rules:W,"label-width":"80px"},{default:e(()=>[a(P,{label:"审核人",prop:"approverId"},{default:e(()=>[a(ye,{modelValue:k.value.approverId,"onUpdate:modelValue":t[0]||(t[0]=i=>k.value.approverId=i),placeholder:"请选择审核人"},{default:e(()=>[(c(!0),R(J,null,K(L.value,i=>(c(),v(ge,{key:i.userId,label:i.nickName,value:i.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(P,{label:"说明",prop:"remark"},{default:e(()=>[a(q,{modelValue:k.value.remark,"onUpdate:modelValue":t[1]||(t[1]=i=>k.value.remark=i),type:"textarea",rows:3,placeholder:"请输入说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(H,{title:Y.value,modelValue:y.value,"onUpdate:modelValue":t[6]||(t[6]=i=>y.value=i),width:"500px","append-to-body":""},{footer:e(()=>[r("div",qe,[a(p,{type:"primary",onClick:ie},{default:e(()=>t[28]||(t[28]=[o("确 定")])),_:1,__:[28]}),a(p,{onClick:t[5]||(t[5]=i=>y.value=!1)},{default:e(()=>t[29]||(t[29]=[o("取 消")])),_:1,__:[29]})])]),default:e(()=>[a(F,{ref:"approvalRef",model:T.value,rules:X,"label-width":"80px"},{default:e(()=>[a(P,{label:"审核意见",prop:"comment"},{default:e(()=>[a(q,{modelValue:T.value.comment,"onUpdate:modelValue":t[4]||(t[4]=i=>T.value.comment=i),type:"textarea",rows:4,placeholder:"请输入审核意见"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),Xe=Ne(He,[["__scopeId","data-v-544c9511"]]);export{Xe as default};
