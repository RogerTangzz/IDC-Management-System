import{k as te,g as oe,ar as ue,ap as ne,r as v,c as re,d as se,ac as p,l as _,m,J as e,C as a,G as y,I,$,u as O,B as x,E as B,q as de,H as pe}from"./vue-SR65qDCS.js";import{_ as me,P as ie,J as fe,N as D,Q as ve,R as ce,T as _e}from"./index-Cw83YE5u.js";import{l as ge}from"./user-brpwFzy8.js";import"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const Ve={class:"app-container"},be={key:0,class:"table-editor"},ye=te({name:"MaintenanceForm"}),xe=Object.assign(ye,{setup(Ue){const{proxy:f}=oe(),P=ue(),k=ne(),w=k.params&&k.params.id,R=k.query&&k.query.copy,g=v(!1),q=v(!1),S=v([]),N=v([]),M=v(6),C=v(7),V=v([]),{mop_category:j}=f.useDict("mop_category"),E=re(()=>w?"修改维保计划":q.value?"复制维保计划":"新建维保计划"),o=v({planId:void 0,title:"",floor:"",version:"V1.0",mopCategory:"",executionFrequency:1,executionUnit:"monthly",executionCycle:"",approverId:void 0,mopName:"",mopPurpose:"",notifyUsers:[],tools:"",materials:"",safety:"",specialTools:"",steps:"",inspectionResult:"",remark:"",executorId:void 0,approvalStatus:"draft",executionStatus:"pending"}),J={title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:5,max:100,message:"标题长度在 5 到 100 个字符",trigger:"blur"}],floor:[{required:!0,message:"请选择楼层",trigger:"change"}],version:[{required:!0,message:"请输入版本号",trigger:"blur"},{pattern:/^V\d+\.\d+(\.\d+)?$/,message:"版本号格式应为 V1.0 或 V1.0.1",trigger:"blur"}],mopCategory:[{required:!0,message:"请选择MOP类别",trigger:"change"}],approverId:[{required:!0,message:"请选择审核人",trigger:"change"}],mopName:[{required:!0,message:"请输入MOP名称",trigger:"blur"}],mopPurpose:[{required:!0,message:"请说明MOP目的",trigger:"blur"}],steps:[{required:!0,message:"请输入执行步骤",trigger:"blur"}]};function A(n){g.value=!0,D(n).then(l=>{if(o.value=l.data,o.value.executionCycle){const r=o.value.executionCycle.match(/(\d+)(.+)/);r&&(o.value.executionFrequency=parseInt(r[1]),o.value.executionUnit=r[2])}g.value=!1})}function F(n){g.value=!0,D(n).then(l=>{const r=l.data;delete r.planId,o.value={...r,title:r.title+"(复制)",version:H(r.version),approvalStatus:"draft",executionStatus:"pending",remark:`[复制自计划#${n}，复制时间：${f.parseTime(new Date)}]
${r.remark||""}`},q.value=!0,g.value=!1})}function G(){_e().then(n=>{if(!n.data){f.$modal.msgWarning("没有可复制的计划");return}f.$modal.confirm(`是否复制计划"${n.data.title}"？`).then(()=>{F(n.data.planId),f.$modal.msgSuccess("已复制上次计划")}).catch(()=>{})})}function H(n){const l=n.match(/^V(\d+)\.(\d+)(?:\.(\d+))?$/);if(l){const r=parseInt(l[1]),d=parseInt(l[2]),u=l[3]?parseInt(l[3])+1:1;return`V${r}.${d}.${u}`}return"V1.1"}function Q(){V.value=[];for(let n=0;n<M.value;n++){const l={};for(let r=0;r<C.value;r++)l[`col${r}`]="";V.value.push(l)}f.$modal.msgSuccess("表格已生成")}function W(){f.$refs.maintenanceRef.validate(n=>{n&&(o.value.executionCycle=`${o.value.executionFrequency}${o.value.executionUnit}`,V.value.length>0&&(o.value.steps+=`
`+JSON.stringify(V.value)),o.value.planId!=null?ve(o.value).then(()=>{f.$modal.msgSuccess("修改成功"),P.push("/business/maintenance/plan")}):ce(o.value).then(()=>{f.$modal.msgSuccess("新增成功"),P.push("/business/maintenance/plan")}))})}function z(){f.$modal.confirm("确定要取消吗？未保存的数据将丢失").then(()=>{P.push("/business/maintenance/plan")}).catch(()=>{})}function K(){ge({status:"0"}).then(n=>{S.value=n.rows})}function X(){fe().then(n=>{N.value=n.rows})}return se(()=>{K(),X(),w?A(w):R&&F(R)}),(n,l)=>{const r=p("el-button"),d=p("el-input"),u=p("el-form-item"),s=p("el-col"),i=p("el-option"),b=p("el-select"),c=p("el-row"),L=p("el-divider"),h=p("el-input-number"),Y=p("el-table-column"),Z=p("el-table"),ee=p("el-form"),le=p("el-card");return m(),_("div",Ve,[e(le,null,{header:a(()=>[de("span",null,pe(E.value),1),!O(w)&&!q.value?(m(),x(r,{key:0,link:"",type:"primary",style:{float:"right"},onClick:G},{default:a(()=>l[20]||(l[20]=[y(" 复制上次计划 ")])),_:1,__:[20]})):B("",!0)]),default:a(()=>[e(ee,{ref:"maintenanceRef",model:o.value,rules:J,"label-width":"140px",disabled:g.value},{default:a(()=>[e(c,{gutter:20},{default:a(()=>[e(s,{span:12},{default:a(()=>[e(u,{label:"标题",prop:"title"},{default:a(()=>[e(d,{modelValue:o.value.title,"onUpdate:modelValue":l[0]||(l[0]=t=>o.value.title=t),placeholder:"请输入标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:6},{default:a(()=>[e(u,{label:"楼层编号",prop:"floor"},{default:a(()=>[e(b,{modelValue:o.value.floor,"onUpdate:modelValue":l[1]||(l[1]=t=>o.value.floor=t),placeholder:"请选择楼层"},{default:a(()=>[e(i,{label:"1楼",value:"1"}),e(i,{label:"2楼",value:"2"}),e(i,{label:"3楼",value:"3"}),e(i,{label:"4楼",value:"4"}),e(i,{label:"全部楼层",value:"all"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:6},{default:a(()=>[e(u,{label:"版本",prop:"version"},{default:a(()=>[e(d,{modelValue:o.value.version,"onUpdate:modelValue":l[2]||(l[2]=t=>o.value.version=t),placeholder:"如：V1.0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(L,{"content-position":"left"},{default:a(()=>l[21]||(l[21]=[y("MOP信息")])),_:1,__:[21]}),e(c,{gutter:20},{default:a(()=>[e(s,{span:8},{default:a(()=>[e(u,{label:"MOP类别",prop:"mopCategory"},{default:a(()=>[e(b,{modelValue:o.value.mopCategory,"onUpdate:modelValue":l[3]||(l[3]=t=>o.value.mopCategory=t),placeholder:"请选择"},{default:a(()=>[(m(!0),_(I,null,$(O(j),t=>(m(),x(i,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:a(()=>[e(u,{label:"执行周期",prop:"executionCycle"},{default:a(()=>[e(h,{modelValue:o.value.executionFrequency,"onUpdate:modelValue":l[4]||(l[4]=t=>o.value.executionFrequency=t),min:1,max:365,placeholder:"频次",style:{width:"100px"}},null,8,["modelValue"]),e(b,{modelValue:o.value.executionUnit,"onUpdate:modelValue":l[5]||(l[5]=t=>o.value.executionUnit=t),placeholder:"单位",style:{width:"100px","margin-left":"10px"}},{default:a(()=>[e(i,{label:"次/月",value:"monthly"}),e(i,{label:"次/季",value:"quarterly"}),e(i,{label:"次/年",value:"yearly"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:a(()=>[e(u,{label:"审核人",prop:"approverId"},{default:a(()=>[e(b,{modelValue:o.value.approverId,"onUpdate:modelValue":l[6]||(l[6]=t=>o.value.approverId=t),placeholder:"请选择审核人"},{default:a(()=>[(m(!0),_(I,null,$(N.value,t=>(m(),x(i,{key:t.userId,label:t.nickName,value:t.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:20},{default:a(()=>[e(s,{span:12},{default:a(()=>[e(u,{label:"MOP名称",prop:"mopName"},{default:a(()=>[e(d,{modelValue:o.value.mopName,"onUpdate:modelValue":l[7]||(l[7]=t=>o.value.mopName=t),placeholder:"请输入MOP名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:a(()=>[e(u,{label:"通知相关人员",prop:"notifyUsers"},{default:a(()=>[e(b,{modelValue:o.value.notifyUsers,"onUpdate:modelValue":l[8]||(l[8]=t=>o.value.notifyUsers=t),multiple:"",placeholder:"请选择通知人员"},{default:a(()=>[(m(!0),_(I,null,$(S.value,t=>(m(),x(i,{key:t.userId,label:t.nickName,value:t.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,{label:"MOP目的",prop:"mopPurpose"},{default:a(()=>[e(d,{modelValue:o.value.mopPurpose,"onUpdate:modelValue":l[9]||(l[9]=t=>o.value.mopPurpose=t),type:"textarea",rows:3,placeholder:"请说明维保目的",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(L,{"content-position":"left"},{default:a(()=>l[22]||(l[22]=[y("执行信息")])),_:1,__:[22]}),e(c,{gutter:20},{default:a(()=>[e(s,{span:12},{default:a(()=>[e(u,{label:"工具仪表",prop:"tools"},{default:a(()=>[e(d,{modelValue:o.value.tools,"onUpdate:modelValue":l[10]||(l[10]=t=>o.value.tools=t),type:"textarea",rows:2,placeholder:"列举所需工具"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:a(()=>[e(u,{label:"材料",prop:"materials"},{default:a(()=>[e(d,{modelValue:o.value.materials,"onUpdate:modelValue":l[11]||(l[11]=t=>o.value.materials=t),type:"textarea",rows:2,placeholder:"列举所需材料"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{gutter:20},{default:a(()=>[e(s,{span:12},{default:a(()=>[e(u,{label:"安全（PPE）",prop:"safety"},{default:a(()=>[e(d,{modelValue:o.value.safety,"onUpdate:modelValue":l[12]||(l[12]=t=>o.value.safety=t),type:"textarea",rows:2,placeholder:"个人防护装备要求"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:a(()=>[e(u,{label:"特殊工具",prop:"specialTools"},{default:a(()=>[e(d,{modelValue:o.value.specialTools,"onUpdate:modelValue":l[13]||(l[13]=t=>o.value.specialTools=t),type:"textarea",rows:2,placeholder:"所需配件"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,{label:"执行步骤",prop:"steps"},{default:a(()=>[e(O(ie),{modelValue:o.value.steps,"onUpdate:modelValue":l[14]||(l[14]=t=>o.value.steps=t),"min-height":192},null,8,["modelValue"])]),_:1}),e(u,{label:"创建表格"},{default:a(()=>[e(c,{gutter:10},{default:a(()=>[e(s,{span:4},{default:a(()=>[e(h,{modelValue:M.value,"onUpdate:modelValue":l[15]||(l[15]=t=>M.value=t),min:1,max:20,placeholder:"行数"},null,8,["modelValue"])]),_:1}),e(s,{span:4},{default:a(()=>[e(h,{modelValue:C.value,"onUpdate:modelValue":l[16]||(l[16]=t=>C.value=t),min:1,max:10,placeholder:"列数"},null,8,["modelValue"])]),_:1}),e(s,{span:4},{default:a(()=>[e(r,{type:"primary",onClick:Q},{default:a(()=>l[23]||(l[23]=[y("生成表格")])),_:1,__:[23]})]),_:1})]),_:1}),V.value.length>0?(m(),_("div",be,[e(Z,{data:V.value,border:"",style:{"margin-top":"10px"}},{default:a(()=>[(m(!0),_(I,null,$(C.value,(t,U)=>(m(),x(Y,{key:U,prop:`col${U}`,label:`列${U+1}`},{default:a(T=>[e(d,{modelValue:T.row[`col${U}`],"onUpdate:modelValue":ae=>T.row[`col${U}`]=ae},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data"])])):B("",!0)]),_:1}),e(c,{gutter:20},{default:a(()=>[e(s,{span:12},{default:a(()=>[e(u,{label:"巡检结果",prop:"inspectionResult"},{default:a(()=>[e(d,{modelValue:o.value.inspectionResult,"onUpdate:modelValue":l[17]||(l[17]=t=>o.value.inspectionResult=t),type:"textarea",rows:3,placeholder:"巡检结果记录"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:a(()=>[e(u,{label:"备注",prop:"remark"},{default:a(()=>[e(d,{modelValue:o.value.remark,"onUpdate:modelValue":l[18]||(l[18]=t=>o.value.remark=t),type:"textarea",rows:3,placeholder:"备注信息"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,{label:"执行审核人",prop:"executorId"},{default:a(()=>[e(b,{modelValue:o.value.executorId,"onUpdate:modelValue":l[19]||(l[19]=t=>o.value.executorId=t),placeholder:"请选择执行审核人"},{default:a(()=>[(m(!0),_(I,null,$(N.value,t=>(m(),x(i,{key:t.userId,label:t.nickName,value:t.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:a(()=>[e(r,{type:"primary",onClick:W,loading:g.value},{default:a(()=>l[24]||(l[24]=[y(" 确 定 ")])),_:1,__:[24]},8,["loading"]),e(r,{onClick:z},{default:a(()=>l[25]||(l[25]=[y("取 消")])),_:1,__:[25]})]),_:1})]),_:1},8,["model","disabled"])]),_:1})])}}}),Pe=me(xe,[["__scopeId","data-v-4df4c775"]]);export{Pe as default};
