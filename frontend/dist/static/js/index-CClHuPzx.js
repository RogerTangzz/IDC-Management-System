import{k as D,g as I,ar as L,r as d,d as M,ac as r,ag as h,l as R,m as c,J as a,C as t,D as N,B as f,G as m,H as q,u as E,E as z,K as Y,q as b}from"./vue-SR65qDCS.js";import{m as j,X as G,Y as H,Z as J,$ as K}from"./index-Cw83YE5u.js";import"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const O={class:"app-container"},P={class:"header"},X={class:"ops"},Z=D({name:"MessageCenter"}),te=Object.assign(Z,{setup(Q){const{proxy:y}=I(),S=L(),k=d([]),v=d(!1),_=d(0),i=d({pageNum:1,pageSize:10}),s=d({readFlag:"N",type:""});async function u(){v.value=!0;try{const o={pageNum:i.value.pageNum,pageSize:i.value.pageSize};let e;s.value.readFlag==="N"?e=await G(o):e=await H({...o,readFlag:s.value.readFlag,type:s.value.type}),k.value=e.rows||e.data||[],_.value=e.total||0}finally{v.value=!1}}async function V(o){await J(o),y.$modal.msgSuccess("已标记已读"),u()}async function x(){await K(),y.$modal.msgSuccess("全部已读"),u()}function w(){i.value.pageNum=1,u()}function F(o){o&&o.bizType==="ticket"&&o.bizId&&S.push(`/business/ticket/detail/${o.bizId}`)}return M(u),(o,e)=>{const n=r("el-option"),C=r("el-select"),g=r("el-button"),p=r("el-table-column"),T=r("el-table"),$=r("pagination"),B=r("el-card"),U=h("loading");return c(),R("div",O,[a(B,{shadow:"never"},{header:t(()=>[b("div",P,[e[6]||(e[6]=b("span",null,"消息中心",-1)),b("div",X,[a(C,{modelValue:s.value.readFlag,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.readFlag=l),size:"small",style:{width:"120px","margin-right":"8px"},onChange:w},{default:t(()=>[a(n,{label:"未读",value:"N"}),a(n,{label:"全部",value:"ALL"}),a(n,{label:"已读",value:"Y"})]),_:1},8,["modelValue"]),a(C,{modelValue:s.value.type,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.type=l),size:"small",clearable:"",placeholder:"类型",style:{width:"160px","margin-right":"8px"},onChange:w},{default:t(()=>[a(n,{label:"SLA预警",value:"sla_warn"}),a(n,{label:"已超时",value:"sla_overdue"}),a(n,{label:"指派",value:"assign"}),a(n,{label:"开始处理",value:"start"}),a(n,{label:"完成",value:"complete"}),a(n,{label:"关闭",value:"close"}),a(n,{label:"重新打开",value:"reopen"})]),_:1},8,["modelValue"]),a(g,{size:"small",onClick:u},{default:t(()=>e[4]||(e[4]=[m("刷新")])),_:1,__:[4]}),s.value.readFlag==="N"?(c(),f(g,{key:0,type:"primary",size:"small",onClick:x},{default:t(()=>e[5]||(e[5]=[m("全部标记已读")])),_:1,__:[5]})):z("",!0)])])]),default:t(()=>[N((c(),f(T,{data:k.value},{default:t(()=>[a(p,{label:"类型",prop:"type",width:"120"}),a(p,{label:"标题",prop:"title"}),a(p,{label:"内容",prop:"content"}),a(p,{label:"时间",prop:"createTime",width:"180"},{default:t(l=>[m(q(E(j)(l.row.createTime)),1)]),_:1}),a(p,{label:"操作",width:"200"},{default:t(l=>[a(g,{type:"primary",link:"",onClick:A=>V(l.row.msgId)},{default:t(()=>e[7]||(e[7]=[m("标记已读")])),_:2,__:[7]},1032,["onClick"]),l.row.bizType==="ticket"?(c(),f(g,{key:0,type:"primary",link:"",onClick:A=>F(l.row)},{default:t(()=>e[8]||(e[8]=[m("查看")])),_:2,__:[8]},1032,["onClick"])):z("",!0)]),_:1})]),_:1},8,["data"])),[[U,v.value]]),N(a($,{total:_.value,page:i.value.pageNum,"onUpdate:page":e[2]||(e[2]=l=>i.value.pageNum=l),limit:i.value.pageSize,"onUpdate:limit":e[3]||(e[3]=l=>i.value.pageSize=l),onPagination:u},null,8,["total","page","limit"]),[[Y,_.value>0]])]),_:1})])}}});export{te as default};
