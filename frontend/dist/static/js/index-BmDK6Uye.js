import{k as ce,g as me,ar as fe,r as _,P as _e,a7 as ge,ac as s,ag as F,l as U,m as r,D as m,J as t,K as O,u as a,C as n,I as ye,$ as be,B as d,Z as we,h as P,G as i,H as x,E as q,q as z}from"./vue-SR65qDCS.js";import{l as ve,d as Ce,b as he}from"./inspection-INzddNo1.js";import{_ as ke,F as Ve}from"./index-Cw83YE5u.js";import"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const De={class:"app-container"},Se={key:1},xe={class:"statistics-content"},Ie={class:"dialog-footer"},Ne=ce({name:"Inspection"}),$e=Object.assign(Ne,{setup(Re){const{proxy:f}=me(),w=fe(),I=_([]),N=_(!0),V=_(!0),B=_([]),K=_(!0),L=_(!0),$=_(0),v=_([]),C=_(!1),Q=_e({form:{},queryParams:{pageNum:1,pageSize:10,floor:void 0,inspectorName:void 0,hasAnomaly:void 0},statistics:{monthCount:0,monthAnomalyCount:0,handleRate:0}}),{queryParams:u,form:Te,statistics:D}=ge(Q);function b(){N.value=!0;let l=f.addDateRange(u.value,v.value);ve(l).then(e=>{I.value=e.rows,$.value=e.total,N.value=!1})}function R(){u.value.pageNum=1,b()}function G(){v.value=[],f.resetForm("queryRef"),R()}function M(l){B.value=l.map(e=>e.inspectionId),K.value=l.length!=1,L.value=!l.length}function j(){w.push("/business/inspection/create")}function H(){const l=I.value.filter(e=>e.status==="completed").sort((e,h)=>new Date(h.inspectionDate)-new Date(e.inspectionDate))[0];l?w.push("/business/inspection/create?copy="+l.inspectionId):f.$modal.msgWarning("暂无可复制的已完成巡检记录")}function J(l){w.push("/business/inspection/detail/"+l.inspectionId)}function W(l){w.push("/business/inspection/edit/"+l.inspectionId)}function Z(l){f.$modal.confirm("是否复制该巡检记录？").then(function(){w.push("/business/inspection/create?copy="+l.inspectionId)}).catch(()=>{})}function X(l){f.$modal.confirm("检测到"+l.anomalyCount+"个异常项，是否生成工单？").then(function(){return he(l.inspectionId,l.anomalies)}).then(()=>{f.$modal.msgSuccess("已生成"+l.anomalyCount+"个工单"),b()}).catch(()=>{})}function ee(l){const e=l.inspectionId||B.value;f.$modal.confirm('是否确认删除巡检编号为"'+e+'"的数据项？').then(function(){return Ce(e)}).then(()=>{b(),f.$modal.msgSuccess("删除成功")}).catch(()=>{})}function te(){f.download("business/inspection/export",{...u.value},`inspection_${new Date().getTime()}.xlsx`)}function ne(){D.value={monthCount:45,monthAnomalyCount:23,handleRate:87.5},C.value=!0}return b(),(l,e)=>{const h=s("el-option"),Y=s("el-select"),k=s("el-form-item"),oe=s("el-input"),le=s("el-date-picker"),c=s("el-button"),ae=s("el-form"),g=s("el-col"),ie=s("right-toolbar"),E=s("el-row"),p=s("el-table-column"),se=s("el-progress"),S=s("el-tag"),re=s("el-table"),ue=s("pagination"),T=s("el-statistic"),de=s("el-dialog"),y=F("hasPermi"),pe=F("loading");return r(),U("div",De,[m(t(ae,{model:a(u),ref:"queryRef",inline:!0,"label-width":"68px"},{default:n(()=>[t(k,{label:"楼层",prop:"floor"},{default:n(()=>[t(Y,{modelValue:a(u).floor,"onUpdate:modelValue":e[0]||(e[0]=o=>a(u).floor=o),placeholder:"请选择楼层",clearable:""},{default:n(()=>[(r(!0),U(ye,null,be(a(Ve),o=>(r(),d(h,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"巡检人",prop:"inspectorName"},{default:n(()=>[t(oe,{modelValue:a(u).inspectorName,"onUpdate:modelValue":e[1]||(e[1]=o=>a(u).inspectorName=o),placeholder:"请输入巡检人",clearable:"",onKeyup:we(R,["enter"])},null,8,["modelValue"])]),_:1}),t(k,{label:"巡检日期"},{default:n(()=>[t(le,{modelValue:a(v),"onUpdate:modelValue":e[2]||(e[2]=o=>P(v)?v.value=o:null),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(k,{label:"异常项",prop:"hasAnomaly"},{default:n(()=>[t(Y,{modelValue:a(u).hasAnomaly,"onUpdate:modelValue":e[3]||(e[3]=o=>a(u).hasAnomaly=o),placeholder:"全部",clearable:""},{default:n(()=>[t(h,{label:"有异常",value:1}),t(h,{label:"无异常",value:0})]),_:1},8,["modelValue"])]),_:1}),t(k,null,{default:n(()=>[t(c,{type:"primary",icon:"Search",onClick:R},{default:n(()=>e[9]||(e[9]=[i("搜索")])),_:1,__:[9]}),t(c,{icon:"Refresh",onClick:G},{default:n(()=>e[10]||(e[10]=[i("重置")])),_:1,__:[10]})]),_:1})]),_:1},8,["model"]),[[O,a(V)]]),t(E,{gutter:10,class:"mb8"},{default:n(()=>[t(g,{span:1.5},{default:n(()=>[m((r(),d(c,{type:"primary",plain:"",icon:"Plus",onClick:j},{default:n(()=>e[11]||(e[11]=[i("开始巡检")])),_:1,__:[11]})),[[y,["business:inspection:add"]]])]),_:1}),t(g,{span:1.5},{default:n(()=>[m((r(),d(c,{type:"success",plain:"",icon:"DocumentCopy",onClick:H},{default:n(()=>e[12]||(e[12]=[i("复制上次")])),_:1,__:[12]})),[[y,["business:inspection:add"]]])]),_:1}),t(g,{span:1.5},{default:n(()=>[m((r(),d(c,{type:"danger",plain:"",icon:"Delete",disabled:a(L),onClick:ee},{default:n(()=>e[13]||(e[13]=[i("删除")])),_:1,__:[13]},8,["disabled"])),[[y,["business:inspection:remove"]]])]),_:1}),t(g,{span:1.5},{default:n(()=>[m((r(),d(c,{type:"warning",plain:"",icon:"Download",onClick:te},{default:n(()=>e[14]||(e[14]=[i("导出")])),_:1,__:[14]})),[[y,["business:inspection:export"]]])]),_:1}),t(g,{span:1.5},{default:n(()=>[t(c,{type:"info",plain:"",icon:"DataAnalysis",onClick:ne},{default:n(()=>e[15]||(e[15]=[i("统计分析")])),_:1,__:[15]})]),_:1}),t(ie,{showSearch:a(V),"onUpdate:showSearch":e[4]||(e[4]=o=>P(V)?V.value=o:null),onQueryTable:b},null,8,["showSearch"])]),_:1}),m((r(),d(re,{data:a(I),onSelectionChange:M},{default:n(()=>[t(p,{type:"selection",width:"55",align:"center"}),t(p,{label:"巡检编号",align:"center",prop:"inspectionNo",width:"120"}),t(p,{label:"楼层",align:"center",prop:"floor",width:"80"}),t(p,{label:"巡检人",align:"center",prop:"inspectorName",width:"100"}),t(p,{label:"接力人员",align:"center",prop:"relayPerson",width:"100"}),t(p,{label:"巡检日期",align:"center",prop:"inspectionDate",width:"110"},{default:n(o=>[i(x(l.parseTime(o.row.inspectionDate,"{y}-{m}-{d}")),1)]),_:1}),t(p,{label:"完成进度",align:"center",prop:"progress",width:"100"},{default:n(o=>[t(se,{percentage:o.row.progress,width:70,"stroke-width":6,color:o.row.progress===100?"#67c23a":"#409eff"},null,8,["percentage","color"])]),_:1}),t(p,{label:"异常项数",align:"center",prop:"anomalyCount",width:"90"},{default:n(o=>[o.row.anomalyCount>0?(r(),d(S,{key:0,type:"danger"},{default:n(()=>[i(x(o.row.anomalyCount)+"项 ",1)]),_:2},1024)):(r(),d(S,{key:1,type:"success"},{default:n(()=>e[16]||(e[16]=[i("正常")])),_:1,__:[16]}))]),_:1}),t(p,{label:"生成工单",align:"center",prop:"ticketCount",width:"90"},{default:n(o=>[o.row.ticketCount>0?(r(),d(S,{key:0,type:"warning"},{default:n(()=>[i(x(o.row.ticketCount)+"个 ",1)]),_:2},1024)):(r(),U("span",Se,"-"))]),_:1}),t(p,{label:"复制标记",align:"center",prop:"isCopied",width:"90"},{default:n(o=>[o.row.isCopied==="Y"?(r(),d(S,{key:0,type:"info"},{default:n(()=>e[17]||(e[17]=[i("复制")])),_:1,__:[17]})):q("",!0)]),_:1}),t(p,{label:"备注",align:"left",prop:"remark","show-overflow-tooltip":!0}),t(p,{label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:n(o=>[i(x(l.parseTime(o.row.createTime)),1)]),_:1}),t(p,{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"200"},{default:n(o=>[m((r(),d(c,{link:"",type:"primary",icon:"View",onClick:A=>J(o.row)},{default:n(()=>e[18]||(e[18]=[i("查看")])),_:2,__:[18]},1032,["onClick"])),[[y,["business:inspection:query"]]]),o.row.progress<100?m((r(),d(c,{key:0,link:"",type:"primary",icon:"Edit",onClick:A=>W(o.row)},{default:n(()=>e[19]||(e[19]=[i("继续")])),_:2,__:[19]},1032,["onClick"])),[[y,["business:inspection:edit"]]]):q("",!0),m((r(),d(c,{link:"",type:"success",icon:"DocumentCopy",onClick:A=>Z(o.row)},{default:n(()=>e[20]||(e[20]=[i("复制")])),_:2,__:[20]},1032,["onClick"])),[[y,["business:inspection:add"]]]),o.row.anomalyCount>0&&o.row.ticketCount===0?m((r(),d(c,{key:1,link:"",type:"warning",icon:"Tickets",onClick:A=>X(o.row)},{default:n(()=>e[21]||(e[21]=[i("生成工单")])),_:2,__:[21]},1032,["onClick"])),[[y,["business:inspection:add"]]]):q("",!0)]),_:1})]),_:1},8,["data"])),[[pe,a(N)]]),m(t(ue,{total:a($),page:a(u).pageNum,"onUpdate:page":e[5]||(e[5]=o=>a(u).pageNum=o),limit:a(u).pageSize,"onUpdate:limit":e[6]||(e[6]=o=>a(u).pageSize=o),onPagination:b},null,8,["total","page","limit"]),[[O,a($)>0]]),t(de,{title:"巡检统计",modelValue:a(C),"onUpdate:modelValue":e[8]||(e[8]=o=>P(C)?C.value=o:null),width:"800px","append-to-body":""},{footer:n(()=>[z("div",Ie,[t(c,{onClick:e[7]||(e[7]=o=>C.value=!1)},{default:n(()=>e[22]||(e[22]=[i("关闭")])),_:1,__:[22]})])]),default:n(()=>[z("div",xe,[t(E,{gutter:20},{default:n(()=>[t(g,{span:8},{default:n(()=>[t(T,{title:"本月巡检次数",value:a(D).monthCount},null,8,["value"])]),_:1}),t(g,{span:8},{default:n(()=>[t(T,{title:"本月异常总数",value:a(D).monthAnomalyCount},null,8,["value"])]),_:1}),t(g,{span:8},{default:n(()=>[t(T,{title:"异常处理率",value:a(D).handleRate,suffix:"%"},null,8,["value"])]),_:1})]),_:1})])]),_:1},8,["modelValue"])])}}}),Le=ke($e,[["__scopeId","data-v-1c7525e5"]]);export{Le as default};
