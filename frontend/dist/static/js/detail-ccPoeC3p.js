import{ac as i,B as x,m as p,C as t,G as s,H as o,ap as $,ar as G,r as P,d as z,ag as F,l as g,D as J,J as a,E as k,q as b,u as N,I as Y,$ as K}from"./vue-SR65qDCS.js";import{_ as Q,m as S,N as U,O as W}from"./index-Cw83YE5u.js";import"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const X={__name:"StatusTag",props:{status:{type:String,required:!0},effect:{type:String,default:"light"}},setup(m){const _={pending:{label:"待处理",type:"warning"},processing:{label:"处理中",type:""},completed:{label:"已完成",type:"success"},closed:{label:"已关闭",type:"info"},draft:{label:"草稿",type:"info"},approved:{label:"已批准",type:"success"},rejected:{label:"已拒绝",type:"danger"},executing:{label:"执行中",type:"primary"},cancelled:{label:"已取消",type:"info"}},f=c=>{var e;return((e=_[c])==null?void 0:e.type)||"info"},v=c=>{var e;return((e=_[c])==null?void 0:e.label)||c};return(c,e)=>{const C=i("el-tag");return p(),x(C,{type:f(m.status),effect:m.effect,size:"small"},{default:t(()=>[s(o(v(m.status)),1)]),_:1},8,["type","effect"])}}},Z={class:"maintenance-plan-detail"},ee={class:"header-wrapper"},te={class:"actions"},ae=["innerHTML"],le={key:0,class:"approval-history"},ne={key:0},se={__name:"detail",setup(m){const _=(l,r)=>{var d;const{[l]:y}=W(l),n=(d=y.value)==null?void 0:d.find(T=>T.value===r);return n?n.label:r},f=$(),v=G(),c=P(!1),e=P({title:"-",floor:"-",version:"-",mopCategory:void 0,executionCycle:{},approvalStatus:"",executionStatus:"",approverName:"-",executorName:"-",mopName:"-",mopPurpose:"-",tools:"-",materials:"-",safety:"-",specialTools:"-",steps:"",inspectionResult:"-",remark:"-"}),C=async()=>{c.value=!0;try{const l=await U(f.params.planId||f.params.id),r=(l==null?void 0:l.data)||l;e.value={...e.value,...r}}catch(l){console.error("加载维保计划失败",l)}finally{c.value=!1}},E=()=>{v.push(`/business/maintenance/plan/form/${e.value.planId||e.value.id}`)},O=()=>{v.back()},w=l=>_("MOP_CATEGORY",l),D=l=>{const r={daily:"success",regular:"info",annual:"warning",emergency:"danger"};return r[l]?r[l]:"info"},L=l=>({pending:"待执行",executing:"执行中",completed:"已完成"})[l]||l,B=l=>({pending:"warning",executing:"primary",completed:"success"})[l]||"info",A=l=>({submit:"primary",approve:"success",reject:"danger"})[l]||"",H=l=>({submit:"提交审核",approve:"审核通过",reject:"审核拒绝"})[l]||l;return z(()=>{C()}),(l,r)=>{const y=i("el-button"),n=i("el-descriptions-item"),d=i("el-tag"),T=i("el-descriptions"),R=i("el-divider"),I=i("el-timeline-item"),V=i("el-timeline"),j=i("el-card"),q=F("loading");return p(),g("div",Z,[J((p(),x(j,null,{header:t(()=>[b("div",ee,[r[2]||(r[2]=b("span",null,"维保计划详情",-1)),b("div",te,[e.value.approvalStatus==="draft"?(p(),x(y,{key:0,type:"primary",onClick:E},{default:t(()=>r[0]||(r[0]=[s(" 编辑 ")])),_:1,__:[0]})):k("",!0),a(y,{onClick:O},{default:t(()=>r[1]||(r[1]=[s("返回")])),_:1,__:[1]})])])]),default:t(()=>{var h;return[a(T,{column:2,border:""},{default:t(()=>[a(n,{label:"计划标题",span:2},{default:t(()=>[s(o(e.value.title),1)]),_:1}),a(n,{label:"楼层"},{default:t(()=>[s(o(e.value.floor),1)]),_:1}),a(n,{label:"版本"},{default:t(()=>[s(o(e.value.version),1)]),_:1}),a(n,{label:"MOP类别"},{default:t(()=>[a(d,{type:D(e.value.mopCategory)},{default:t(()=>[s(o(w(e.value.mopCategory)),1)]),_:1},8,["type"])]),_:1}),a(n,{label:"执行周期"},{default:t(()=>{var u,M;return[s(o((u=e.value.executionCycle)==null?void 0:u.frequency)+o((M=e.value.executionCycle)==null?void 0:M.unit),1)]}),_:1}),a(n,{label:"审核状态"},{default:t(()=>[a(X,{module:"maintenance",status:e.value.approvalStatus},null,8,["status"])]),_:1}),a(n,{label:"执行状态"},{default:t(()=>[a(d,{type:B(e.value.executionStatus)},{default:t(()=>[s(o(L(e.value.executionStatus)),1)]),_:1},8,["type"])]),_:1}),a(n,{label:"审核人"},{default:t(()=>[s(o(e.value.approverName||"-"),1)]),_:1}),a(n,{label:"执行审核人"},{default:t(()=>[s(o(e.value.executorName||"-"),1)]),_:1}),a(n,{label:"MOP名称",span:2},{default:t(()=>[s(o(e.value.mopName),1)]),_:1}),a(n,{label:"MOP目的",span:2},{default:t(()=>[s(o(e.value.mopPurpose),1)]),_:1}),a(n,{label:"工具仪表",span:2},{default:t(()=>[s(o(e.value.tools||"-"),1)]),_:1}),a(n,{label:"材料",span:2},{default:t(()=>[s(o(e.value.materials||"-"),1)]),_:1}),a(n,{label:"安全PPE",span:2},{default:t(()=>[s(o(e.value.safety||"-"),1)]),_:1}),a(n,{label:"特殊工具",span:2},{default:t(()=>[s(o(e.value.specialTools||"-"),1)]),_:1}),a(n,{label:"步骤内容",span:2},{default:t(()=>[b("div",{innerHTML:e.value.steps,class:"steps-content"},null,8,ae)]),_:1}),a(n,{label:"巡检结果",span:2},{default:t(()=>[s(o(e.value.inspectionResult||"-"),1)]),_:1}),a(n,{label:"备注",span:2},{default:t(()=>[s(o(e.value.remark||"-"),1)]),_:1}),a(n,{label:"创建时间"},{default:t(()=>[s(o(N(S)(e.value.createTime)),1)]),_:1}),a(n,{label:"下次执行时间"},{default:t(()=>[s(o(e.value.nextExecutionTime?N(S)(e.value.nextExecutionTime):"-"),1)]),_:1})]),_:1}),(h=e.value.approvalHistory)!=null&&h.length?(p(),g("div",le,[a(R,{"content-position":"left"},{default:t(()=>r[3]||(r[3]=[s("审批历史")])),_:1,__:[3]}),a(V,null,{default:t(()=>[(p(!0),g(Y,null,K(e.value.approvalHistory,u=>(p(),x(I,{key:u.id,timestamp:N(S)(u.time),type:A(u.action)},{default:t(()=>[s(o(u.operatorName)+" "+o(H(u.action))+" ",1),u.comment?(p(),g("span",ne,"："+o(u.comment),1)):k("",!0)]),_:2},1032,["timestamp","type"]))),128))]),_:1})])):k("",!0)]}),_:1})),[[q,c.value]])])}}},ie=Q(se,[["__scopeId","data-v-e51b4e98"]]);export{ie as default};
