import{k as O,g as Q,ar as W,ap as X,r as v,c as Z,d as ee,ac as r,ag as le,l as g,m as d,J as l,q as te,C as t,B as f,E as ae,I as b,$ as k,u as w,G as c,H as oe,D as E}from"./vue-SR65qDCS.js";import{_ as ie}from"./index-Cw83YE5u.js";import"./element-D8D5Bqo2.js";import"./vendor-C71Ev03J.js";const ne={class:"app-container"},ue={class:"form-footer"},re=O({name:"TicketForm"}),de=Object.assign(re,{setup(se){const{proxy:s}=Q(),U=W(),q=X(),y=q.params&&q.params.id,{ticket_priority:P,equipment_specialty:Y}=s.useDict("ticket_priority","equipment_specialty"),o=v({ticketId:void 0,ticketNo:void 0,title:"",priority:"medium",status:"pending",reporter:"",equipment:"",specialty:"",description:"",discoveryTime:"",deadline:"",assigneeId:void 0,emergencyAction:"",attachments:"",notifyEngineer:!1,notifySms:!1,notifyEmail:!1}),H={title:[{required:!0,message:"工单标题不能为空",trigger:"blur"},{min:5,max:100,message:"标题长度在 5 到 100 个字符",trigger:"blur"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],reporter:[{required:!0,message:"报修人不能为空",trigger:"blur"}],equipment:[{required:!0,message:"故障设备不能为空",trigger:"blur"}],specialty:[{required:!0,message:"请选择设备专业",trigger:"change"}],description:[{required:!0,message:"故障描述不能为空",trigger:"blur"},{min:10,max:500,message:"描述长度在 10 到 500 个字符",trigger:"blur"}],discoveryTime:[{required:!0,message:"请选择发现时间",trigger:"change"}]},x=v([]),D=v([{templateId:1,templateName:"空调漏水",title:"空调漏水处理",priority:"low",specialty:"hvac",description:"空调内机漏水",emergencyAction:"放置接水容器"},{templateId:2,templateName:"UPS故障",title:"UPS电池故障",priority:"high",specialty:"power",description:"UPS告警",emergencyAction:"检查UPS状态"},{templateId:3,templateName:"温度告警",title:"机房温度过高",priority:"high",specialty:"hvac",description:"温度超标",emergencyAction:"开启备用空调"}]),C=v(void 0),$=v([new Date(2e3,0,1,0,0,0),new Date(2e3,0,1,23,59,59)]),N=Z(()=>({high:"4小时",medium:"8小时",low:"24小时"})[o.value.priority]||"");function I(){if(!o.value.discoveryTime)return"";const i={high:4,medium:8,low:24}[o.value.priority]||24,e=new Date(o.value.discoveryTime);return e.setHours(e.getHours()+i),s.parseTime(e,"{y}-{m}-{d} {h}:{i}")}function B(i){return{high:"danger",medium:"warning",low:"info"}[i]||"info"}function L(i){o.value.discoveryTime&&(o.value.deadline=I())}function M(i){i&&s.$modal.confirm("是否使用该模板填充表单？").then(()=>{const e=D.value.find(p=>p.templateId===i);e&&(o.value.title=e.title,o.value.priority=e.priority,o.value.specialty=e.specialty,o.value.description=e.description,o.value.emergencyAction=e.emergencyAction,s.$modal.msgSuccess("已应用模板"))}).catch(()=>{i.value=void 0})}function S(){s.$refs.ticketRef.validate(i=>{i&&(o.value.deadline=I(),s.$modal.msgSuccess(o.value.ticketId?"修改成功":"新增成功"),U.push("/business/ticket"))})}function R(){s.$modal.confirm("确定要取消吗？未保存的数据将丢失").then(()=>{U.push("/business/ticket")}).catch(()=>{})}function j(){x.value=[{userId:1,nickName:"张三"},{userId:2,nickName:"李四"},{userId:3,nickName:"王五"}]}function F(i){o.value={ticketId:i,ticketNo:"TK202501001",title:"空调漏水处理",priority:"high",status:"pending",reporter:"张三",equipment:"空调01",specialty:"hvac",description:"空调内机漏水，地面有积水",discoveryTime:s.parseTime(new Date),emergencyAction:"已放置接水容器"}}return ee(()=>{j(),y?F(y):o.value.discoveryTime=s.parseTime(new Date)}),(i,e)=>{const p=r("el-input"),n=r("el-form-item"),u=r("el-col"),_=r("el-option"),V=r("el-select"),m=r("el-row"),z=r("el-tag"),G=r("el-date-picker"),J=r("file-upload"),T=r("el-checkbox"),K=r("el-form"),h=r("el-button"),A=le("hasPermi");return d(),g("div",ne,[l(K,{ref:"ticketRef",model:o.value,rules:H,"label-width":"120px"},{default:t(()=>[l(m,null,{default:t(()=>[l(u,{span:12},{default:t(()=>[l(n,{label:"工单标题",prop:"title"},{default:t(()=>[l(p,{modelValue:o.value.title,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.title=a),placeholder:"请输入工单标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:12},{default:t(()=>[l(n,{label:"优先级",prop:"priority"},{default:t(()=>[l(V,{modelValue:o.value.priority,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.priority=a),placeholder:"请选择优先级",onChange:L},{default:t(()=>[(d(!0),g(b,null,k(w(P),a=>(d(),f(_,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(u,{span:12},{default:t(()=>[l(n,{label:"报修人",prop:"reporter"},{default:t(()=>[l(p,{modelValue:o.value.reporter,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.reporter=a),placeholder:"请输入报修人姓名"},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:12},{default:t(()=>[l(n,{label:"处理时限"},{default:t(()=>[l(p,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=a=>N.value=a),disabled:""},{append:t(()=>[l(z,{type:B(o.value.priority)},{default:t(()=>[c(oe(I()),1)]),_:1},8,["type"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(u,{span:12},{default:t(()=>[l(n,{label:"故障设备",prop:"equipment"},{default:t(()=>[l(p,{modelValue:o.value.equipment,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.equipment=a),placeholder:"请输入故障设备名称"},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:12},{default:t(()=>[l(n,{label:"设备专业",prop:"specialty"},{default:t(()=>[l(V,{modelValue:o.value.specialty,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.specialty=a),placeholder:"请选择设备专业"},{default:t(()=>[(d(!0),g(b,null,k(w(Y),a=>(d(),f(_,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(u,{span:24},{default:t(()=>[l(n,{label:"故障描述",prop:"description"},{default:t(()=>[l(p,{modelValue:o.value.description,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.description=a),type:"textarea",rows:4,placeholder:"请详细描述设备故障状况及位置",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(u,{span:12},{default:t(()=>[l(n,{label:"发现时间",prop:"discoveryTime"},{default:t(()=>[l(G,{modelValue:o.value.discoveryTime,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.discoveryTime=a),type:"datetime",placeholder:"选择故障发现时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss","default-time":$.value},null,8,["modelValue","default-time"])]),_:1})]),_:1}),l(u,{span:12},{default:t(()=>[l(n,{label:"指派给",prop:"assigneeId"},{default:t(()=>[l(V,{modelValue:o.value.assigneeId,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.assigneeId=a),placeholder:"请选择处理人员",clearable:""},{default:t(()=>[(d(!0),g(b,null,k(x.value,a=>(d(),f(_,{key:a.userId,label:a.nickName,value:a.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(u,{span:24},{default:t(()=>[l(n,{label:"应急处置",prop:"emergencyAction"},{default:t(()=>[l(p,{modelValue:o.value.emergencyAction,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.emergencyAction=a),type:"textarea",rows:3,placeholder:"请输入应急处置方法",maxlength:"300","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),w(y)?ae("",!0):(d(),f(m,{key:0},{default:t(()=>[l(u,{span:24},{default:t(()=>[l(n,{label:"选择模板"},{default:t(()=>[l(V,{modelValue:C.value,"onUpdate:modelValue":e[10]||(e[10]=a=>C.value=a),placeholder:"可选择工单模板快速填充",clearable:"",onChange:M},{default:t(()=>[(d(!0),g(b,null,k(D.value,a=>(d(),f(_,{key:a.templateId,label:a.templateName,value:a.templateId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})),l(m,null,{default:t(()=>[l(u,{span:24},{default:t(()=>[l(n,{label:"附件上传"},{default:t(()=>[l(J,{modelValue:o.value.attachments,"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.attachments=a),limit:5,fileSize:10,fileType:["jpg","jpeg","png","gif","mp4","avi"],isShowTip:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,null,{default:t(()=>[l(u,{span:24},{default:t(()=>[l(n,{label:"通知设置"},{default:t(()=>[l(T,{modelValue:o.value.notifyEngineer,"onUpdate:modelValue":e[12]||(e[12]=a=>o.value.notifyEngineer=a)},{default:t(()=>e[15]||(e[15]=[c("通知专业工程师")])),_:1,__:[15]},8,["modelValue"]),l(T,{modelValue:o.value.notifySms,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.notifySms=a)},{default:t(()=>e[16]||(e[16]=[c("短信通知")])),_:1,__:[16]},8,["modelValue"]),l(T,{modelValue:o.value.notifyEmail,"onUpdate:modelValue":e[14]||(e[14]=a=>o.value.notifyEmail=a)},{default:t(()=>e[17]||(e[17]=[c("邮件通知")])),_:1,__:[17]},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),te("div",ue,[l(h,{onClick:R},{default:t(()=>e[18]||(e[18]=[c("取 消")])),_:1,__:[18]}),w(y)?E((d(),f(h,{key:1,type:"primary",onClick:S},{default:t(()=>e[20]||(e[20]=[c("确 定")])),_:1,__:[20]})),[[A,["business:ticket:edit"]]]):E((d(),f(h,{key:0,type:"primary",onClick:S},{default:t(()=>e[19]||(e[19]=[c("确 定")])),_:1,__:[19]})),[[A,["business:ticket:add"]]])])])}}}),ve=ie(de,[["__scopeId","data-v-cf2d7bbd"]]);export{ve as default};
