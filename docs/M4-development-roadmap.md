# M4 机柜管理模块 - 完整开发路线图

**版本：** v2.0
**创建时间：** 2025-01-18
**项目周期：** 30 个工作日（6周）

---

## 📊 项目总览

### 已完成（Day 1-3）✅
- ✅ 数据库设计与迁移
- ✅ 基础 CRUD 功能
- ✅ 权限菜单配置
- ✅ 前后端联调
- ✅ 性能优化
- ✅ API 文档
- ✅ 用户手册

### 当前数据统计
- 数据库记录：117 条机柜数据
- 代码量：
  - 后端：6 个文件（~1500 行）
  - 前端：2 个文件（~600 行）
- 索引：7 个（含复合索引）
- 文档：3 份（计划、用户手册、API 文档）

---

## 🗓️ Phase 1: 功能增强（第1-2周，10个工作日）

### Week 1: 核心功能扩展

#### Day 4-5：机柜详情页增强 ⭐⭐⭐
**文档：** [M4-phase1-detail-page-enhancement.md](./M4-phase1-detail-page-enhancement.md)

**任务：**
- [ ] Task 1: 优化详情页布局（4h）
- [ ] Task 2: 添加占用率图表 ECharts（2h）
- [ ] Task 3: 添加变更历史时间轴（6h）

**交付物：**
- ✅ 详情页包含 4 个信息卡片
- ✅ U位可视化图（42 个格子）
- ✅ 占用率环形图
- ✅ 变更历史记录（时间轴）

**预计时间：** 12 小时

---

#### Day 6-8：机柜U位管理 ⭐⭐⭐
**文档：** [M4-phase1-u-slot-management.md](./M4-phase1-u-slot-management.md)

**任务：**
- [ ] Task 1: 数据库设计（biz_rack_u_slot 表）（2h）
- [ ] Task 2: 后端 CRUD（Entity/Mapper/Service/Controller）（6h）
- [ ] Task 3: 前端 U位可视化组件（8h）
- [ ] Task 4: 集成测试（4h）

**核心功能：**
- 每个机柜生成对应的 U位记录
- U位可视化图（绿色-空闲/红色-占用/黄色-预留）
- 点击分配/释放 U位
- U位冲突检测
- 自动更新机柜 u_used 字段

**交付物：**
- ✅ biz_rack_u_slot 表
- ✅ U位管理 API（查询/分配/释放）
- ✅ U位可视化组件
- ✅ 117 条机柜 × 42U = 4914 条 U位记录

**预计时间：** 20 小时

---

### Week 2: 批量操作与数据管理

#### Day 9-10：批量操作功能 ⭐⭐
**文档：** [M4-phase1-batch-operations.md](./M4-phase1-batch-operations.md)

**任务：**
- [ ] Task 1: 批量修改状态（4h）
- [ ] Task 2: 批量导入 Excel（8h）

**核心功能：**
- 批量修改机柜状态（在用/停用/退役）
- Excel 批量导入（4 步导入流程）
- 导入模板下载
- 数据预览与验证
- 导入结果反馈

**交付物：**
- ✅ 批量修改状态 API
- ✅ 批量导入 API
- ✅ Excel 模板文件
- ✅ 导入向导组件

**预计时间：** 12 小时

---

#### Day 11-12：高级筛选与搜索 ⭐⭐
**任务：**
- [ ] 添加更多筛选条件（占用率区间、创建时间范围）
- [ ] 搜索历史记录
- [ ] 保存常用筛选条件
- [ ] 快速筛选标签

**预计时间：** 8 小时

---

#### Day 13：统计报表 ⭐⭐
**任务：**
- [ ] 机柜统计卡片（总数/在用/停用/退役）
- [ ] 楼层分布饼图
- [ ] 占用率分布柱状图
- [ ] 趋势图（按月统计新增/退役数量）

**技术栈：** ECharts

**预计时间：** 8 小时

---

## 🗓️ Phase 2: 与其他模块集成（第3-4周，10个工作日）

### Week 3: 设备管理集成

#### Day 14-16：设备管理模块开发 ⭐⭐⭐
**前置条件：** M4 机柜管理完成

**数据库设计：**
```sql
CREATE TABLE biz_asset_device (
    device_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    device_no VARCHAR(50) UNIQUE NOT NULL COMMENT '设备编号',
    device_name VARCHAR(100) NOT NULL COMMENT '设备名称',
    device_type VARCHAR(50) COMMENT '设备类型：server/storage/network',
    brand VARCHAR(50) COMMENT '品牌',
    model VARCHAR(100) COMMENT '型号',
    rack_id BIGINT COMMENT '所在机柜ID',
    start_u INT COMMENT '起始U位',
    u_count INT COMMENT '占用U数',
    ip_address VARCHAR(100) COMMENT 'IP地址',
    status VARCHAR(20) COMMENT '状态：online/offline/maintenance',
    purchase_date DATE COMMENT '采购日期',
    warranty_expire DATE COMMENT '保修到期日',
    remark VARCHAR(500),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    del_flag CHAR(1) DEFAULT '0',
    FOREIGN KEY (rack_id) REFERENCES biz_asset_rack(rack_id)
);
```

**功能：**
- 设备 CRUD
- 设备与机柜关联
- 设备上架/下架（自动占用/释放U位）
- 设备列表（按机柜筛选）

**预计时间：** 24 小时

---

#### Day 17-18：机柜-设备联动 ⭐⭐⭐
**任务：**
- [ ] 机柜详情页显示设备列表
- [ ] U位可视化图显示设备名称
- [ ] 设备上架时自动分配U位
- [ ] 设备下架时自动释放U位
- [ ] 设备迁移功能（跨机柜）

**预计时间：** 16 小时

---

### Week 4: 工单集成与告警

#### Day 19-20：工单集成 ⭐⭐
**前置条件：** 工单模块已完成

**功能：**
- 从机柜详情页创建工单（机柜维护工单）
- 机柜详情页显示相关工单
- 工单关闭后自动更新机柜状态

**预计时间：** 16 小时

---

#### Day 21-22：容量告警功能 ⭐⭐
**任务：**
- [ ] 定义告警规则（占用率阈值）
- [ ] 后台定时任务检测告警
- [ ] 告警通知（站内消息/邮件）
- [ ] 告警历史记录

**示例规则：**
- 占用率 ≥ 70%：黄色预警
- 占用率 ≥ 90%：红色告警
- 电力使用 ≥ 80%：告警

**预计时间：** 16 小时

---

## 🗓️ Phase 3: 高级功能（第5周，5个工作日）

### Day 23-24：3D机房可视化 ⭐⭐⭐（可选）
**技术栈：** Three.js / Babylon.js

**功能：**
- 3D 机房布局图
- 机柜位置标注
- 点击机柜显示详情
- 热力图（占用率/功率）

**预计时间：** 16 小时（可选功能）

---

### Day 25-26：数据导出与报表 ⭐⭐
**任务：**
- [ ] 自定义导出字段
- [ ] 导出 PDF 报表（带图表）
- [ ] 定时报表（每月/每季度自动生成）
- [ ] 报表模板管理

**预计时间：** 16 小时

---

### Day 27：权限细化 ⭐
**任务：**
- [ ] 数据权限（按楼层/房间）
- [ ] 字段权限（敏感字段只读）
- [ ] 操作审计日志增强

**预计时间：** 8 小时

---

## 🗓️ Phase 4: 优化与测试（第6周，5个工作日）

### Day 28：性能优化 ⭐⭐
**任务：**
- [ ] 数据库查询优化（EXPLAIN 分析）
- [ ] 前端组件懒加载
- [ ] 图片/图表懒加载
- [ ] Redis 缓存热点数据（字典、统计数据）

**预计时间：** 8 小时

---

### Day 29：全面测试 ⭐⭐⭐
**任务：**
- [ ] 单元测试（后端 Service 层）
- [ ] 集成测试（API 端到端）
- [ ] 前端 E2E 测试（Vitest）
- [ ] 压力测试（JMeter）

**测试覆盖率目标：** 80%

**预计时间：** 8 小时

---

### Day 30：上线准备 ⭐⭐⭐
**任务：**
- [ ] 生产环境配置
- [ ] 数据迁移脚本
- [ ] 备份与回滚方案
- [ ] 用户培训（录制视频）
- [ ] 发布说明文档

**交付物：**
- ✅ 生产环境部署手册
- ✅ 数据迁移验证报告
- ✅ 用户培训视频
- ✅ Release Notes

**预计时间：** 8 小时

---

## 📦 最终交付物清单

### 1. 数据库（10+ 表）
- ✅ biz_asset_rack（机柜主表）
- ✅ biz_rack_u_slot（U位管理）
- ✅ biz_asset_rack_log（变更历史）
- 🆕 biz_asset_device（设备表）
- 🆕 biz_rack_alert（告警表）
- 🆕 biz_rack_stats（统计表）

### 2. 后端代码（30+ 文件）
- ✅ 实体类（Domain）× 6
- ✅ Mapper 接口 × 6
- ✅ Mapper XML × 6
- ✅ Service 接口 × 6
- ✅ Service 实现 × 6
- ✅ Controller × 6

### 3. 前端代码（20+ 文件）
- ✅ 列表页面
- ✅ 详情页面（增强版）
- 🆕 U位可视化组件
- 🆕 批量导入向导组件
- 🆕 统计图表组件
- 🆕 3D 可视化组件（可选）
- ✅ 语言包（zh-CN, en-US）

### 4. 文档（10+ 份）
- ✅ 开发计划
- ✅ API 文档（Swagger）
- ✅ 用户操作手册
- 🆕 数据库设计文档
- 🆕 部署手册
- 🆕 测试报告
- 🆕 发布说明

### 5. 测试（100+ 用例）
- 🆕 单元测试（80% 覆盖率）
- 🆕 集成测试
- 🆕 E2E 测试
- 🆕 性能测试报告

---

## 📊 工作量统计

| 阶段 | 工作日 | 小时数 | 主要内容 |
|------|--------|--------|----------|
| **已完成（Day 1-3）** | 3 | 24 | 基础 CRUD、性能优化、文档 |
| **Phase 1（Day 4-13）** | 10 | 80 | 详情页、U位管理、批量操作、统计 |
| **Phase 2（Day 14-22）** | 10 | 80 | 设备集成、工单集成、告警 |
| **Phase 3（Day 23-27）** | 5 | 40 | 3D 可视化、报表、权限 |
| **Phase 4（Day 28-30）** | 3 | 24 | 优化、测试、上线 |
| **总计** | **31** | **248** | 全模块开发 |

---

## 🎯 里程碑

### M4.1 - 基础版（已完成）✅
- 机柜 CRUD
- 权限菜单
- 性能优化
- **时间：** Day 1-3

### M4.2 - 功能增强版
- 详情页增强
- U位管理
- 批量操作
- 统计报表
- **时间：** Day 4-13
- **发布日期：** 第2周结束

### M4.3 - 集成版
- 设备管理
- 工单集成
- 容量告警
- **时间：** Day 14-22
- **发布日期：** 第4周结束

### M4.4 - 完整版
- 3D 可视化
- 高级报表
- 权限细化
- **时间：** Day 23-27
- **发布日期：** 第5周结束

### M4.5 - 生产版
- 性能优化
- 全面测试
- 上线部署
- **时间：** Day 28-30
- **发布日期：** 第6周结束

---

## 🚀 快速开始下一步

### 立即开始 Phase 1.1（机柜详情页增强）

#### 步骤1：安装 ECharts
```bash
cd frontend
pnpm install echarts
```

#### 步骤2：创建变更日志表
```bash
mysql -u idc_app -pappPwd idc_clean < backend/sql/create_rack_log_table.sql
```

#### 步骤3：启动开发
```bash
# 后端（已启动）
# 前端（已启动）

# 访问
http://localhost:81
```

#### 步骤4：开发详情页
```bash
# 编辑文件
frontend/src/views/business/asset/rack/detail.vue
```

---

## 📞 技术支持

- **文档位置：** `/docs/M4-*.md`
- **API 文档：** http://localhost:8080/swagger-ui/index.html
- **前端地址：** http://localhost:81
- **后端地址：** http://localhost:8080

---

**准备好开始后续开发了吗？请告诉我你想从哪个任务开始！** 🚀
