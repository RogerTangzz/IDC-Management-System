# 机柜管理模块 - 用户操作手册

**版本：** v1.0
**创建时间：** 2025-01-18
**适用范围：** IDC 运维管理系统 M4 模块

---

## 📖 目录

1. [模块简介](#模块简介)
2. [功能概述](#功能概述)
3. [操作指南](#操作指南)
   - [3.1 查看机柜列表](#31-查看机柜列表)
   - [3.2 搜索和筛选](#32-搜索和筛选)
   - [3.3 新增机柜](#33-新增机柜)
   - [3.4 编辑机柜](#34-编辑机柜)
   - [3.5 删除机柜](#35-删除机柜)
   - [3.6 导出机柜数据](#36-导出机柜数据)
   - [3.7 排序功能](#37-排序功能)
4. [字段说明](#字段说明)
5. [常见问题](#常见问题)
6. [注意事项](#注意事项)
7. [权限说明](#权限说明)

---

## 模块简介

机柜管理模块用于管理 IDC 机房中的所有服务器机柜，包括机柜的基本信息、位置、容量、占用率、功率等关键信息。通过该模块，运维人员可以实时掌握机柜资源使用情况，合理规划资源分配。

---

## 功能概述

| 功能 | 描述 | 权限要求 |
|------|------|----------|
| **列表查询** | 查看所有机柜的基本信息 | `business:assetRack:list` |
| **详情查看** | 查看单个机柜的详细信息 | `business:assetRack:query` |
| **新增机柜** | 添加新的机柜记录 | `business:assetRack:add` |
| **编辑机柜** | 修改机柜信息 | `business:assetRack:edit` |
| **删除机柜** | 删除机柜记录（软删除） | `business:assetRack:remove` |
| **数据导出** | 导出机柜数据到 Excel | `business:assetRack:export` |
| **排序** | 按指定字段排序 | `business:assetRack:list` |
| **筛选** | 按楼层、状态筛选 | `business:assetRack:list` |

---

## 操作指南

### 3.1 查看机柜列表

#### 访问路径
```
业务管理 → 资产管理 → 机柜使用
```

#### 列表字段说明
- **机柜编号**：唯一标识机柜的编号（如 `RACK-001`）
- **机柜名称**：机柜的描述性名称（如 `核心机柜-A1`）
- **楼层**：机柜所在楼层（如 `一楼`）
- **房间/区域**：机柜所在房间或区域（如 `A区`）
- **总U数**：机柜的总单元数（通常为 42U）
- **已用U数**：已经使用的单元数
- **占用率**：U数占用率（百分比 + 进度条）
  - 🟢 绿色：< 70%（正常）
  - 🟡 黄色：70% - 90%（警告）
  - 🔴 红色：≥ 90%（告警）
- **额定功率(kW)**：机柜的额定功率容量
- **状态**：机柜当前状态
  - 🟢 在用（active）
  - 🟡 停用（disabled）
  - ⚪ 退役（retired）
- **创建时间**：记录创建的时间

#### 分页
- 默认每页显示 10 条记录
- 可选：10 / 20 / 30 / 50 条/页
- 支持翻页功能

---

### 3.2 搜索和筛选

#### 搜索条件

| 搜索字段 | 类型 | 说明 | 示例 |
|----------|------|------|------|
| **机柜编号** | 文本输入 | 支持模糊搜索 | 输入 `RACK` 可搜索所有包含 RACK 的编号 |
| **楼层** | 下拉选择 | 精确匹配 | 选择 `一楼` |
| **状态** | 下拉选择 | 精确匹配 | 选择 `在用` |

#### 操作步骤

1. **单条件搜索**：
   - 在"机柜编号"输入框输入关键字
   - 点击"搜索"按钮
   - 系统显示匹配结果

2. **组合筛选**：
   - 输入机柜编号：`RACK-001`
   - 选择楼层：`一楼`
   - 选择状态：`在用`
   - 点击"搜索"按钮
   - 系统显示同时满足三个条件的结果

3. **重置搜索**：
   - 点击"重置"按钮
   - 清空所有搜索条件
   - 返回默认列表（按创建时间降序）

#### 快捷键
- 在"机柜编号"输入框中按 `Enter` 键，快速执行搜索

---

### 3.3 新增机柜

#### 操作步骤

1. 点击列表页面的"新增"按钮
2. 系统弹出"添加机柜"对话框
3. 填写机柜信息（见下表）
4. 点击"确定"按钮提交
5. 系统提示"新增成功"
6. 列表自动刷新，显示新增的记录

#### 必填字段（*）

| 字段名称 | 是否必填 | 验证规则 | 默认值 | 示例 |
|----------|----------|----------|--------|------|
| **机柜编号*** | 是 | 长度 3-50 字符，必须唯一 | 无 | `RACK-001` |
| **机柜名称*** | 是 | 长度 2-100 字符 | 无 | `核心机柜-A1` |
| **楼层*** | 是 | 下拉选择 | 无 | `一楼` |
| **房间/区域** | 否 | 长度 ≤ 50 字符 | 无 | `A区` |
| **具体位置** | 否 | 长度 ≤ 200 字符 | 无 | `北侧靠窗位置` |
| **总U数*** | 是 | 1-100 的整数 | 42 | `42` |
| **已用U数** | 否 | ≥ 0 且 ≤ 总U数 | 0 | `20` |
| **额定功率(kW)** | 否 | ≥ 0 的数字 | 无 | `10.5` |
| **网络端口数** | 否 | ≥ 0 的整数 | 0 | `24` |
| **状态*** | 是 | 下拉选择 | `在用` | `在用` |
| **备注** | 否 | 长度 ≤ 500 字符 | 无 | `新购置设备` |

#### 表单验证

系统会自动进行以下验证：

✅ **合法输入示例**：
- 机柜编号：`RACK-001`（唯一）
- 总U数：`42`
- 已用U数：`20`（小于总U数）

❌ **非法输入示例**：
- 机柜编号：`AB`（少于 3 个字符）❌
- 机柜编号：`RACK-001`（与已有记录重复）❌
- 已用U数：`50`（超过总U数 42）❌
- 总U数：`150`（超过最大值 100）❌

#### 成功标准
- 系统提示"新增成功"
- 列表中出现新增的记录
- 机柜编号不与已有记录重复

---

### 3.4 编辑机柜

#### 操作步骤

1. 在列表中找到要编辑的机柜记录
2. 点击操作列的"编辑"按钮
3. 系统弹出"修改机柜"对话框
4. 表单自动填充原有数据
5. 修改需要变更的字段
6. 点击"确定"按钮提交
7. 系统提示"修改成功"
8. 列表自动刷新，显示更新后的数据

#### 常见编辑场景

**场景 1：更新已用U数**
```
操作前：总U数 42，已用U数 20
操作：将已用U数改为 30
结果：占用率从 47.6% 更新为 71.4%，进度条颜色从绿色变为黄色
```

**场景 2：修改机柜状态**
```
操作前：状态为"在用"
操作：将状态改为"停用"
结果：状态标签从绿色"在用"变为黄色"停用"
```

**场景 3：机柜编号冲突**
```
操作：将机柜编号从 RACK-001 改为 RACK-002（已存在）
结果：系统提示"修改机柜失败，机柜编号已存在"
解决：使用唯一的编号
```

#### 注意事项
- 机柜编号可以修改，但不能与其他记录重复
- 已用U数不能超过总U数
- 修改后会自动重新计算占用率

---

### 3.5 删除机柜

#### 操作步骤

1. 在列表中找到要删除的机柜记录
2. 点击操作列的"删除"按钮
3. 系统弹出确认对话框：
   ```
   是否确认删除机柜编号为"RACK-001"的数据项？
   ```
4. 点击"确定"按钮
5. 系统提示"删除成功"
6. 列表自动刷新，删除的记录消失

#### 删除机制
- **软删除**：数据不会从数据库中物理删除
- 仅将 `del_flag` 标记为 `1`
- 列表中不再显示，但可通过数据库恢复

#### 风险提示
⚠️ **删除前请确认**：
- 删除操作无法通过界面撤销
- 确保该机柜不再使用
- 建议先将状态改为"退役"，观察一段时间后再删除

---

### 3.6 导出机柜数据

#### 操作步骤

1. （可选）先进行筛选，只导出符合条件的数据
2. 点击"导出"按钮
3. 系统弹出确认对话框：
   ```
   是否确认导出所有机柜数据？
   ```
4. 点击"确定"按钮
5. 系统提示"正在导出数据，请稍候..."
6. 浏览器自动下载 Excel 文件
   - 文件名格式：`asset_rack_1673942400000.xlsx`
   - 文件包含所有列和当前筛选条件下的所有数据

#### 导出字段

Excel 文件包含以下列：

| 列名 | 说明 | 示例 |
|------|------|------|
| 机柜ID | 系统内部ID | `1` |
| 机柜编号 | 唯一编号 | `RACK-001` |
| 机柜名称 | 描述性名称 | `核心机柜-A1` |
| 楼层 | 楼层代码 | `1F` |
| 房间 | 房间/区域 | `A区` |
| 具体位置 | 位置描述 | `北侧靠窗位置` |
| 总U数 | 容量 | `42` |
| 已用U数 | 已使用容量 | `20` |
| 额定功率 | kW | `10.5` |
| 网络端口数 | 个数 | `24` |
| 状态 | 状态代码 | `active` |
| 备注 | 备注信息 | `新购置设备` |
| 创建人 | 创建用户 | `admin` |
| 创建时间 | 创建日期时间 | `2025-01-18 10:30:00` |
| 更新人 | 最后更新用户 | `admin` |
| 更新时间 | 最后更新日期时间 | `2025-01-18 15:45:00` |

#### 使用场景
- 📊 定期备份机柜数据
- 📈 生成月度/季度机柜使用报表
- 🔄 与其他系统进行数据交换
- 📧 发送给领导审阅

---

### 3.7 排序功能

#### 可排序字段

点击表头即可排序，支持以下字段：

| 字段 | 升序示例 | 降序示例 |
|------|----------|----------|
| **机柜编号** | RACK-001 → RACK-010 | RACK-010 → RACK-001 |
| **机柜名称** | A → Z | Z → A |
| **楼层** | 1F → 4F | 4F → 1F |
| **房间/区域** | A区 → D区 | D区 → A区 |
| **总U数** | 1 → 100 | 100 → 1 |
| **状态** | active → retired | retired → active |
| **创建时间** | 最早 → 最新 | 最新 → 最早（默认） |

#### 操作步骤

1. **首次点击表头**：升序排列（▲）
2. **再次点击表头**：降序排列（▼）
3. **第三次点击表头**：取消排序，恢复默认（按创建时间降序）

#### 示例

**需求**：查找占用率最高的机柜

1. 点击"总U数"表头，升序排列
2. 点击"已用U数"表头，降序排列
3. 手动计算或查看占用率进度条

---

## 字段说明

### 机柜编号（rack_no）
- **用途**：唯一标识机柜
- **格式建议**：
  - 楼层 + 区域 + 序号：`1F-A-001`
  - 功能 + 序号：`CORE-RACK-001`（核心机柜）
  - 简单序号：`RACK-001`
- **唯一性**：整个系统中不能重复
- **不可为空**

### 楼层（floor）
- **值**：`1F` / `2F` / `3F` / `4F`
- **显示**：`一楼` / `二楼` / `三楼` / `四楼`
- **用途**：快速定位机柜物理位置

### 总U数（u_count）
- **定义**：U（Unit）是机柜高度单位，1U = 1.75 英寸（44.45mm）
- **常见值**：
  - 标准机柜：42U
  - 半高机柜：22U
  - 小型机柜：18U
  - 超高机柜：47U
- **范围**：1 - 100

### 已用U数（u_used）
- **定义**：已经被服务器或设备占用的U数
- **计算**：手动统计或通过资产管理系统自动计算
- **必须**：≤ 总U数

### 占用率（计算字段）
- **公式**：`占用率 = (已用U数 / 总U数) × 100%`
- **示例**：
  - 总U数 42，已用U数 20 → 47.6%（绿色）
  - 总U数 42，已用U数 35 → 83.3%（黄色）
  - 总U数 42，已用U数 40 → 95.2%（红色）

### 额定功率（power_capacity）
- **单位**：kW（千瓦）
- **用途**：机柜的最大供电能力
- **常见值**：
  - 标准机柜：5 - 10 kW
  - 高密度机柜：15 - 20 kW
  - 刀片服务器机柜：20 - 30 kW

### 状态（status）
| 状态代码 | 显示名称 | 颜色 | 说明 |
|----------|----------|------|------|
| `active` | 在用 | 🟢 绿色 | 正常使用中 |
| `disabled` | 停用 | 🟡 黄色 | 暂停使用（维护、升级等） |
| `retired` | 退役 | ⚪ 灰色 | 已淘汰，不再使用 |

---

## 常见问题

### Q1: 为什么无法新增机柜，提示"机柜编号已存在"？
**A**: 系统要求机柜编号全局唯一。请检查：
1. 是否有已存在的机柜使用了相同编号
2. 尝试使用搜索功能查找是否存在
3. 使用唯一的新编号

### Q2: 修改已用U数后，占用率没有更新？
**A**: 占用率是实时计算的，应该会自动更新。请检查：
1. 刷新浏览器页面
2. 检查已用U数是否真的修改成功
3. 清空浏览器缓存后重试

### Q3: 导出的 Excel 文件中楼层显示为 1F、2F，不是中文？
**A**: 这是正常的。数据库中存储的是代码（1F），Excel 直接导出原始值。如需中文，可以：
1. 在 Excel 中使用 VLOOKUP 函数转换
2. 或联系系统管理员配置导出格式

### Q4: 删除机柜后发现误删，如何恢复？
**A**: 机柜采用软删除机制：
1. 数据仍在数据库中
2. 联系系统管理员通过数据库恢复
3. 或使用数据恢复功能（如果系统提供）

### Q5: 排序后如何恢复默认顺序？
**A**: 点击"重置"按钮，系统会恢复默认排序（按创建时间降序）

### Q6: 为什么有些字段无法排序？
**A**: 目前支持排序的字段有：
- 机柜编号、机柜名称
- 楼层、房间/区域
- 总U数、状态
- 创建时间

其他字段（如占用率、已用U数）暂不支持排序。

---

## 注意事项

### 数据准确性
✅ **建议**：
- 定期核对机柜实际使用情况与系统记录
- 每次上下架设备后及时更新已用U数
- 定期导出数据备份

❌ **避免**：
- 长时间不更新数据导致数据过期
- 随意删除记录
- 多人同时编辑同一条记录（可能导致数据覆盖）

### 性能优化
- 当数据量超过 1000 条时，建议使用筛选功能缩小范围
- 导出大量数据时可能需要等待几秒钟
- 定期清理退役机柜记录

### 安全性
- 只有具备相应权限的用户才能执行操作
- 系统会记录所有创建、修改、删除操作的用户和时间
- 建议定期审计操作日志

---

## 权限说明

### 权限列表

| 权限代码 | 权限名称 | 对应功能 |
|----------|----------|----------|
| `business:assetRack:list` | 机柜查询 | 查看机柜列表 |
| `business:assetRack:query` | 机柜详情 | 查看机柜详细信息 |
| `business:assetRack:add` | 机柜新增 | 新增机柜 |
| `business:assetRack:edit` | 机柜编辑 | 修改机柜信息 |
| `business:assetRack:remove` | 机柜删除 | 删除机柜 |
| `business:assetRack:export` | 机柜导出 | 导出机柜数据 |

### 角色推荐

| 角色 | 推荐权限 | 说明 |
|------|----------|------|
| **超级管理员（admin）** | 全部权限 | 系统管理员 |
| **普通运维（common）** | 查询 + 新增 + 编辑 | 日常运维人员 |
| **只读用户（viewer）** | 仅查询 | 只需查看数据 |
| **审计员（auditor）** | 查询 + 导出 | 定期导出报表 |

### 如何查看自己的权限？
1. 登录系统
2. 点击右上角用户名
3. 查看"个人中心" → "角色权限"
4. 联系系统管理员分配权限

---

## 附录：API 文档

如果您是开发人员，可以访问 Swagger API 文档：

```
访问地址：http://localhost:8080/swagger-ui/index.html
API 标签：机柜管理
端点前缀：/business/asset/rack
```

**主要 API**：
- `GET /business/asset/rack/list` - 查询机柜列表
- `GET /business/asset/rack/{rackId}` - 获取机柜详情
- `POST /business/asset/rack` - 新增机柜
- `PUT /business/asset/rack` - 修改机柜
- `DELETE /business/asset/rack/{rackIds}` - 删除机柜
- `POST /business/asset/rack/export` - 导出机柜数据

---

## 更新日志

| 版本 | 日期 | 更新内容 | 作者 |
|------|------|----------|------|
| v1.0 | 2025-01-18 | 初始版本，完整功能文档 | AI Assistant |

---

**📞 技术支持**：如遇到问题，请联系系统管理员或查阅在线帮助文档。
