README.md
79 lines

md


CLAUDE-IDC.md
978 lines

md


agent.md
876 lines

md


CLAUDE.md
905 lines

md


CODE-QUALITY.md
1,710 lines

md

è€ƒè™‘åˆ°è¦é‡æ„ï¼Œè¿™å‡ ä¸ªæ–‡ä»¶æ˜¯å¦è¦ä¿®æ”¹ï¼Œå¦‚æœéœ€è¦ç»™æˆ‘å®Œæ•´ç‰ˆ

åœ¨é‡æ„è¿‡ç¨‹ä¸­ï¼Œè¿™å‡ ä¸ªæ–‡æ¡£ç¡®å®éœ€è¦åŒæ­¥æ›´æ–°ã€‚è®©æˆ‘ä¸ºä½ æä¾›å®Œæ•´çš„æ›´æ–°ç‰ˆæœ¬ï¼š

ğŸ“ éœ€è¦æ›´æ–°çš„æ–‡æ¡£åŠåŸå› 
README.md - éœ€è¦æ·»åŠ é‡æ„ç›¸å…³ç« èŠ‚
CLAUDE-IDC.md - éœ€è¦æ›´æ–°å¼€å‘çŠ¶æ€å’Œé‡æ„æŒ‡å—
agent.md - éœ€è¦æ·»åŠ é‡æ„ç›¸å…³çš„AgentæŒ‡ä»¤
CLAUDE.md - åŸºç¡€è§„èŒƒï¼Œä¿æŒç¨³å®šï¼Œå°å¹…æ›´æ–°
CODE-QUALITY.md - éœ€è¦æ·»åŠ é‡æ„è´¨é‡æ ‡å‡†
è®©æˆ‘æä¾›å®Œæ•´çš„æ›´æ–°ç‰ˆæœ¬ï¼š

1. README.md (æ›´æ–°ç‰ˆ)
markdown
# IDC-Management-System Â· Docs Index

Purpose: One-stop navigation for specs, contracts, quality guides, reports, and scripts. Defines document roles and update policy.

## ğŸ”´ é‡æ„è¿›è¡Œä¸­ (2025-01)

**å½“å‰çŠ¶æ€**: å¤§è§„æ¨¡æ¶æ„é‡æ„è¿›è¡Œä¸­  
**é‡æ„æ–‡æ¡£**: [REFACTORING.md](./docs/REFACTORING.md)  
**è¿›åº¦è¿½è¸ª**: [refactoring-progress.md](./docs/refactoring-progress.md)

### é‡æ„æœŸé—´æ³¨æ„äº‹é¡¹
- âœ… å‰ç«¯å§‹ç»ˆä¿æŒå¯ç”¨ï¼ˆç‰¹æ€§å¼€å…³æ§åˆ¶ï¼‰
- âœ… æ–°æ—§ä»£ç å¹¶å­˜ï¼Œæ¸è¿›å¼è¿ç§»
- âœ… æ‰€æœ‰æ”¹åŠ¨åœ¨feature flagä¿æŠ¤ä¸‹
- ğŸ“‹ æ¯æ—¥åŒæ­¥è¿›åº¦ï¼Œé¿å…å†²çª

## Core Specs
- Business Spec: `docs/DCç³»ç»Ÿå¼€å‘åŠŸèƒ½ä¸šåŠ¡é€»è¾‘ä¸è§„èŒƒ V2.0.md` â€” full module blueprint, KPIs, search/filters, error handling, monitoring
- Frontend Spec: `docs/CLAUDE.md` â€” RuoYi-Vue3 app structure, API rules, TS migration strategy, charts/drilldown, message center
- IDC Extensions: `docs/CLAUDE-IDC.md` â€” businessâ†’RuoYi mapping, mineOnly alias, report drilldown, maintenance import
- Code Quality: `docs/CODE-QUALITY.md` â€” readability/maintainability/testability/performance/security
- **[NEW] Refactoring Guide**: `docs/REFACTORING.md` â€” é‡æ„è®¡åˆ’ã€é‡Œç¨‹ç¢‘ã€å®æ–½ç»†èŠ‚

## Quick Start (Ports Â· Startup Â· Mock)
- Backend Port: 8088 (fixed)
- Frontend: `cd frontend && pnpm i && pnpm dev`
- **é‡æ„æ¨¡å¼**: æ·»åŠ  `?refactor=true` åˆ°URLå¯ç”¨æ–°æ¶æ„é¢„è§ˆ

## é‡æ„å¿«é€Ÿå‘½ä»¤
```bash
# å¯ç”¨æ–°æ¶æ„å¼€å‘
pnpm dev:refactor

# è¿è¡Œé‡æ„æµ‹è¯•å¥—ä»¶
pnpm test:refactor

# æ£€æŸ¥é‡æ„è¿›åº¦
pnpm refactor:status

# å›æ»šåˆ°ç¨³å®šç‰ˆæœ¬
pnpm refactor:rollback
[å…¶ä½™å†…å®¹ä¿æŒä¸å˜...]


## 2. CLAUDE-IDC.md (æ·»åŠ é‡æ„ç« èŠ‚)

åœ¨ç°æœ‰å†…å®¹åŸºç¡€ä¸Šæ·»åŠ ï¼š
```markdown
## 11. é‡æ„å®æ–½æŒ‡å—ï¼ˆ2025-01æ–°å¢ï¼‰

### 11.1 é‡æ„æ¶æ„å›¾
æ—§æ¶æ„                    â†’    æ–°æ¶æ„
â”œâ”€â”€ æ··ä¹±çš„æœåŠ¡è°ƒç”¨          â†’    â”œâ”€â”€ æ¸…æ™°çš„åˆ†å±‚
â”œâ”€â”€ è§†å›¾åŒ…å«ä¸šåŠ¡é€»è¾‘        â†’    â”œâ”€â”€ é¢†åŸŸå±‚å¤„ç†ä¸šåŠ¡
â”œâ”€â”€ StoreèŒè´£ä¸æ¸…          â†’    â”œâ”€â”€ å•ä¸€èŒè´£Store
â””â”€â”€ å¼ºè€¦åˆAPIè°ƒç”¨          â†’    â””â”€â”€ ä¾èµ–æ³¨å…¥+äº‹ä»¶é©±åŠ¨


### 11.2 é‡æ„æœŸé—´å¼€å‘è§„èŒƒ
```javascript
// æ‰€æœ‰æ–°ä»£ç å¿…é¡»åœ¨ç‰¹æ€§å¼€å…³ä¿æŠ¤ä¸‹
if (FeatureFlags.isEnabled('USE_NEW_ARCHITECTURE')) {
  // æ–°æ¶æ„ä»£ç 
  const ticketDomain = container.get('ticketDomain')
  return ticketDomain.create(data)
} else {
  // ä¿ç•™æ—§ä»£ç 
  return addTicket(data)
}
11.3 é‡æ„æ£€æŸ¥æ¸…å•
 æ–°ä»£ç æœ‰ç‰¹æ€§å¼€å…³ä¿æŠ¤
 æ—§ä»£ç æœªè¢«åˆ é™¤
 æœ‰å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹
 æ–‡æ¡£å·²æ›´æ–°
 ä»£ç è¯„å®¡é€šè¿‡
11.4 å›æ»šç­–ç•¥
javascript
// ä¸€é”®å›æ»šæ‰€æœ‰ç‰¹æ€§
window.EMERGENCY_ROLLBACK = () => {
  FeatureFlags.setFlag('USE_NEW_ARCHITECTURE', false)
  FeatureFlags.setFlag('USE_DOMAIN_LAYER', false)
  FeatureFlags.setFlag('USE_EVENT_BUS', false)
  location.reload()
}

## 3. agent.md (æ·»åŠ é‡æ„èƒ½åŠ›)

åœ¨Agentèƒ½åŠ›éƒ¨åˆ†æ·»åŠ ï¼š
```markdown
## Agent é‡æ„ä¸“é¡¹èƒ½åŠ›

### é‡æ„åˆ†æèƒ½åŠ›
- **è€¦åˆåº¦åˆ†æ**: è¯†åˆ«æ¨¡å—é—´ä¾èµ–ï¼Œç”Ÿæˆè€¦åˆåº¦æŠ¥å‘Š
- **ä»£ç åå‘³é“æ£€æµ‹**: è¯†åˆ«éœ€è¦é‡æ„çš„ä»£ç æ¨¡å¼
- **å½±å“èŒƒå›´è¯„ä¼°**: åˆ†æé‡æ„å¯¹ç°æœ‰åŠŸèƒ½çš„å½±å“
- **é‡æ„æ–¹æ¡ˆåˆ¶å®š**: æä¾›è¯¦ç»†çš„é‡æ„æ­¥éª¤å’Œæ—¶é—´è¡¨

### é‡æ„å®æ–½æ”¯æŒ
Agentï¼Œå¸®æˆ‘é‡æ„å·¥å•æ¨¡å—ï¼š

åˆ†æå½“å‰è€¦åˆé—®é¢˜
åˆ¶å®šé‡æ„æ–¹æ¡ˆ
å®ç°é¢†åŸŸå±‚
æ·»åŠ ç‰¹æ€§å¼€å…³
ç¼–å†™æµ‹è¯•ç”¨ä¾‹

### é‡æ„æ¨¡æ¿
```javascript
// Agentå¯ä»¥ç”Ÿæˆçš„é‡æ„æ¨¡æ¿

// 1. é¢†åŸŸæ¨¡å‹æ¨¡æ¿
export class TicketDomain extends BaseDomain {
  constructor(repository, eventBus) {
    super(repository, eventBus)
  }
  
  async create(dto: TicketCreateDto): Promise<Ticket> {
    // ä¸šåŠ¡é€»è¾‘
  }
}

// 2. é€‚é…å™¨æ¨¡æ¿
export class TicketAdapter {
  static async create(data) {
    if (FeatureFlags.isEnabled('USE_NEW_TICKET')) {
      return container.get('ticketDomain').create(data)
    }
    return legacyCreateTicket(data)
  }
}

// 3. æµ‹è¯•æ¨¡æ¿
describe('TicketDomain Refactoring', () => {
  it('should maintain backward compatibility', () => {
    // æµ‹è¯•æ–°æ—§è¡Œä¸ºä¸€è‡´æ€§
  })
})
é‡æ„å‘½ä»¤ç¤ºä¾‹
# åˆ†æè€¦åˆåº¦
Agentï¼Œåˆ†æticketæ¨¡å—å’Œinspectionæ¨¡å—çš„è€¦åˆåº¦

# ç”Ÿæˆé‡æ„æ–¹æ¡ˆ
Agentï¼Œä¸ºticketEscalationæœåŠ¡ç”Ÿæˆè§£è€¦æ–¹æ¡ˆ

# å®æ–½é‡æ„
Agentï¼Œå°†TicketList.vueçš„ä¸šåŠ¡é€»è¾‘æŠ½å–åˆ°é¢†åŸŸå±‚

# æ·»åŠ æµ‹è¯•
Agentï¼Œä¸ºé‡æ„åçš„TicketDomainæ·»åŠ æµ‹è¯•ç”¨ä¾‹

## 4. CODE-QUALITY.md (æ·»åŠ é‡æ„è´¨é‡æ ‡å‡†)

åœ¨ç¬¬7èŠ‚é‡æ„æŒ‡å—åæ·»åŠ ï¼š
```markdown
## 7.4 å¤§è§„æ¨¡é‡æ„è´¨é‡æ ‡å‡†

### é‡æ„å‰è¯„ä¼°æ ‡å‡†
| æŒ‡æ ‡ | é˜ˆå€¼ | è¯´æ˜ |
|------|------|------|
| æµ‹è¯•è¦†ç›–ç‡ | >80% | ç¡®ä¿é‡æ„æœ‰ä¿æŠ¤ç½‘ |
| è€¦åˆåº¦è¯„åˆ† | >6/10 | å€¼å¾—é‡æ„çš„æ¨¡å— |
| Bugå¯†åº¦ | >5/KLOC | é—®é¢˜å¤šçš„æ¨¡å—ä¼˜å…ˆ |
| å˜æ›´é¢‘ç‡ | >10æ¬¡/æœˆ | çƒ­ç‚¹æ¨¡å—ä¼˜å…ˆ |

### é‡æ„è¿‡ç¨‹è´¨é‡é—¨ç¦
```yaml
# .github/workflows/refactoring-quality.yml
name: Refactoring Quality Gates

on:
  pull_request:
    paths:
      - 'src/domain/**'
      - 'src/services/**'

jobs:
  quality-check:
    steps:
      - name: Check Feature Flags
        run: |
          # ç¡®ä¿æ‰€æœ‰æ–°ä»£ç æœ‰ç‰¹æ€§å¼€å…³ä¿æŠ¤
          grep -r "FeatureFlags.isEnabled" src/domain/
          
      - name: Test Coverage
        run: |
          # æ–°ä»£ç æµ‹è¯•è¦†ç›–ç‡å¿…é¡»>90%
          pnpm test:coverage --threshold=90
          
      - name: Backward Compatibility
        run: |
          # è¿è¡Œå…¼å®¹æ€§æµ‹è¯•å¥—ä»¶
          pnpm test:compat
          
      - name: Performance Regression
        run: |
          # æ€§èƒ½ä¸èƒ½é€€åŒ–>10%
          pnpm test:perf --max-regression=10
é‡æ„ä»£ç è§„èŒƒ
javascript
// âœ… å¥½çš„é‡æ„ä»£ç 
class TicketDomain {
  constructor(
    private repository: TicketRepository,
    private eventBus: EventBus,
    private logger: Logger
  ) {
    // ä¾èµ–æ³¨å…¥
  }
  
  async create(dto: TicketCreateDto): Promise<Ticket> {
    // 1. éªŒè¯
    this.validate(dto)
    
    // 2. ä¸šåŠ¡é€»è¾‘
    const ticket = this.buildTicket(dto)
    
    // 3. æŒä¹…åŒ–
    const saved = await this.repository.save(ticket)
    
    // 4. å‘å¸ƒäº‹ä»¶
    this.eventBus.emit('ticket.created', saved)
    
    // 5. è¿”å›ç»“æœ
    return saved
  }
}

// âŒ éœ€è¦é¿å…çš„é‡æ„
class TicketService {
  create(data) {
    // ç›´æ¥è°ƒç”¨å…¶ä»–æ¨¡å—
    const inspection = InspectionService.get(data.inspectionId)
    
    // ç¡¬ç¼–ç ä¾èµ–
    const db = new Database()
    
    // æ··åˆå…³æ³¨ç‚¹
    const html = this.renderEmail(data)
    EmailService.send(html)
    
    return db.save(data)
  }
}
é‡æ„æ•ˆæœåº¦é‡
javascript
class RefactoringMetrics {
  measure(before: CodeMetrics, after: CodeMetrics) {
    return {
      // è€¦åˆåº¦æ”¹å–„
      couplingImprovement: 
        ((before.coupling - after.coupling) / before.coupling) * 100,
      
      // å¤æ‚åº¦é™ä½
      complexityReduction:
        ((before.complexity - after.complexity) / before.complexity) * 100,
      
      // å¯æµ‹è¯•æ€§æå‡
      testabilityGain:
        ((after.testability - before.testability) / before.testability) * 100,
      
      // ä»£ç è¡Œæ•°å˜åŒ–
      locChange:
        ((after.loc - before.loc) / before.loc) * 100,
      
      // æ˜¯å¦è¾¾æ ‡
      isSuccessful: function() {
        return this.couplingImprovement > 30 &&
               this.complexityReduction > 20 &&
               this.testabilityGain > 40
      }
    }
  }
}

## 5. æ–°å¢ REFACTORING.md
```markdown
# ç³»ç»Ÿé‡æ„å®æ–½æ‰‹å†Œ

## é‡æ„æ¦‚è§ˆ

### ä¸ºä»€ä¹ˆé‡æ„
- å½“å‰è€¦åˆåº¦ï¼š7-8/10ï¼ˆä¸¥é‡ï¼‰
- ç›®æ ‡è€¦åˆåº¦ï¼š4-5/10ï¼ˆå¥åº·ï¼‰
- é¢„æœŸæ”¶ç›Šï¼šå¼€å‘æ•ˆç‡æå‡30%ï¼ŒBugå‡å°‘50%

### é‡æ„åŸåˆ™
1. **é›¶é£é™©**: å‰ç«¯å§‹ç»ˆå¯ç”¨
2. **æ¸è¿›å¼**: å°æ­¥è¿­ä»£ï¼ŒæŒç»­äº¤ä»˜
3. **å¯å›æ»š**: ä»»ä½•æ—¶å€™å¯ä»¥å›åˆ°ç¨³å®šç‰ˆæœ¬
4. **å¯åº¦é‡**: æ¯ä¸ªé˜¶æ®µæœ‰æ˜ç¡®çš„æˆåŠŸæ ‡å‡†

## é‡æ„é‡Œç¨‹ç¢‘

[è¿™é‡Œæ’å…¥ä¹‹å‰æä¾›çš„å®Œæ•´é‡Œç¨‹ç¢‘è®¡åˆ’]

## ç‰¹æ€§å¼€å…³ä½¿ç”¨æŒ‡å—

### å¼€å‘ç¯å¢ƒé…ç½®
```javascript
// .env.development
VITE_ENABLE_REFACTORING=true
VITE_FEATURE_FLAGS_PANEL=true
ä»£ç ä¸­ä½¿ç”¨
javascript
import FeatureFlags from '@/config/FeatureFlags'

// æ£€æŸ¥ç‰¹æ€§
if (FeatureFlags.isEnabled('USE_NEW_ARCHITECTURE')) {
  // æ–°ä»£ç 
} else {
  // æ—§ä»£ç 
}

// ç›‘å¬å˜åŒ–
FeatureFlags.onChange('USE_NEW_ARCHITECTURE', (enabled) => {
  console.log('Architecture switched:', enabled)
})
é‡æ„è¿›åº¦è¿½è¸ª
å½“å‰è¿›åº¦ï¼ˆå®æ—¶æ›´æ–°ï¼‰
 Phase 0: å‡†å¤‡é˜¶æ®µ
 Phase 1: åŸºç¡€è®¾æ–½è§£è€¦ï¼ˆè¿›è¡Œä¸­ï¼‰
 Phase 2: Storeå±‚é‡æ„
 Phase 3: å·¥å•æ¨¡å—é‡æ„
 Phase 4: å·¡æ£€æ¨¡å—é‡æ„
 Phase 5: ç»´ä¿æ¨¡å—é‡æ„
 Phase 6: é›†æˆæµ‹è¯•
 Phase 7: æ–‡æ¡£äº¤ä»˜
æ¯æ—¥ç«™ä¼šæ¨¡æ¿
markdown
## é‡æ„æ—¥æŠ¥ - [æ—¥æœŸ]

### æ˜¨æ—¥å®Œæˆ
- 

### ä»Šæ—¥è®¡åˆ’
- 

### é‡åˆ°çš„é—®é¢˜
- 

### éœ€è¦çš„æ”¯æŒ
-
é—®é¢˜ä¸è§£ç­”
Q: é‡æ„ä¼šå½±å“ç°æœ‰åŠŸèƒ½å—ï¼Ÿ
A: ä¸ä¼šã€‚æ‰€æœ‰é‡æ„ä»£ç éƒ½åœ¨ç‰¹æ€§å¼€å…³ä¿æŠ¤ä¸‹ï¼Œä¸ä¼šå½±å“ç°æœ‰åŠŸèƒ½ã€‚

Q: å¦‚ä½•å›æ»šï¼Ÿ
A: æ‰§è¡Œ window.EMERGENCY_ROLLBACK() æˆ–å…³é—­æ‰€æœ‰ç‰¹æ€§å¼€å…³ã€‚

Q: å¦‚ä½•å‚ä¸é‡æ„ï¼Ÿ
A: 1. é˜…è¯»æœ¬æ–‡æ¡£ 2. é¢†å–ä»»åŠ¡ 3. éµå¾ªé‡æ„è§„èŒƒ 4. æäº¤PR