# 覆盖率标准（按原有门槛）
本文定义前端各功能/层级的覆盖率目标与CI门禁阈值，用于指导逐步重构与验收。数值来源于原有标准（ticket 专项与通用路径门槛）。
## 总体说明
- 统计口径：以行(lines)、函数(functions)、语句(statements)、分支(branches)四项为准。
- 计算范围：按路径分组做聚合统计（非单文件独立阈值），CI 以分组聚合结果与阈值比较。
- 排除项：测试代码(`src/**/__tests__/**`)、Mock(`src/mock/**`)等不参与统计；系统/监控/工具等非重构范围暂不纳入本表。
## 业务分组目标
- Ticket（`src/views/business/ticket/**`）
  - lines: 90%
  - branches: 85%
  - functions: 90%
  - statements: 90%
  - 阶段性（便于落地与验收）：
    - 列表 index.vue：functions ≥ 85%，statements ≥ 90%（P1）
    - 模板/详情/报表：逐步收敛至合计 90/85/90/90（P2–P4）
- 巡检 Inspection（`src/views/business/inspection/**`）
  - lines: 85%
  - branches: 80%
  - functions: 85%
  - statements: 85%
- 维保 Maintenance（`src/views/business/maintenance/**`）
  - lines: 80%
  - branches: 75%
  - functions: 80%
  - statements: 80%
## 核心层目标
- API（`src/api/**`）
  - lines: 85%
  - branches: 80%
  - functions: 85%
  - statements: 85%
- Utils（仅限关键文件）
  - `src/utils/auth.ts`
    - lines: 95%
    - branches: 95%
    - functions: 100%
    - statements: 95%
- Store（`src/store/**`）
  - lines: 85%
  - branches: 75%
  - functions: 85%
  - statements: 85%
- Services（`src/services/**`）
  - lines: 81%
  - branches: 71%
  - functions: 85%
  - statements: 81%
## CI 检查方式
- 建议通过脚本进行门禁，例如：`scripts/coverage-check.mjs`（按上述分组与阈值做聚合校验）。
- ticket 专项建议提供 `vitest.ticket.config.ts`，并以单线程（pool=threads/singleThread）运行降低内存压力。
- 推荐执行序列：
  - 分组（ticket-only）→ 全量 → 覆盖率校验（failure 即阻断合并）。
## 阶段推进建议
- P0：打通开关/适配/领域与 ticket-only 运行链路，先以较宽松阈值跑通（不低于现有基础），完成后将 CI 脚本阈值上调至本标准。
- P1–P4：按 Ticket 列表/模板/详情/报表顺序，补齐边界与失败分支；其后对 Inspection、Maintenance 分组逐步达标。
- P5：目录归一与预检脚本接入，防止路径回归；CI 统一门禁阈值与本标准保持一致。
## 备注
- 本文为“目标标准”，若临时与脚本阈值不一致，以本表为准并尽快对齐脚本配置。
