<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.BizAssetRackLogMapper">

    <resultMap type="BizAssetRackLog" id="BizAssetRackLogResult">
        <result property="logId"          column="log_id"          />
        <result property="rackId"         column="rack_id"         />
        <result property="operationType"  column="operation_type"  />
        <result property="operationDesc"  column="operation_desc"  />
        <result property="oldValue"       column="old_value"       />
        <result property="newValue"       column="new_value"       />
        <result property="operator"       column="operator"        />
        <result property="operationTime"  column="operation_time"  />
        <result property="rackNo"         column="rack_no"         />
        <result property="rackName"       column="rack_name"       />
    </resultMap>

    <sql id="selectRackLogVo">
        select
            l.log_id,
            l.rack_id,
            l.operation_type,
            l.operation_desc,
            l.old_value,
            l.new_value,
            l.operator,
            l.operation_time,
            r.rack_no,
            r.rack_name
        from biz_asset_rack_log l
        left join biz_asset_rack r on l.rack_id = r.rack_id
    </sql>

    <!-- 根据机柜ID查询日志列表 -->
    <select id="selectRackLogsByRackId" parameterType="Long" resultMap="BizAssetRackLogResult">
        <include refid="selectRackLogVo"/>
        where l.rack_id = #{rackId}
        order by l.operation_time desc
    </select>

    <!-- 新增日志 -->
    <insert id="insertRackLog" parameterType="BizAssetRackLog" useGeneratedKeys="true" keyProperty="logId">
        insert into biz_asset_rack_log
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="rackId != null">rack_id,</if>
            <if test="operationType != null and operationType != ''">operation_type,</if>
            <if test="operationDesc != null and operationDesc != ''">operation_desc,</if>
            <if test="oldValue != null">old_value,</if>
            <if test="newValue != null">new_value,</if>
            <if test="operator != null and operator != ''">operator,</if>
            operation_time
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="rackId != null">#{rackId},</if>
            <if test="operationType != null and operationType != ''">#{operationType},</if>
            <if test="operationDesc != null and operationDesc != ''">#{operationDesc},</if>
            <if test="oldValue != null">#{oldValue},</if>
            <if test="newValue != null">#{newValue},</if>
            <if test="operator != null and operator != ''">#{operator},</if>
            now()
        </trim>
    </insert>

    <!-- 批量新增日志 -->
    <insert id="batchInsertRackLog" parameterType="list">
        insert into biz_asset_rack_log(rack_id, operation_type, operation_desc, old_value, new_value, operator, operation_time)
        values
        <foreach collection="list" item="item" separator=",">
            (#{item.rackId}, #{item.operationType}, #{item.operationDesc}, #{item.oldValue}, #{item.newValue}, #{item.operator}, now())
        </foreach>
    </insert>

    <!-- 删除日志 -->
    <delete id="deleteRackLogByRackId" parameterType="Long">
        delete from biz_asset_rack_log where rack_id = #{rackId}
    </delete>

</mapper>
