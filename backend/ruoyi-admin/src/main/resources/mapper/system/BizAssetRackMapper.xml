<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.BizAssetRackMapper">

    <resultMap type="BizAssetRack" id="BizAssetRackResult">
        <result property="rackId"        column="rack_id"        />
        <result property="rackNo"        column="rack_no"        />
        <result property="rackName"      column="rack_name"      />
        <result property="floor"         column="floor"          />
        <result property="room"          column="room"           />
        <result property="location"      column="location"       />
        <result property="uCount"        column="u_count"        />
        <result property="uUsed"         column="u_used"         />
        <result property="powerCapacity" column="power_capacity" />
        <result property="networkPorts"  column="network_ports"  />
        <result property="status"        column="status"         />
        <result property="attachments"   column="attachments"    />
        <result property="remark"        column="remark"         />
        <result property="delFlag"       column="del_flag"       />
        <result property="createBy"      column="create_by"      />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"      column="update_by"      />
        <result property="updateTime"    column="update_time"    />
    </resultMap>

    <sql id="selectBizAssetRackVo">
        select rack_id, rack_no, rack_name, floor, room, location,
               u_count, u_used, power_capacity, network_ports,
               status, attachments, remark, del_flag,
               create_by, create_time, update_by, update_time
        from biz_asset_rack
    </sql>

    <select id="selectBizAssetRackList" parameterType="BizAssetRack" resultMap="BizAssetRackResult">
        <include refid="selectBizAssetRackVo"/>
        <where>
            del_flag = '0'

            <!-- 机柜编号模糊查询 -->
            <if test="rackNo != null and rackNo != ''">
                and rack_no like concat('%', #{rackNo}, '%')
            </if>

            <!-- 机柜名称模糊查询 -->
            <if test="rackName != null and rackName != ''">
                and rack_name like concat('%', #{rackName}, '%')
            </if>

            <!-- 楼层精确匹配 -->
            <if test="floor != null and floor != ''">
                and floor = #{floor}
            </if>

            <!-- 房间模糊查询 -->
            <if test="room != null and room != ''">
                and room like concat('%', #{room}, '%')
            </if>

            <!-- 状态精确匹配 -->
            <if test="status != null and status != ''">
                and status = #{status}
            </if>

            <!-- 时间范围过滤 -->
            <if test="params != null and params.beginTime != null and params.beginTime != ''">
                and create_time &gt;= #{params.beginTime}
            </if>
            <if test="params != null and params.endTime != null and params.endTime != ''">
                and create_time &lt;= #{params.endTime}
            </if>
        </where>
        <if test="params != null and params.orderBy != null and params.orderBy != ''">
            order by ${params.orderBy}
        </if>
    </select>

    <select id="selectBizAssetRackByRackId" parameterType="Long" resultMap="BizAssetRackResult">
        <include refid="selectBizAssetRackVo"/>
        where rack_id = #{rackId} and del_flag = '0'
    </select>

    <insert id="insertBizAssetRack" parameterType="BizAssetRack" useGeneratedKeys="true" keyProperty="rackId">
        insert into biz_asset_rack
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="rackNo != null and rackNo != ''">rack_no,</if>
            <if test="rackName != null and rackName != ''">rack_name,</if>
            <if test="floor != null and floor != ''">floor,</if>
            <if test="room != null">room,</if>
            <if test="location != null">location,</if>
            <if test="uCount != null">u_count,</if>
            <if test="uUsed != null">u_used,</if>
            <if test="powerCapacity != null">power_capacity,</if>
            <if test="networkPorts != null">network_ports,</if>
            <if test="status != null and status != ''">status,</if>
            <if test="attachments != null">attachments,</if>
            <if test="remark != null">remark,</if>
            <if test="delFlag != null">del_flag,</if>
            <if test="createBy != null">create_by,</if>
            <if test="createTime != null">create_time,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="rackNo != null and rackNo != ''">#{rackNo},</if>
            <if test="rackName != null and rackName != ''">#{rackName},</if>
            <if test="floor != null and floor != ''">#{floor},</if>
            <if test="room != null">#{room},</if>
            <if test="location != null">#{location},</if>
            <if test="uCount != null">#{uCount},</if>
            <if test="uUsed != null">#{uUsed},</if>
            <if test="powerCapacity != null">#{powerCapacity},</if>
            <if test="networkPorts != null">#{networkPorts},</if>
            <if test="status != null and status != ''">#{status},</if>
            <if test="attachments != null">#{attachments},</if>
            <if test="remark != null">#{remark},</if>
            <if test="delFlag != null">#{delFlag},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
         </trim>
    </insert>

    <update id="updateBizAssetRack" parameterType="BizAssetRack">
        update biz_asset_rack
        <trim prefix="SET" suffixOverrides=",">
            <if test="rackNo != null and rackNo != ''">rack_no = #{rackNo},</if>
            <if test="rackName != null and rackName != ''">rack_name = #{rackName},</if>
            <if test="floor != null and floor != ''">floor = #{floor},</if>
            <if test="room != null">room = #{room},</if>
            <if test="location != null">location = #{location},</if>
            <if test="uCount != null">u_count = #{uCount},</if>
            <if test="uUsed != null">u_used = #{uUsed},</if>
            <if test="powerCapacity != null">power_capacity = #{powerCapacity},</if>
            <if test="networkPorts != null">network_ports = #{networkPorts},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            <if test="attachments != null">attachments = #{attachments},</if>
            <if test="remark != null">remark = #{remark},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
        </trim>
        where rack_id = #{rackId}
    </update>

    <delete id="deleteBizAssetRackByRackId" parameterType="Long">
        update biz_asset_rack set del_flag = '1' where rack_id = #{rackId}
    </delete>

    <delete id="deleteBizAssetRackByRackIds" parameterType="Long">
        update biz_asset_rack set del_flag = '1'
        where rack_id in
        <foreach item="rackId" collection="array" open="(" separator="," close=")">
            #{rackId}
        </foreach>
    </delete>

    <select id="checkRackNoUnique" parameterType="String" resultMap="BizAssetRackResult">
        <include refid="selectBizAssetRackVo"/>
        where rack_no = #{rackNo} and del_flag = '0'
        limit 1
    </select>

</mapper>
